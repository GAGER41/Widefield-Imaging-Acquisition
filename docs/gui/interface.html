<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>Widefield-Imaging-Acquisition.gui.interface API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>Widefield-Imaging-Acquisition.gui.interface</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import sys
import time
import os
import matplotlib.pyplot as plt
from PyQt5.QtCore import QModelIndex, Qt, QLocale, qInstallMessageHandler
import numpy as np
from PyQt5.QtWidgets import (
    QVBoxLayout,
    QWidget,
    QGridLayout,
    QLabel,
    QHBoxLayout,
    QLineEdit,
    QCheckBox,
    QPushButton,
    QStackedLayout,
    QComboBox,
    QMessageBox,
    QFileDialog,
    QApplication,
    QSlider,
    QHeaderView,
    QDialog,
    QWizard,
)
from PyQt5.QtGui import (
    QIntValidator,
    QDoubleValidator,
    QFont,
    QIcon,
    QBrush,
    QColor,
    QPixmap,
)
from matplotlib.widgets import RectangleSelector
from threading import Thread

sys.path.append(os.path.dirname(os.path.dirname(__file__)))
from src.controls import DAQ, Instrument, Camera
from src.blocks import Experiment
from src.tree import Tree
from src.plot import PlotWindow
from src.calculations import (
    get_dictionary,
    shrink_array,
    frames_acquired_from_camera_signal,
    get_baseline_frame_indices,
    average_baseline,
)
import warnings

warnings.filterwarnings(&#34;ignore&#34;)


class App(QWidget):
    def __init__(self):
        &#34;&#34;&#34;Initialize the application&#34;&#34;&#34;
        super().__init__()
        qInstallMessageHandler(self.handler)
        self.cwd = os.path.dirname(os.path.dirname(__file__))
        self.config = get_dictionary(os.path.join(self.cwd, &#34;config.json&#34;))
        self.ports = self.config[&#34;Ports&#34;]
        self.elapsed_time = 0
        self.files_saved = False
        self.save_files_after_stop = False
        self.roi_extent = None
        self.max_exposure = 4096
        self.slider_values = {
            &#34;Infrared&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Red&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Green&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Blue&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
        }
        self.daq_generated = False
        self.onlyFloat = QDoubleValidator()
        self.onlyFloat.setLocale(QLocale(QLocale.English, QLocale.UnitedStates))
        self.onlyFloat.setNotation(QDoubleValidator.StandardNotation)
        self.onlyFramerate = QIntValidator(1, 57, self)
        self.onlyExposure = QIntValidator(1, 900, self)
        self.start_container = QWidget()
        self.start_layout = QVBoxLayout()
        self.start_container.setLayout(self.start_layout)
        self.start_title = QLabel(&#34;Welcome to WideBrain!&#34;)
        self.start_title.setFont(QFont(&#34;IBM Plex Sans&#34;, 20, QFont.Bold))
        self.start_title.setAlignment(Qt.AlignCenter)
        self.start_image = QLabel()
        self.start_image.setPixmap(
            QPixmap(os.path.join(self.cwd, &#34;assets&#34;, &#34;logo-small.png&#34;))
        )
        self.start_image.setAlignment(Qt.AlignCenter)
        self.start_description = QLabel(&#34;Choose the type of experiment you want to run&#34;)
        self.start_description.setFont(QFont(&#34;IBM Plex Sans&#34;, 14, QFont.Light))
        self.start_description.setWordWrap(True)
        self.start_description.setAlignment(Qt.AlignCenter)

        self.trigger_mode_button = QPushButton(&#34;Start in Trigger Mode&#34;)
        self.trigger_mode_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;bolt.png&#34;))
        )
        self.trigger_mode_button.setFont(QFont(&#34;IBM Plex Sans&#34;, 15, QFont.Light))
        self.trigger_mode_button.clicked.connect(self.start_in_trigger_mode)

        self.acquisition_mode_button = QPushButton(&#34;Start in Acquisition Mode&#34;)
        self.acquisition_mode_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;camera.png&#34;))
        )
        self.acquisition_mode_button.setFont(QFont(&#34;IBM Plex Sans&#34;, 15, QFont.Light))
        self.acquisition_mode_button.clicked.connect(self.start_in_acquisition_mode)

        self.start_buttons = QHBoxLayout()
        self.start_buttons.addWidget(self.trigger_mode_button)
        self.start_buttons.addWidget(self.acquisition_mode_button)

        self.start_layout.addWidget(self.start_title)
        self.start_layout.addWidget(self.start_image)
        self.start_layout.addWidget(self.start_description)
        self.start_layout.addLayout(self.start_buttons)

        self.grid_layout = QGridLayout()
        self.grid_layout.addWidget(self.start_container, 0, 0)

        self.setLayout(self.grid_layout)
        self.show()

    def start_in_trigger_mode(self):
        &#34;&#34;&#34;Initialize the interface in trigger mode&#34;&#34;&#34;
        self.start_container.setParent(None)
        self.acquisition_mode = False
        self.initUI()

    def start_in_acquisition_mode(self):
        &#34;&#34;&#34;Initialize the interface in acquisition mode&#34;&#34;&#34;
        self.start_container.setParent(None)
        self.acquisition_mode = True
        self.initUI()

    def closeEvent(self, *args, **kwargs):
        &#34;&#34;&#34;Stop all processes when closing the application&#34;&#34;&#34;
        self.video_running = False
        try:
            self.camera.stop_signal = True
            self.camera.video_running = False
            self.daq.stop_signal = True
            self.daq.camera.cam.stop_acquisition()
            print(&#34;Program Closed&#34;)
        except Exception as err:
            pass
        self.check_if_thread_is_alive()

    def handler(*args, **kwargs):
        &#34;&#34;&#34;Ignore Qt messages&#34;&#34;&#34;
        pass

    def initUI(self):
        &#34;&#34;&#34;Initialize the user interface&#34;&#34;&#34;
        self.title = &#34;Widefield Imaging Aquisition&#34;
        self.dimensions = (10, 10, 640, 480)
        self.setWindowTitle(self.title)
        self.setGeometry(*self.dimensions)

        # self.grid_layout = QGridLayout()
        # self.setLayout(self.grid_layout)
        self.grid_layout.setAlignment(Qt.AlignTop)

        self.experiment_settings_label = QLabel(&#34;Experiment Settings&#34;)
        self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

        self.experiment_settings_main_window = QVBoxLayout()
        self.experiment_name_window = QHBoxLayout()
        self.experiment_name = QLabel(&#34;Experiment Name&#34;)
        self.experiment_name_window.addWidget(self.experiment_name)
        self.experiment_name_cell = QLineEdit()
        self.experiment_name_window.addWidget(self.experiment_name_cell)
        self.experiment_settings_main_window.addLayout(self.experiment_name_window)

        self.mouse_id_window = QHBoxLayout()
        self.mouse_id_label = QLabel(&#34;Mouse ID&#34;)
        self.mouse_id_window.addWidget(self.mouse_id_label)
        self.mouse_id_cell = QLineEdit()
        self.mouse_id_window.addWidget(self.mouse_id_cell)
        self.experiment_settings_main_window.addLayout(self.mouse_id_window)

        self.framerate_exposure_window = QHBoxLayout()
        self.exposure_window = QHBoxLayout()
        self.exposure_label = QLabel(&#34;Exposure (ms)&#34;)
        self.exposure_window.addWidget(self.exposure_label)
        self.exposure_cell = QLineEdit(&#34;10&#34;)
        self.exposure_cell.setValidator(self.onlyExposure)
        self.exposure_cell.textChanged.connect(self.verify_exposure)
        self.exposure_window.addWidget(self.exposure_cell)
        self.framerate_exposure_window.addLayout(self.exposure_window)
        self.framerate_window = QHBoxLayout()
        self.framerate_label = QLabel(&#34;Framerate&#34;)
        self.framerate_window.addWidget(self.framerate_label)
        self.framerate_cell = QLineEdit(&#34;30&#34;)
        self.framerate_cell.setValidator(self.onlyFramerate)
        self.framerate_cell.textChanged.connect(self.verify_exposure)
        self.framerate_window.addWidget(self.framerate_cell)
        self.framerate_exposure_window.addLayout(self.framerate_window)

        if self.acquisition_mode:
            self.experiment_settings_main_window.addLayout(
                self.framerate_exposure_window
            )

        self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
        if self.acquisition_mode:
            self.experiment_settings_main_window.addWidget(self.exposure_warning_label)
        self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
        self.exposure_warning_label.setHidden(True)

        self.directory_window = QHBoxLayout()
        self.directory_save_files_checkbox = QCheckBox()
        self.directory_save_files_checkbox.setText(&#34;Save&#34;)
        self.directory_save_files_checkbox.stateChanged.connect(self.enable_directory)
        self.directory_window.addWidget(self.directory_save_files_checkbox)
        self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
        self.directory_choose_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;))
        )
        # self.directory_choose_button.setIcon(QIcon(os.path.join(&#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;)))
        self.directory_choose_button.setDisabled(True)
        self.directory_choose_button.clicked.connect(self.choose_directory)
        self.directory_window.addWidget(self.directory_choose_button)
        self.directory_cell = QLineEdit(&#34;&#34;)
        self.directory_cell.setReadOnly(True)
        self.directory_window.addWidget(self.directory_cell)
        self.experiment_settings_main_window.addLayout(self.directory_window)
        self.trigger_checkbox = QCheckBox(&#34;Wait for Trigger&#34;)
        self.trigger_activated = False
        self.trigger_checkbox.stateChanged.connect(self.set_trigger)
        # self.experiment_settings_main_window.addWidget(self.trigger_checkbox)

        self.save_config_button = QPushButton(&#34;Save Config&#34;)
        self.save_config_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;save.png&#34;))
        )
        self.save_config_button.clicked.connect(self.save_config)
        self.save_config_button.setEnabled(False)
        self.experiment_settings_main_window.addWidget(self.save_config_button)

        self.experiment_settings_main_window.addStretch()

        if self.acquisition_mode:
            self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)
        else:
            self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0, 1, 2)

        self.image_settings_label = QLabel(&#34;Image Settings&#34;)
        self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.image_settings_label, 0, 1)

        self.image_settings_main_window = QVBoxLayout()
        self.image_settings_main_window.setAlignment(Qt.AlignLeft)
        self.image_settings_main_window.setAlignment(Qt.AlignTop)

        self.image_settings_second_window = QHBoxLayout()
        self.ir_checkbox = QCheckBox(&#34;Infrared&#34;)
        self.ir_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.ir_checkbox)
        self.red_checkbox = QCheckBox(&#34;Red&#34;)
        self.red_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.red_checkbox)
        self.green_checkbox = QCheckBox(&#34;Green&#34;)
        self.green_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.green_checkbox)
        self.fluorescence_checkbox = QCheckBox(&#34;Blue&#34;)
        self.fluorescence_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

        self.light_channel_layout = QHBoxLayout()
        self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
        self.light_channel_layout.addWidget(self.preview_light_label)
        self.preview_light_combo = QComboBox()
        self.preview_light_combo.setEnabled(False)
        self.preview_light_combo.currentIndexChanged.connect(
            self.change_preview_light_channel
        )
        self.light_channel_layout.addWidget(self.preview_light_combo)
        # self.activation_map_checkbox = QCheckBox(&#34;Show Activation Map&#34;)
        self.activation_map_window = QHBoxLayout()
        self.activation_map_label = QLabel(&#34;Activation Map&#34;)
        self.activation_map_window.addWidget(self.activation_map_label)
        self.activation_map_combo = QComboBox()
        self.activation_map_combo.addItem(&#34;None&#34;)
        self.activation_map_combo.addItem(&#34;Normal&#34;)
        self.activation_map_combo.addItem(&#34;Logarithmic&#34;)
        self.activation_map_combo.currentIndexChanged.connect(self.adjust_slider)
        self.activation_map_window.addWidget(self.activation_map_combo)

        self.image_settings_main_window.addLayout(self.image_settings_second_window)
        self.image_settings_main_window.addLayout(self.light_channel_layout)
        # self.image_settings_main_window.addWidget(self.activation_map_checkbox)
        self.image_settings_main_window.addLayout(self.activation_map_window)

        self.roi_buttons = QStackedLayout()

        self.roi_layout1 = QHBoxLayout()
        self.roi_layout1.setAlignment(Qt.AlignLeft)
        self.roi_layout1.setAlignment(Qt.AlignTop)
        self.roi_layout1.setContentsMargins(0, 0, 0, 0)
        self.reset_roi_button = QPushButton()
        self.reset_roi_button.setText(&#34;Reset ROI&#34;)
        self.reset_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-out-area.png&#34;))
        )
        # self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
        self.reset_roi_button.setEnabled(False)
        self.reset_roi_button.clicked.connect(self.reset_roi)
        self.roi_layout1.addWidget(self.reset_roi_button)

        self.set_roi_button = QPushButton()
        self.set_roi_button.setText(&#34;Set ROI&#34;)
        self.set_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-in-area.png&#34;))
        )
        self.set_roi_button.clicked.connect(self.set_roi)
        self.roi_layout1.addWidget(self.set_roi_button)
        self.roi_layout1_container = QWidget()
        self.roi_layout1_container.setLayout(self.roi_layout1)

        self.roi_layout2 = QHBoxLayout()
        self.roi_layout2.setAlignment(Qt.AlignLeft)
        self.roi_layout2.setAlignment(Qt.AlignTop)
        self.roi_layout2.setContentsMargins(0, 0, 0, 0)
        self.cancel_roi_button = QPushButton()
        self.cancel_roi_button.setText(&#34;Cancel&#34;)
        self.cancel_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-cancel.png&#34;))
        )
        self.cancel_roi_button.clicked.connect(self.cancel_roi)
        self.roi_layout2.addWidget(self.cancel_roi_button)

        self.save_roi_button = QPushButton()
        self.save_roi_button.setText(&#34;Save ROI&#34;)
        self.save_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-check.png&#34;))
        )
        self.save_roi_button.clicked.connect(self.save_roi)
        self.roi_layout2.addWidget(self.save_roi_button)
        self.roi_layout2_container = QWidget()
        self.roi_layout2_container.setLayout(self.roi_layout2)

        if self.acquisition_mode:
            self.roi_buttons.addWidget(self.roi_layout1_container)
            self.roi_buttons.addWidget(self.roi_layout2_container)
            self.image_settings_main_window.addLayout(self.roi_buttons)

        self.exposure_slider = QSlider(Qt.Horizontal, self)
        self.exposure_slider.setRange(0, 4096)
        self.exposure_slider.setValue(4096)
        self.exposure_slider.valueChanged.connect(self.adjust_exposure)
        self.image_settings_main_window.addWidget(self.exposure_slider)
        self.image_settings_main_window.addStretch()

        self.activate_live_preview_button = QPushButton()
        self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
        self.activate_live_preview_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video.png&#34;))
        )
        self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

        self.deactivate_live_preview_button = QPushButton()
        self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
        self.deactivate_live_preview_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video-off.png&#34;))
        )
        self.deactivate_live_preview_button.clicked.connect(self.stop_live)

        self.image_settings_main_window.addStretch()

        if self.acquisition_mode:
            self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

        self.live_preview_label = QLabel(&#34;Live Preview&#34;)
        self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.image_view = PlotWindow()
        self.plot_image = plt.imshow(
            np.zeros(
                (int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;]))
            ),
            cmap=&#34;binary_r&#34;,
            vmin=0,
            vmax=4096,
            origin=&#34;lower&#34;,
        )
        self.plot_image.axes.get_xaxis().set_visible(False)
        self.plot_image.axes.axes.get_yaxis().set_visible(False)

        if self.acquisition_mode:
            self.grid_layout.addWidget(self.live_preview_label, 0, 2)
            self.grid_layout.addWidget(self.image_view, 1, 2)

        self.tree_label = QLabel(&#34;Stimulation Tree&#34;)
        self.tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.tree_label, 2, 0)

        self.tree_window = QVBoxLayout()
        self.tree = Tree()
        self.tree.setHeaderLabels(
            [
                &#34;0 Name&#34;,
                &#34;1 Iterations&#34;,
                &#34;2 Delay&#34;,
                &#34;3 Jitter&#34;,
                &#34;4 Type&#34;,
                &#34;5 Pulses&#34;,
                &#34;6 Duration&#34;,
                &#34;7 Jitter&#34;,
                &#34;8 Width&#34;,
                &#34;9 Frequency&#34;,
                &#34;10 Duty&#34;,
                &#34;11 Type2&#34;,
                &#34;12 Pulses 2&#34;,
                &#34;13 Jitter 2&#34;,
                &#34;14 Width 2&#34;,
                &#34;15 Frequency 2&#34;,
                &#34;16 Duty 2&#34;,
                &#34;17 Baseline&#34;,
                &#34;18 Canal 1&#34;,
                &#34;19 Canal 2&#34;,
                &#34;20 Valid&#34;,
                &#34;21 Heigth&#34;,
                &#34;22 Heigth 2&#34;,
                &#34;23 Type 3&#34;,
                &#34;24 Pulses 3&#34;,
                &#34;25 Jitter 3&#34;,
                &#34;26 Width 3&#34;,
                &#34;27 Frequency 3&#34;,
                &#34;28 Duty 3&#34;,
                &#34;29 Heigth 3&#34;,
                &#34;30 Canal 3&#34;,
            ]
        )
        if not self.config[&#34;Debug&#34;]:
            for i in range(1, 20):
                self.tree.header().hideSection(i)
            for i in range(21, 31):
                self.tree.header().hideSection(i)
            self.tree.setHeaderHidden(True)
            self.tree.header().setSectionResizeMode(0, QHeaderView.Stretch)
            self.tree.header().setStretchLastSection(False)
        self.tree.currentItemChanged.connect(self.actualize_window)
        self.tree_window.addWidget(self.tree)

        self.tree_switch_window = QStackedLayout()
        self.tree_second_window = QHBoxLayout()
        self.stim_buttons_container = QWidget()
        self.delete_item_button = QPushButton(&#34;Delete&#34;)
        self.delete_item_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;trash.png&#34;))
        )
        self.delete_item_button.clicked.connect(self.tree.delete_item)
        self.tree_second_window.addWidget(self.delete_item_button)
        self.add_brother_branch_button = QPushButton(&#34;Add Sibling&#34;)
        self.add_brother_branch_button.clicked.connect(self.tree.add_brother)
        self.add_brother_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-down.png&#34;))
        )
        self.tree_second_window.addWidget(self.add_brother_branch_button)
        self.add_child_branch_button = QPushButton(&#34;Add Child&#34;)
        self.add_child_branch_button.clicked.connect(self.tree.add_child)
        self.add_child_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-right.png&#34;))
        )
        self.tree_second_window.addWidget(self.add_child_branch_button)
        self.stim_buttons_container.setLayout(self.tree_second_window)
        self.tree_switch_window.addWidget(self.stim_buttons_container)

        self.tree_third_window = QHBoxLayout()
        self.import_button = QPushButton(&#34;Import Configuration&#34;)
        self.import_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;packge-import.png&#34;))
        )
        self.import_button.clicked.connect(self.import_config)
        self.tree_third_window.addWidget(self.import_button)
        self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
        self.new_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;square-plus.png&#34;))
        )
        self.tree_third_window.addWidget(self.new_branch_button)
        self.stim_buttons_container2 = QWidget()
        self.stim_buttons_container2.setLayout(self.tree_third_window)
        self.tree_switch_window.addWidget(self.stim_buttons_container2)
        self.new_branch_button.clicked.connect(self.tree.first_stimulation)
        self.grid_layout.addLayout(self.tree_switch_window, 4, 0)

        self.tree_switch_window.setCurrentIndex(1)
        self.grid_layout.addLayout(self.tree_window, 3, 0)

        self.signal_adjust_label = QLabel(&#34;Signal Adjust&#34;)
        self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

        self.signal_adjust_superposed = QStackedLayout()
        self.stimulation_edit_layout = QVBoxLayout()
        self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

        self.canal_window = QVBoxLayout()
        self.canal_window.setAlignment(Qt.AlignLeft)
        self.canal_window.setAlignment(Qt.AlignTop)
        self.canal_window.setContentsMargins(0, 0, 0, 0)

        self.first_canal_check = QCheckBox()
        self.first_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_canal_check.setText(&#34;Canal 1&#34;)

        self.stim_type_cell = QComboBox()
        self.stim_type_cell.addItem(&#34;square&#34;)
        self.stim_type_cell.addItem(&#34;random-square&#34;)
        self.stim_type_cell.addItem(&#34;Third&#34;)
        self.stim_type_cell.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window = QHBoxLayout()
        self.stimulation_type_window.addWidget(self.first_canal_check)
        self.stimulation_type_window.addWidget(self.stim_type_cell)
        self.canal_window.addLayout(self.stimulation_type_window)

        self.different_signals_window = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window)

        self.second_canal_check = QCheckBox()
        self.second_canal_check.stateChanged.connect(self.canals_to_tree)
        self.second_canal_check.setText(&#34;Canal 2&#34;)

        self.stim_type_cell2 = QComboBox()
        self.stim_type_cell2.addItem(&#34;square&#34;)
        self.stim_type_cell2.addItem(&#34;random-square&#34;)
        self.stim_type_cell2.addItem(&#34;Third&#34;)
        self.stim_type_cell2.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window2 = QHBoxLayout()
        self.stimulation_type_window2.addWidget(self.second_canal_check)
        self.stimulation_type_window2.addWidget(self.stim_type_cell2)
        self.canal_window.addLayout(self.stimulation_type_window2)

        self.different_signals_window2 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window2)

        self.third_canal_check = QCheckBox()
        self.third_canal_check.stateChanged.connect(self.canals_to_tree)
        self.third_canal_check.setText(&#34;Canal 3&#34;)
        # self.canal_window.addWidget(self.third_canal_check)

        self.stim_type_cell3 = QComboBox()
        self.stim_type_cell3.addItem(&#34;square&#34;)
        self.stim_type_cell3.addItem(&#34;random-square&#34;)
        self.stim_type_cell3.addItem(&#34;Third&#34;)
        self.stim_type_cell3.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window3 = QHBoxLayout()
        self.stimulation_type_window3.addWidget(self.third_canal_check)
        # self.stimulation_type_window3.addWidget(self.stim_type_cell3)
        self.canal_window.addLayout(self.stimulation_type_window3)

        self.different_signals_window3 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window3)

        self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
        self.stimulation_name_cell = QLineEdit()
        self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
        self.stimulation_name_window = QHBoxLayout()
        self.stimulation_name_window.addWidget(self.stimulation_name_label)
        self.stimulation_name_window.addWidget(self.stimulation_name_cell)
        self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

        self.duration_window = QHBoxLayout()
        self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
        self.duration_window.addWidget(self.first_signal_type_duration_label)
        self.duration_cell = QLineEdit()
        self.duration_window.addWidget(self.duration_cell)
        self.duration_cell.setValidator(self.onlyFloat)
        self.duration_cell.textEdited.connect(self.signal_to_tree)
        self.stimulation_edit_layout.addLayout(self.duration_window)

        self.baseline_checkbox = QCheckBox(&#34;Baseline&#34;)
        self.baseline_checkbox.stateChanged.connect(self.canals_to_tree)
        if self.acquisition_mode:
            self.stimulation_edit_layout.addWidget(self.baseline_checkbox)
        self.stimulation_edit_layout.addLayout(self.canal_window)

        self.first_signal_type_window = QVBoxLayout()
        self.first_signal_type_window.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window.setAlignment(Qt.AlignTop)
        self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container = QWidget()
        self.first_signal_type_container.setLayout(self.first_signal_type_window)

        self.first_signal_type_window2 = QVBoxLayout()
        self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window2.setAlignment(Qt.AlignTop)
        self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container2 = QWidget()
        self.first_signal_type_container2.setLayout(self.first_signal_type_window2)

        self.first_signal_type_window3 = QVBoxLayout()
        self.first_signal_type_window3.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window3.setAlignment(Qt.AlignTop)
        self.first_signal_type_window3.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container3 = QWidget()
        self.first_signal_type_container3.setLayout(self.first_signal_type_window3)

        self.pulses_window = QHBoxLayout()
        self.pulses_label = QLabel(&#34;Pulses&#34;)
        self.pulses_window.addWidget(self.pulses_label)
        self.pulses_cell = QLineEdit()
        self.pulses_cell.setValidator(QIntValidator())
        self.pulses_cell.textEdited.connect(self.signal_to_tree)
        self.pulses_window.addWidget(self.pulses_cell)

        self.pulses_window2 = QHBoxLayout()
        self.pulses_label2 = QLabel(&#34;Pulses&#34;)
        self.pulses_window2.addWidget(self.pulses_label2)
        self.pulses_cell2 = QLineEdit()
        self.pulses_cell2.setValidator(QIntValidator())
        self.pulses_cell2.textEdited.connect(self.signal_to_tree)
        self.pulses_window2.addWidget(self.pulses_cell2)

        self.pulses_window3 = QHBoxLayout()
        self.pulses_label3 = QLabel(&#34;Pulses&#34;)
        self.pulses_window3.addWidget(self.pulses_label3)
        self.pulses_cell3 = QLineEdit()
        self.pulses_cell3.setValidator(QIntValidator())
        self.pulses_cell3.textEdited.connect(self.signal_to_tree)
        self.pulses_window3.addWidget(self.pulses_cell3)

        self.jitter_window = QHBoxLayout()
        self.jitter_label = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window.addWidget(self.jitter_label)
        self.jitter_cell = QLineEdit()
        self.jitter_cell.setValidator(self.onlyFloat)
        self.jitter_cell.setText(&#34;0&#34;)
        self.jitter_cell.textEdited.connect(self.signal_to_tree)
        self.jitter_window.addWidget(self.jitter_cell)

        self.jitter_window2 = QHBoxLayout()
        self.jitter_window2 = QHBoxLayout()
        self.jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window2.addWidget(self.jitter_label2)
        self.jitter_cell2 = QLineEdit()
        self.jitter_cell2.setValidator(self.onlyFloat)
        self.jitter_cell2.setText(&#34;0&#34;)
        self.jitter_cell2.textEdited.connect(self.signal_to_tree)
        self.jitter_window2.addWidget(self.jitter_cell2)

        self.jitter_window3 = QHBoxLayout()
        self.jitter_window3 = QHBoxLayout()
        self.jitter_label3 = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window3.addWidget(self.jitter_label3)
        self.jitter_cell3 = QLineEdit()
        self.jitter_cell3.setValidator(self.onlyFloat)
        self.jitter_cell3.setText(&#34;0&#34;)
        self.jitter_cell3.textEdited.connect(self.signal_to_tree)
        self.jitter_window3.addWidget(self.jitter_cell3)

        self.width_window = QHBoxLayout()
        self.width_label = QLabel(&#34;Width (s)&#34;)
        self.width_window.addWidget(self.width_label)
        self.width_cell = QLineEdit()
        self.width_cell.setValidator(self.onlyFloat)
        self.width_cell.setText(&#34;0&#34;)
        self.width_cell.textEdited.connect(self.signal_to_tree)
        self.width_window.addWidget(self.width_cell)

        self.width_window2 = QHBoxLayout()
        self.width_label2 = QLabel(&#34;Width (s)&#34;)
        self.width_window2.addWidget(self.width_label2)
        self.width_cell2 = QLineEdit()
        self.width_cell2.setValidator(self.onlyFloat)
        self.width_cell2.setText(&#34;0&#34;)
        self.width_cell2.textEdited.connect(self.signal_to_tree)
        self.width_window2.addWidget(self.width_cell2)

        self.width_window3 = QHBoxLayout()
        self.width_label3 = QLabel(&#34;Width (s)&#34;)
        self.width_window3.addWidget(self.width_label3)
        self.width_cell3 = QLineEdit()
        self.width_cell3.setValidator(self.onlyFloat)
        self.width_cell3.setText(&#34;0&#34;)
        self.width_cell3.textEdited.connect(self.signal_to_tree)
        self.width_window3.addWidget(self.width_cell3)

        self.first_signal_type_window.addLayout(self.pulses_window)
        self.first_signal_type_window.addLayout(self.width_window)
        self.first_signal_type_window.addLayout(self.jitter_window)

        self.first_signal_type_window2.addLayout(self.pulses_window2)
        self.first_signal_type_window2.addLayout(self.width_window2)
        self.first_signal_type_window2.addLayout(self.jitter_window2)

        self.first_signal_type_window3.addLayout(self.pulses_window3)
        self.first_signal_type_window3.addLayout(self.width_window3)
        self.first_signal_type_window3.addLayout(self.jitter_window3)
        # -------------------

        self.second_signal_type_window = QVBoxLayout()
        self.second_signal_type_container = QWidget()
        self.second_signal_type_window.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window.setAlignment(Qt.AlignTop)
        self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container.setLayout(self.second_signal_type_window)
        # self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.second_signal_type_window2 = QVBoxLayout()
        self.second_signal_type_container2 = QWidget()
        self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window2.setAlignment(Qt.AlignTop)
        self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

        self.second_signal_type_window3 = QVBoxLayout()
        self.second_signal_type_container3 = QWidget()
        self.second_signal_type_window3.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window3.setAlignment(Qt.AlignTop)
        self.second_signal_type_window3.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container3.setLayout(self.second_signal_type_window3)

        self.heigth_window = QHBoxLayout()
        self.heigth_label = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window.addWidget(self.heigth_label)
        self.heigth_cell = QLineEdit()
        self.heigth_cell.setValidator(self.onlyFloat)
        self.heigth_cell.textEdited.connect(self.signal_to_tree)
        self.heigth_window.addWidget(self.heigth_cell)

        self.heigth_window2 = QHBoxLayout()
        self.heigth_label2 = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window2.addWidget(self.heigth_label2)
        self.heigth_cell2 = QLineEdit()
        self.heigth_cell2.setValidator(self.onlyFloat)
        self.heigth_cell2.textEdited.connect(self.signal_to_tree)
        self.heigth_window2.addWidget(self.heigth_cell2)

        self.heigth_window3 = QHBoxLayout()
        self.heigth_label3 = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window3.addWidget(self.heigth_label3)
        self.heigth_cell3 = QLineEdit()
        self.heigth_cell3.setValidator(self.onlyFloat)
        self.heigth_cell3.textEdited.connect(self.signal_to_tree)
        self.heigth_window3.addWidget(self.heigth_cell3)

        self.frequency_window = QHBoxLayout()
        self.frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window.addWidget(self.frequency_label)
        self.frequency_cell = QLineEdit()
        self.frequency_cell.setValidator(self.onlyFloat)
        self.frequency_cell.textEdited.connect(self.signal_to_tree)
        self.frequency_window.addWidget(self.frequency_cell)

        self.frequency_window2 = QHBoxLayout()
        self.frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window2.addWidget(self.frequency_label2)
        self.frequency_cell2 = QLineEdit()
        self.frequency_cell2.setValidator(self.onlyFloat)
        self.frequency_cell2.textEdited.connect(self.signal_to_tree)
        self.frequency_window2.addWidget(self.frequency_cell2)

        self.frequency_window3 = QHBoxLayout()
        self.frequency_label3 = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window3.addWidget(self.frequency_label3)
        self.frequency_cell3 = QLineEdit()
        self.frequency_cell3.setValidator(self.onlyFloat)
        self.frequency_cell3.textEdited.connect(self.signal_to_tree)
        self.frequency_window3.addWidget(self.frequency_cell3)

        self.duty_window = QHBoxLayout()
        self.duty_label = QLabel(&#34;Duty (%)&#34;)
        self.duty_window.addWidget(self.duty_label)
        self.duty_cell = QLineEdit()
        self.duty_cell.setValidator(self.onlyFloat)
        self.duty_cell.textEdited.connect(self.signal_to_tree)
        self.duty_window.addWidget(self.duty_cell)

        self.duty_window2 = QHBoxLayout()
        self.duty_label2 = QLabel(&#34;Duty (%)&#34;)
        self.duty_window2.addWidget(self.duty_label2)
        self.duty_cell2 = QLineEdit()
        self.duty_cell2.setValidator(self.onlyFloat)
        self.duty_cell2.textEdited.connect(self.signal_to_tree)
        self.duty_window2.addWidget(self.duty_cell2)

        self.duty_window3 = QHBoxLayout()
        self.duty_label3 = QLabel(&#34;Duty (%)&#34;)
        self.duty_window3.addWidget(self.duty_label3)
        self.duty_cell3 = QLineEdit()
        self.duty_cell3.setValidator(self.onlyFloat)
        self.duty_cell3.textEdited.connect(self.signal_to_tree)
        self.duty_window3.addWidget(self.duty_cell3)

        self.second_signal_type_window.addLayout(self.heigth_window)
        self.second_signal_type_window.addLayout(self.frequency_window)
        self.second_signal_type_window.addLayout(self.duty_window)

        self.second_signal_type_window2.addLayout(self.heigth_window2)
        self.second_signal_type_window2.addLayout(self.frequency_window2)
        self.second_signal_type_window2.addLayout(self.duty_window2)

        # self.second_signal_type_window3.addLayout(self.heigth_window3)
        self.second_signal_type_window3.addLayout(self.frequency_window3)
        self.second_signal_type_window3.addLayout(self.duty_window3)

        # -------------------

        self.third_signal_type_window = QVBoxLayout()
        self.third_signal_type_container = QWidget()
        self.third_signal_type_container.setLayout(self.third_signal_type_window)

        self.third_signal_type_window2 = QVBoxLayout()
        self.third_signal_type_container2 = QWidget()
        self.third_signal_type_container2.setLayout(self.third_signal_type_window2)

        self.third_signal_type_window3 = QVBoxLayout()
        self.third_signal_type_container3 = QWidget()
        self.third_signal_type_container3.setLayout(self.third_signal_type_window3)

        self.third_signal_type_name = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window.addWidget(self.third_signal_type_name)

        self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

        self.third_signal_type_name3 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window3.addWidget(self.third_signal_type_name3)

        self.different_signals_window.addWidget(self.second_signal_type_container)
        self.different_signals_window.addWidget(self.first_signal_type_container)
        self.different_signals_window.addWidget(self.third_signal_type_container)

        self.different_signals_window2.addWidget(self.second_signal_type_container2)
        self.different_signals_window2.addWidget(self.first_signal_type_container2)
        self.different_signals_window2.addWidget(self.third_signal_type_container2)

        self.different_signals_window3.addWidget(self.second_signal_type_container3)
        self.different_signals_window3.addWidget(self.first_signal_type_container3)
        self.different_signals_window3.addWidget(self.third_signal_type_container3)

        self.stimulation_edit_container = QWidget()
        self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
        self.block_edit_layout = QVBoxLayout()
        self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
        self.block_edit_layout.setAlignment(Qt.AlignLeft)
        self.block_edit_layout.setAlignment(Qt.AlignTop)

        self.block_name_label = QLabel(&#34;Block Name&#34;)
        self.block_name_cell = QLineEdit()
        self.block_name_cell.textEdited.connect(self.name_to_tree)
        self.block_name_window = QHBoxLayout()
        self.block_name_window.addWidget(self.block_name_label)
        self.block_name_window.addWidget(self.block_name_cell)
        self.block_edit_layout.addLayout(self.block_name_window)

        self.block_iterations_window = QHBoxLayout()
        self.block_iterations_label = QLabel(&#34;Iterations&#34;)
        self.block_iterations_cell = QLineEdit()
        self.block_iterations_cell.setValidator(QIntValidator())
        self.block_iterations_cell.textEdited.connect(self.block_to_tree)
        self.block_iterations_window.addWidget(self.block_iterations_label)
        self.block_iterations_window.addWidget(self.block_iterations_cell)
        self.block_edit_layout.addLayout(self.block_iterations_window)

        self.block_delay_window = QHBoxLayout()
        self.block_delay_label = QLabel(&#34;Delay&#34;)
        self.block_delay_cell = QLineEdit()
        self.block_delay_cell.setValidator(self.onlyFloat)
        self.block_delay_cell.textEdited.connect(self.block_to_tree)
        self.block_delay_window = QHBoxLayout()
        self.block_delay_window.addWidget(self.block_delay_label)
        self.block_delay_window.addWidget(self.block_delay_cell)
        self.block_edit_layout.addLayout(self.block_delay_window)

        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_label = QLabel(&#34;Jitter&#34;)
        self.block_jitter_cell = QLineEdit()
        self.block_jitter_cell.setValidator(self.onlyFloat)
        self.block_jitter_cell.textEdited.connect(self.block_to_tree)
        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_window.addWidget(self.block_jitter_label)
        self.block_jitter_window.addWidget(self.block_jitter_cell)
        self.block_edit_layout.addLayout(self.block_jitter_window)

        self.block_edit_container = QWidget()
        self.block_edit_container.setLayout(self.block_edit_layout)
        self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
        self.signal_adjust_superposed.addWidget(self.block_edit_container)
        self.signal_adjust_superposed.addWidget(QLabel())
        self.signal_adjust_superposed.setCurrentIndex(2)
        self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

        self.signal_preview_label = QLabel(&#34;Signal Preview&#34;)
        self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.signal_preview_label, 2, 2)
        else:
            self.grid_layout.addWidget(self.signal_preview_label, 0, 2)

        self.buttons_main_window = QHBoxLayout()
        self.stop_button = QPushButton(&#34;Stop&#34;)
        self.stop_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-stop.png&#34;))
        )
        self.stop_button.clicked.connect(self.stop_while_running)
        self.stop_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.stop_button)
        self.run_button = QPushButton(&#34;Run&#34;)
        self.run_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-play.png&#34;))
        )
        self.run_button.clicked.connect(self.run)
        self.run_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.run_button)
        self.plot_window = PlotWindow(subplots=True)
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.plot_window, 3, 2)
        else:
            self.grid_layout.addWidget(self.plot_window, 1, 2, 3, 1)
        self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
        self.open_daq_generation_thread()
        self.initialize_buttons()
        self.show()

    def deactivate_channels(self):
        &#34;&#34;&#34;Deactivate canal checkboxes if the baseline checkbox is checked&#34;&#34;&#34;
        if self.baseline_checkbox.isChecked():
            self.deactivate_buttons(
                [
                    self.first_canal_check,
                    self.second_canal_check,
                ]
            )
        else:
            self.activate_buttons(
                [
                    self.first_canal_check,
                    self.second_canal_check,
                ]
            )

    def adjust_exposure(self):
        &#34;&#34;&#34;Match the exposure of the image preview to the slider value&#34;&#34;&#34;
        self.max_exposure = self.exposure_slider.value()
        self.slider_values[self.preview_light_combo.currentText()][
            self.activation_map_combo.currentText()
        ] = self.max_exposure

    def set_trigger(self):
        &#34;&#34;&#34;Set the trigger for the DAQ&#34;&#34;&#34;
        if not self.acquisition_mode:
            self.run_button.setText(&#34;Run at Trigger&#34;)
            self.daq.set_trigger(self.ports[&#34;trigger&#34;])
        else:
            self.run_button.setText(&#34;Run&#34;)
            self.daq.remove_trigger()

    def import_config(self):
        &#34;&#34;&#34;Import a configuration file&#34;&#34;&#34;
        file = QFileDialog.getOpenFileName()[0]
        try:
            dictionary = get_dictionary(file)
            self.framerate_cell.setText(str(dictionary[&#34;Framerate&#34;]))
            self.exposure_cell.setText(str(dictionary[&#34;Exposition&#34;]))
            self.set_lights(dictionary[&#34;Lights&#34;])
            self.tree.create_tree_item(dictionary[&#34;Blocks&#34;])
            self.enable_run(self.tree.check_global_validity())
            self.tree.graph(self.tree.invisibleRootItem())
            self.draw()
        except Exception as err:
            print(err)

    def set_lights(self, lights):
        &#34;&#34;&#34;Set the lights&#34;&#34;&#34;
        for light in lights:
            if light == &#34;infrared&#34;:
                self.ir_checkbox.setChecked(True)
            elif light == &#34;red&#34;:
                self.red_checkbox.setChecked(True)
            elif light == &#34;green&#34;:
                self.green_checkbox.setChecked(True)
            elif light == &#34;blue&#34;:
                self.fluorescence_checkbox.setChecked(True)

    def run(self):
        &#34;&#34;&#34;Run the experiment&#34;&#34;&#34;
        if self.check_override():
            self.deactivate_buttons(buttons=self.enabled_buttons)
            self.master_block = self.tree.create_blocks()
            self.tree.baseline_values = []
            self.tree.graph(item=self.tree.invisibleRootItem())
            self.root_time, self.root_signal = (
                self.tree.x_values,
                [
                    self.tree.stim1_values,
                    self.tree.stim2_values,
                    self.tree.stim3_values,
                ],
            )
            self.draw(root=True)
            if self.acquisition_mode:
                self.actualize_daq()
                self.open_live_saving_thread()
                self.open_live_preview_thread()
                self.open_baseline_check_thread()
            else:
                self.daq.stop_signal = False
            self.open_signal_preview_thread()
            self.open_start_experiment_thread()

    def check_override(self):
        &#34;&#34;&#34;Check if experiment with the same name already exists&#34;&#34;&#34;
        if os.path.isfile(
            os.path.join(
                self.directory_cell.text(),
                self.experiment_name_cell.text(),
                f&#34;{self.experiment_name_cell.text()}-light_signal.npy&#34;,
            )
        ):
            button = QMessageBox.question(
                self,
                &#34;Files already exist&#34;,
                &#34;Files already exist. \n Do you want to override the existing files?&#34;,
            )
            if button == QMessageBox.Yes:
                return True
            else:
                return False
        else:
            return True

    def open_baseline_check_thread(self):
        &#34;&#34;&#34;Open the thread for the baseline check&#34;&#34;&#34;
        self.baseline_check_thread = Thread(target=self.check_baseline)
        self.baseline_check_thread.start()

    def check_baseline(self):
        &#34;&#34;&#34;Monitor the incoming frames and check if the baseline is reached&#34;&#34;&#34;
        if len(self.daq.lights) &gt; 0:
            self.camera.baseline_data = []
            self.camera.adding_frames = False
            self.camera.completed_baseline = False
            while self.daq.camera_signal is None:
                pass
            frames_acquired = frames_acquired_from_camera_signal(self.daq.camera_signal)
            baseline_indices = get_baseline_frame_indices(
                self.tree.baseline_values, frames_acquired
            )
            for baseline_pair in baseline_indices:
                while not self.daq.stop_signal:
                    try:
                        if (
                            not self.camera.adding_frames
                            and self.camera.frames_read &gt;= baseline_pair[0]
                        ):
                            self.camera.adding_frames = True
                        elif (
                            self.camera.adding_frames
                            and self.camera.frames_read &gt;= baseline_pair[1]
                        ):
                            self.camera.baseline_read_list = []
                            self.camera.average_baseline = average_baseline(
                                self.camera.baseline_data,
                                len(self.daq.lights),
                                self.camera.frames_read_list[0] % len(self.daq.lights),
                            )
                            self.camera.adding_frames = False
                            self.camera.baseline_frames = []
                            self.camera.baseline_completed = True
                            self.camera.frames_read_list = []
                            break
                    except Exception as err:
                        pass
                    time.sleep(0.01)

    def open_start_experiment_thread(self):
        &#34;&#34;&#34;Open the thread for the start of the experiment&#34;&#34;&#34;
        self.start_experiment_thread = Thread(target=self.run_stimulation)
        self.start_experiment_thread.start()

    def save_config(self):
        &#34;&#34;&#34;Save the current configuration to a JSON file&#34;&#34;&#34;
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        if folder != &#34;&#34;:
            self.master_block = self.tree.create_blocks()
            self.experiment = Experiment(
                self.master_block,
                int(self.framerate_cell.text()),
                int(self.exposure_cell.text()),
                self.mouse_id_cell.text(),
                folder,
                self.daq,
                name=self.experiment_name_cell.text(),
                config=self.config,
            )
            self.experiment.save_config(
                [int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;])]
            )

    def run_stimulation(self):
        &#34;&#34;&#34;Run the stimulation in parallel with the lights&#34;&#34;&#34;
        self.experiment = Experiment(
            self.master_block,
            int(self.framerate_cell.text()),
            int(self.exposure_cell.text()),
            self.mouse_id_cell.text(),
            self.directory_cell.text(),
            self.daq,
            name=self.experiment_name_cell.text(),
            config=self.config,
        )
        self.save_files_after_stop = True
        self.daq.launch(self.experiment.name, self.root_time, self.root_signal)
        # if (
        #    not self.daq.stop_signal
        #    and self.save_files_after_stop
        #    and self.directory_save_files_checkbox.isChecked()
        # ):
        if (
            self.save_files_after_stop
            and self.directory_save_files_checkbox.isChecked()
        ):
            try:
                print(&#34;this is the extent&#34;)
                print(self.roi_extent)
                self.experiment.save(self.roi_extent)
            except Exception as err:
                print(&#34;err after saving first&#34;)
                print(err)
                print(&#34;err before entering&#34;)
                self.experiment.save()
        self.stop()

    def open_live_saving_thread(self):
        &#34;&#34;&#34;Open the thread for the live saving&#34;&#34;&#34;
        self.live_save_thread = Thread(target=self.live_save)
        self.live_save_thread.start()

    def live_save(self):
        &#34;&#34;&#34;Save NPY chunked files when the number of frames is over 1200&#34;&#34;&#34;
        self.camera.file_index = 0
        self.camera.is_saving = False
        if self.directory_save_files_checkbox.isChecked():
            try:
                os.mkdir(
                    os.path.join(
                        self.directory_cell.text(), self.experiment_name_cell.text()
                    )
                )
                os.mkdir(
                    os.path.join(
                        self.directory_cell.text(),
                        self.experiment_name_cell.text(),
                        &#34;data&#34;,
                    )
                )
            except Exception as err:
                pass
            while self.camera.video_running is False and not self.camera.stop_signal:
                time.sleep(0.01)
                pass
            while self.camera.video_running is True:
                if len(self.camera.frames) &gt; 1200:
                    self.memory = self.camera.frames[:1200]
                    self.camera.frames = self.camera.frames[1200:]
                    if self.directory_save_files_checkbox.isChecked():
                        try:
                            self.memory = shrink_array(self.memory, self.roi_extent)
                        except Exception:
                            pass
                        self.camera.is_saving = True
                        np.save(
                            os.path.join(
                                self.directory_cell.text(),
                                self.experiment_name_cell.text(),
                                &#34;data&#34;,
                                f&#34;{self.camera.file_index}.npy&#34;,
                            ),
                            self.memory,
                        )
                        self.memory = None
                        self.camera.file_index += 1
                        self.camera.is_saving = False
                time.sleep(0.01)

    def open_live_preview_thread(self):
        &#34;&#34;&#34;Open the thread for the live preview&#34;&#34;&#34;
        self.live_preview_thread = Thread(target=self.start_live)
        self.live_preview_thread.start()

    def start_live(self):
        &#34;&#34;&#34;Start the live preview&#34;&#34;&#34;
        plt.ion()
        self.memory = []
        self.camera.baseline_completed = False
        if len(self.daq.lights) &gt; 0:
            try:
                while self.camera.video_running is False:
                    time.sleep(0.01)
                    pass
                while self.camera.video_running is True:
                    try:
                        if (
                            not self.camera.baseline_completed
                            or self.activation_map_combo.currentIndex() == 0
                        ):
                            self.plot_image.set(
                                array=self.camera.frames[
                                    self.live_preview_light_index :: len(
                                        self.daq.lights
                                    )
                                ][-1],
                                clim=(0, self.max_exposure),
                                cmap=&#34;binary_r&#34;,
                            )
                        elif self.activation_map_combo.currentIndex() == 1:
                            start_index = (
                                self.camera.baseline_read_list[0]
                                + self.live_preview_light_index
                            ) % len(self.daq.lights)
                            activation_map = (
                                self.camera.baseline_frames[
                                    start_index :: len(self.daq.lights)
                                ][-1]
                                - self.camera.average_baseline[
                                    self.live_preview_light_index
                                ]
                            ) / self.camera.average_baseline[
                                self.live_preview_light_index
                            ]
                            self.plot_image.set(
                                array=activation_map,
                                clim=(
                                    -self.max_exposure / 200,
                                    self.max_exposure / 200,
                                ),
                                cmap=&#34;seismic&#34;,
                            )
                        else:
                            start_index = (
                                self.camera.baseline_read_list[0]
                                + self.live_preview_light_index
                            ) % len(self.daq.lights)
                            activation_map = np.log(
                                (
                                    (
                                        self.camera.baseline_frames[
                                            start_index :: len(self.daq.lights)
                                        ][-1]
                                        - self.camera.average_baseline[
                                            self.live_preview_light_index
                                        ]
                                    )
                                    / self.camera.average_baseline[
                                        self.live_preview_light_index
                                    ]
                                )
                            )
                            self.plot_image.set(
                                array=activation_map,
                                clim=(
                                    -self.max_exposure / 2000,
                                    self.max_exposure / 2000,
                                ),
                                cmap=&#34;seismic&#34;,
                            )

                    except Exception as err:
                        print(err)
                        pass
                    time.sleep(0.04)
            except Exception as err:
                pass

    def stop_live(self):
        &#34;&#34;&#34;Stop the live preview&#34;&#34;&#34;
        self.camera.video_running = False

    def open_signal_preview_thread(self):
        &#34;&#34;&#34;Open the thread for the signal preview&#34;&#34;&#34;
        self.signal_preview_thread = Thread(target=self.actualize_progression)
        self.signal_preview_thread.start()

    def actualize_progression(self):
        &#34;&#34;&#34;Actualize the position of the progress bar&#34;&#34;&#34;
        plt.ion()
        while self.daq.stop_signal is False:
            try:
                if self.acquisition_mode:
                    position = self.camera.frames_read / int(self.framerate_cell.text())
                else:
                    position = time.time() - self.daq.start_time
                self.plot_window.vertical_lines[0].set_xdata(position)
                self.plot_window.vertical_lines[1].set_xdata(position)
                self.plot_window.vertical_lines[2].set_xdata(position)
                time.sleep(0.5)
            except Exception as err:
                time.sleep(0.5)
                pass

    def change_preview_light_channel(self):
        &#34;&#34;&#34;Change the light channel for the live preview&#34;&#34;&#34;
        self.live_preview_light_index = self.preview_light_combo.currentIndex()
        self.adjust_slider()

    def adjust_slider(self):
        &#34;&#34;&#34;Adjust the saturation slider using corresponding value in dictionary&#34;&#34;&#34;
        try:
            value = self.slider_values[self.preview_light_combo.currentText()][
                self.activation_map_combo.currentText()
            ]
            self.exposure_slider.setValue(value)
        except Exception:
            pass

    def open_daq_generation_thread(self):
        &#34;&#34;&#34;Open the thread for the DAQ generation&#34;&#34;&#34;
        self.daq_generation_thread = Thread(target=self.generate_daq)
        self.daq_generation_thread.start()

    def generate_daq(self):
        &#34;&#34;&#34;Generate the DAQ&#34;&#34;&#34;
        try:
            self.camera = Camera(self.ports[&#34;camera&#34;], &#34;name&#34;)
        except Exception:
            self.camera = None
        self.stimuli = [
            Instrument(self.ports[&#34;analog0&#34;], &#34;air-pump&#34;),
            Instrument(self.ports[&#34;analog1&#34;], &#34;air-pump2&#34;),
            Instrument(self.ports[&#34;co2&#34;], &#34;air-pump3&#34;),
        ]
        self.daq = DAQ(
            &#34;dev1&#34;,
            [],
            self.stimuli,
            self.camera,
            int(self.framerate_cell.text()),
            int(self.exposure_cell.text()) / 1000,
        )
        self.daq.close_all_lights(self.ports)
        self.daq_generated = True
        self.enable_run(self.tree.check_global_validity())

    def actualize_daq(self):
        &#34;&#34;&#34;Actualize the DAQ with the current settings&#34;&#34;&#34;
        try:
            self.daq.lights = []
            if self.ir_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;infrared&#34;], &#34;ir&#34;))
            if self.red_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;red&#34;], &#34;red&#34;))
            if self.green_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;green&#34;], &#34;green&#34;))
            if self.fluorescence_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;blue&#34;], &#34;blue&#34;))
            self.daq.framerate = int(self.framerate_cell.text())
            self.daq.exposure = int(self.exposure_cell.text()) / 1000
            self.camera.frames = []
            self.daq.stop_signal = False
        except Exception:
            pass

    def stop(self):
        &#34;&#34;&#34;Stop the experiment and reactivate the interface&#34;&#34;&#34;
        self.stop_live()
        self.activate_buttons(buttons=self.enabled_buttons)
        self.tree.setCurrentItem(self.tree.topLevelItem(0))
        try:
            self.daq.stop_signal = True
        except Exception:
            pass

    def stop_while_running(self):
        &#34;&#34;&#34;Stop the experiment while it is running&#34;&#34;&#34;
        if self.directory_save_files_checkbox.isChecked():
            self.stop_stimulation_dialog()
        self.stop()

    def stop_stimulation_dialog(self):
        &#34;&#34;&#34;Ask if user wants to keep the files after experiment is stopped&#34;&#34;&#34;
        button = QMessageBox.question(
            self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;
        )
        if button == QMessageBox.Yes:
            self.save_files_after_stop = True
        else:
            self.save_files_after_stop = False

    def show_buttons(self, buttons):
        &#34;&#34;&#34;Show the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setVisible(True)

    def hide_buttons(self, buttons):
        &#34;&#34;&#34;Hide the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setVisible(False)

    def activate_buttons(self, buttons):
        &#34;&#34;&#34;Activate the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setEnabled(True)
        if buttons == self.enabled_buttons:
            if self.directory_save_files_checkbox.isChecked():
                self.directory_choose_button.setEnabled(True)
            if self.roi_extent is None:
                self.reset_roi_button.setEnabled(False)
            else:
                self.set_roi_button.setEnabled(False)
            self.stop_button.setDisabled(True)

    def deactivate_buttons(self, buttons):
        &#34;&#34;&#34;Deactivate the buttons in a list&#34;&#34;&#34;
        if buttons == self.enabled_buttons:
            self.stop_button.setEnabled(True)
            self.tree.clearSelection()
        for button in buttons:
            button.setDisabled(True)

    def choose_directory(self):
        &#34;&#34;&#34;Choose the directory where to save the files&#34;&#34;&#34;
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        self.directory_cell.setText(folder)

    def enable_directory(self):
        &#34;&#34;&#34;Enable the directory cell&#34;&#34;&#34;
        self.files_saved = self.directory_save_files_checkbox.isChecked()
        self.directory_choose_button.setEnabled(self.files_saved)
        self.directory_cell.setEnabled(self.files_saved)

    def actualize_window(self):
        &#34;&#34;&#34;Actualize the &#39;Stimulation Edit&#39; and &#39;Signal Preview&#39; windows&#34;&#34;&#34;
        self.activate_buttons(
            [self.add_child_branch_button, self.add_brother_branch_button]
        )
        if self.tree.currentItem():
            self.tree_switch_window.setCurrentIndex(0)
        else:
            self.tree_switch_window.setCurrentIndex(1)
        try:
            if self.tree.currentItem().childCount() &gt; 0:
                self.signal_adjust_superposed.setCurrentIndex(1)
            else:
                self.signal_adjust_superposed.setCurrentIndex(0)
        except AttributeError:
            self.signal_adjust_superposed.setCurrentIndex(2)
        self.tree_to_name()
        self.tree_to_block()
        self.tree_to_type()
        self.tree_to_signal()
        self.tree_to_canal()
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def name_to_tree(self):
        &#34;&#34;&#34;Transfer the name of the current item from the cell to the tree&#34;&#34;&#34;
        branch = self.tree.currentItem()
        branch.setForeground(0, QBrush(QColor(0, 0, 0)))
        if branch.childCount() &gt; 0:
            branch.setText(0, self.block_name_cell.text())
        else:
            branch.setText(0, self.stimulation_name_cell.text())

    def tree_to_name(self):
        &#34;&#34;&#34;Transfer the name of the current item from the tree to the cell&#34;&#34;&#34;
        try:
            if self.tree.currentItem().childCount() &gt; 0:
                if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.block_name_cell.setText(self.tree.currentItem().text(0))
                else:
                    self.block_name_cell.setText(&#34;&#34;)
            else:
                if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.stimulation_name_cell.setText(self.tree.currentItem().text(0))
                else:
                    self.stimulation_name_cell.setText(&#34;&#34;)
        except AttributeError:
            pass

    def type_to_tree(self):
        &#34;&#34;&#34;Transfer the type of the current item from the cell to the tree&#34;&#34;&#34;
        self.enable_run(self.tree.check_global_validity())
        self.different_signals_window.setCurrentIndex(
            self.stim_type_cell.currentIndex()
        )
        self.different_signals_window2.setCurrentIndex(
            self.stim_type_cell2.currentIndex()
        )
        self.different_signals_window3.setCurrentIndex(
            self.stim_type_cell3.currentIndex()
        )
        try:
            self.tree.currentItem().setText(4, str(self.stim_type_cell.currentText()))
        except Exception:
            pass
        try:
            self.tree.currentItem().setText(11, str(self.stim_type_cell2.currentText()))
        except Exception:
            pass
        try:
            self.tree.currentItem().setText(23, str(self.stim_type_cell3.currentText()))
        except Exception:
            pass
        try:
            self.tree.graph(self.tree.currentItem(), current=True)
            self.draw()
        except Exception:
            pass

    def tree_to_type(self):
        &#34;&#34;&#34;Transfer the type of the current item from the tree to the cell&#34;&#34;&#34;
        dico = {&#34;square&#34;: 0, &#34;random-square&#34;: 1, &#34;Third&#34;: 2}
        try:
            self.stim_type_cell.setCurrentIndex(dico[self.tree.currentItem().text(4)])
        except Exception:
            self.stim_type_cell.setCurrentIndex(0)

        try:
            self.stim_type_cell2.setCurrentIndex(dico[self.tree.currentItem().text(11)])
        except Exception:
            self.stim_type_cell2.setCurrentIndex(0)

        try:
            self.stim_type_cell3.setCurrentIndex(dico[self.tree.currentItem().text(23)])
        except Exception:
            self.stim_type_cell3.setCurrentIndex(0)

    def signal_to_tree(self):
        &#34;&#34;&#34;Transfer the signal of the current item from the cell to the tree&#34;&#34;&#34;
        self.tree.currentItem().setText(6, self.duration_cell.text())
        self.tree.currentItem().setText(5, self.pulses_cell.text())
        self.tree.currentItem().setText(7, self.jitter_cell.text())
        self.tree.currentItem().setText(8, self.width_cell.text())
        self.tree.currentItem().setText(9, self.frequency_cell.text())
        self.tree.currentItem().setText(10, self.duty_cell.text())
        self.tree.currentItem().setText(21, self.heigth_cell.text())
        self.tree.currentItem().setText(12, self.pulses_cell2.text())
        self.tree.currentItem().setText(13, self.jitter_cell2.text())
        self.tree.currentItem().setText(14, self.width_cell2.text())
        self.tree.currentItem().setText(15, self.frequency_cell2.text())
        self.tree.currentItem().setText(16, self.duty_cell2.text())
        self.tree.currentItem().setText(22, self.heigth_cell2.text())
        self.tree.currentItem().setText(24, self.pulses_cell3.text())
        self.tree.currentItem().setText(25, self.jitter_cell3.text())
        self.tree.currentItem().setText(26, self.width_cell3.text())
        self.tree.currentItem().setText(27, self.frequency_cell3.text())
        self.tree.currentItem().setText(28, self.duty_cell3.text())
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def tree_to_signal(self):
        &#34;&#34;&#34;Transfer the signal of the current item from the tree to the cell&#34;&#34;&#34;
        try:
            self.pulses_cell.setText(self.tree.currentItem().text(5))
            self.duration_cell.setText(self.tree.currentItem().text(6))
            self.jitter_cell.setText(self.tree.currentItem().text(7))
            self.width_cell.setText(self.tree.currentItem().text(8))
            self.frequency_cell.setText(self.tree.currentItem().text(9))
            self.heigth_cell.setText(self.tree.currentItem().text(21))
            self.duty_cell.setText(self.tree.currentItem().text(10))
            self.pulses_cell2.setText(self.tree.currentItem().text(12))
            self.jitter_cell2.setText(self.tree.currentItem().text(13))
            self.width_cell2.setText(self.tree.currentItem().text(14))
            self.frequency_cell2.setText(self.tree.currentItem().text(15))
            self.heigth_cell2.setText(self.tree.currentItem().text(22))
            self.duty_cell2.setText(self.tree.currentItem().text(16))
            self.pulses_cell3.setText(self.tree.currentItem().text(24))
            self.jitter_cell3.setText(self.tree.currentItem().text(25))
            self.width_cell3.setText(self.tree.currentItem().text(26))
            self.frequency_cell3.setText(self.tree.currentItem().text(27))
            self.duty_cell3.setText(self.tree.currentItem().text(28))
        except Exception as err:
            pass

    def tree_to_block(self):
        &#34;&#34;&#34;Transfer the block attributes from the tree to the cells&#34;&#34;&#34;
        try:
            self.block_iterations_cell.setText(self.tree.currentItem().text(1))
            self.block_delay_cell.setText(self.tree.currentItem().text(2))
            self.block_jitter_cell.setText(self.tree.currentItem().text(3))
        except Exception:
            pass

    def block_to_tree(self):
        &#34;&#34;&#34;Transfer the block attributes from the cells to the tree&#34;&#34;&#34;
        self.tree.currentItem().setText(1, self.block_iterations_cell.text())
        self.tree.currentItem().setText(2, self.block_delay_cell.text())
        self.tree.currentItem().setText(3, self.block_jitter_cell.text())
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def tree_to_canal(self):
        &#34;&#34;&#34;Transfer the canals attributes from the tree to the cells&#34;&#34;&#34;
        self.canal_running = True
        try:
            self.baseline_checkbox.setChecked(
                self.boolean(self.tree.currentItem().text(17))
            )
            self.first_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(18))
            )
            self.second_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(19))
            )
            self.third_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(30))
            )
            if self.baseline_checkbox.isChecked():
                self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
                self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
                self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
            else:
                self.activate_buttons(
                    [
                        self.first_canal_check,
                        self.second_canal_check,
                        self.third_canal_check,
                    ]
                )
            if self.first_canal_check.isChecked():
                self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.second_canal_check.isChecked():
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
            if self.third_canal_check.isChecked():
                self.activate_buttons(self.canal3buttons)
            else:
                self.deactivate_buttons(self.canal3buttons)
        except Exception as err:
            pass
        self.canal_running = False

    def canals_to_tree(self):
        &#34;&#34;&#34;Transfer the canals attributes from the cells to the tree&#34;&#34;&#34;
        self.baseline_checkbox.setEnabled(True)
        if not self.canal_running:
            if self.baseline_checkbox.isChecked():
                self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
                self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
                self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
            else:
                self.activate_buttons(self.canal1buttons + [self.first_canal_check])
                self.activate_buttons(self.canal2buttons + [self.second_canal_check])
                self.activate_buttons(self.canal3buttons + [self.third_canal_check])
            if self.first_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.second_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
            if self.third_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal3buttons)
            else:
                self.deactivate_buttons(self.canal3buttons)
            if (
                self.first_canal_check.isChecked()
                or self.second_canal_check.isChecked()
                or self.third_canal_check.isChecked()
            ):
                self.deactivate_buttons([self.baseline_checkbox])
            else:
                self.activate_buttons([self.baseline_checkbox])
            self.tree.currentItem().setText(17, str(self.baseline_checkbox.isChecked()))
            self.tree.currentItem().setText(18, str(self.first_canal_check.isChecked()))
            self.tree.currentItem().setText(
                19, str(self.second_canal_check.isChecked())
            )
            self.tree.currentItem().setText(30, str(self.third_canal_check.isChecked()))
            self.enable_run(self.tree.check_global_validity())
            self.tree.graph(self.tree.currentItem(), current=True)
            self.draw()

    def enable_run(self, boolean):
        &#34;&#34;&#34;Enable the run button&#34;&#34;&#34;
        if not self.daq_generated:
            boolean = False
        self.save_config_button.setEnabled(boolean)
        self.run_button.setEnabled(boolean)

    def disable_run(self):
        &#34;&#34;&#34;Disable the run button&#34;&#34;&#34;
        self.save_config_button.setDisabled(True)
        self.run_button.setDisabled(True)

    def count_lights(self):
        &#34;&#34;&#34;Return the number of lights and a list of their names&#34;&#34;&#34;
        count = 0
        text = []
        for checkbox in [
            self.ir_checkbox,
            self.red_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
        ]:
            if checkbox.isChecked():
                count += 1
                text.append(checkbox.text())
        return (count, text)

    def actualize_lights(self):
        &#34;&#34;&#34;Update the lights list in the combo box&#34;&#34;&#34;
        self.preview_light_combo.clear()
        if self.count_lights()[0] == 0:
            self.preview_light_combo.setEnabled(False)
        else:
            self.preview_light_combo.setEnabled(True)
        for i in range(4):
            if i &lt; self.count_lights()[0]:
                self.preview_light_combo.addItem(self.count_lights()[1][i])

    def boolean(self, string):
        &#34;&#34;&#34;Return a boolean from a string&#34;&#34;&#34;
        if string == &#34;True&#34;:
            return True
        return False

    def draw(self, root=False):
        &#34;&#34;&#34;Draw the sitmulation channels graph
        
        Args:
            root (bool, optional): If True, the graph includes a progress bar&#34;&#34;&#34;
        try:
            self.plot_window.clear()
            self.plot_window.plot(
                self.tree.x_values, self.tree.stim1_values, root, index=0
            )
            self.plot_window.plot(
                self.tree.x_values,
                self.tree.stim2_values,
                root,
                index=1,
            )
            self.plot_window.plot(
                self.tree.x_values,
                self.tree.stim3_values,
                root,
                index=2,
            )
            self.tree.x_values = []
            self.tree.stim1_values = []
            self.tree.stim2_values = []
            self.tree.stim3_values = []
            self.elapsed_time = 0
        except Exception as err:
            pass

    def set_roi(self):
        &#34;&#34;&#34;Set the ROI&#34;&#34;&#34;
        self.deactivate_buttons(buttons=self.enabled_buttons)
        self.stop_button.setEnabled(False)
        self.save_roi_button.setEnabled(False)
        self.roi_buttons.setCurrentIndex(1)

        def onselect_function(eclick, erelease):
            &#34;&#34;&#34;Save the ROI dimensions as attributes&#34;&#34;&#34;
            self.roi_extent = self.rect_selector.extents
            self.save_roi_button.setEnabled(True)

        self.rect_selector = RectangleSelector(
            self.plot_image.axes,
            onselect_function,
            drawtype=&#34;box&#34;,
            useblit=True,
            button=[1, 3],
            minspanx=5,
            minspany=5,
            spancoords=&#34;pixels&#34;,
            interactive=True,
        )

    def reset_roi(self):
        &#34;&#34;&#34;Reset the ROI&#34;&#34;&#34;
        plt.figure(self.image_view.figure.number)
        plt.xlim(0, int(1024 / self.config[&#34;Binning&#34;]))
        plt.ylim(0, int(1024 / self.config[&#34;Binning&#34;]))
        self.roi_extent = None
        self.reset_roi_button.setEnabled(False)

    def cancel_roi(self):
        &#34;&#34;&#34;Cancel the ROI selection&#34;&#34;&#34;
        self.activate_buttons(buttons=self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        self.rect_selector.clear()
        self.rect_selector = None

    def save_roi(self):
        &#34;&#34;&#34;Save the ROI&#34;&#34;&#34;
        self.activate_buttons(buttons=self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        plt.figure(self.image_view.figure.number)
        plt.ion()
        print(self.roi_extent)
        plt.xlim(self.roi_extent[0], self.roi_extent[1])
        plt.ylim(self.roi_extent[2], self.roi_extent[3])
        self.rect_selector.clear()
        self.rect_selector = None
        self.reset_roi_button.setEnabled(True)

    def verify_exposure(self):
        &#34;&#34;&#34;Verify if the exposure/framerate combination is valid&#34;&#34;&#34;
        try:
            boolean_check = (int(self.exposure_cell.text()) / 1000 + 0.0015) * int(
                self.framerate_cell.text()
            ) &lt; 1 and int(self.framerate_cell.text()) &lt;= 57
        except Exception:
            boolean_check = False
        self.exposure_warning_label.setHidden(boolean_check)

    def check_if_thread_is_alive(self):
        &#34;&#34;&#34;Check what threads are alive&#34;&#34;&#34;
        try:
            if self.live_preview_thread.is_alive():
                print(&#34;Live preview thread is alive&#34;)
            else:
                print(&#34;Live preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.start_experiment_thread.is_alive():
                print(&#34;Start Experiment thread is alive&#34;)
            else:
                print(&#34;Start experiment thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.daq_generation_thread.is_alive():
                print(&#34;Daq Generation thread is alive&#34;)
            else:
                print(&#34;Daq generation thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.signal_preview_thread.is_alive():
                print(&#34;Signal Preview thread is alive&#34;)
            else:
                print(&#34;Signal Preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.live_save_thread.is_alive():
                print(&#34;Live Save thread is alive&#34;)
            else:
                print(&#34;Live Save thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.baseline_check_thread.is_alive():
                print(&#34;Baseline check thread is alive&#34;)
            else:
                print(&#34;Baseline check thread is dead&#34;)
        except Exception as err:
            print(err)

    def initialize_buttons(self):
        &#34;&#34;&#34;Define list of buttons to activate/deactivate&#34;&#34;&#34;
        self.canal1buttons = [
            self.stim_type_cell,
            self.pulses_label,
            self.pulses_cell,
            self.width_label,
            self.width_cell,
            self.jitter_label,
            self.jitter_cell,
            self.frequency_label,
            self.frequency_cell,
            self.duty_label,
            self.duty_cell,
            self.heigth_cell,
            self.heigth_label,
        ]
        self.canal2buttons = [
            self.stim_type_cell2,
            self.pulses_label2,
            self.pulses_cell2,
            self.width_label2,
            self.width_cell2,
            self.jitter_label2,
            self.jitter_cell2,
            self.frequency_label2,
            self.frequency_cell2,
            self.duty_label2,
            self.duty_cell2,
            self.heigth_cell2,
            self.heigth_label2,
        ]
        self.canal3buttons = [
            self.stim_type_cell3,
            self.pulses_label3,
            self.pulses_cell3,
            self.width_label3,
            self.width_cell3,
            self.jitter_label3,
            self.jitter_cell3,
            self.frequency_label3,
            self.frequency_cell3,
            self.duty_label3,
            self.duty_cell3,
            self.heigth_cell3,
            self.heigth_label3,
        ]
        self.enabled_buttons = [
            self.run_button,
            self.experiment_name_cell,
            self.mouse_id_cell,
            self.directory_choose_button,
            self.set_roi_button,
            self.reset_roi_button,
            self.experiment_name,
            self.mouse_id_label,
            self.framerate_label,
            self.framerate_cell,
            self.exposure_cell,
            self.exposure_label,
            self.add_brother_branch_button,
            self.add_child_branch_button,
            self.delete_item_button,
            self.red_checkbox,
            self.ir_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
            self.stimulation_name_label,
            self.directory_save_files_checkbox,
            self.stimulation_name_cell,
            self.stim_type_cell,
            self.stim_type_cell2,
            self.first_canal_check,
            self.second_canal_check,
            self.first_signal_type_duration_label,
            self.duration_cell,
            self.pulses_label,
            self.pulses_cell,
            self.width_label,
            self.width_cell,
            self.jitter_label,
            self.jitter_cell,
            self.frequency_label,
            self.frequency_cell,
            self.heigth_label,
            self.heigth_cell,
            self.duty_label,
            self.duty_cell,
            self.pulses_label2,
            self.pulses_cell2,
            self.width_label2,
            self.width_cell2,
            self.jitter_label2,
            self.jitter_cell2,
            self.frequency_label2,
            self.frequency_cell2,
            self.heigth_label2,
            self.heigth_cell2,
            self.duty_label2,
            self.duty_cell2,
            self.third_canal_check,
            self.stim_type_cell3,
            self.pulses_label3,
            self.pulses_cell3,
            self.width_label3,
            self.width_cell3,
            self.jitter_label3,
            self.jitter_cell3,
            self.frequency_label3,
            self.frequency_cell3,
            self.duty_label3,
            self.duty_cell3,
            self.heigth_cell3,
            self.heigth_label3,
            self.block_iterations_label,
            self.block_iterations_cell,
            self.block_delay_label,
            self.block_delay_cell,
            self.block_jitter_label,
            self.block_jitter_cell,
            self.block_name_label,
            self.block_name_cell,
            self.activate_live_preview_button,
            self.deactivate_live_preview_button,
            self.tree,
        ]


if __name__ == &#34;__main__&#34;:
    app = QApplication(sys.argv)
    font = QFont()
    font.setFamily(&#34;IBM Plex Sans&#34;)
    app.setFont(font)
    ex = App()
    sys.exit(app.exec_())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App"><code class="flex name class">
<span>class <span class="ident">App</span></span>
</code></dt>
<dd>
<div class="desc"><p>QWidget(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p>
<p>Initialize the application</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class App(QWidget):
    def __init__(self):
        &#34;&#34;&#34;Initialize the application&#34;&#34;&#34;
        super().__init__()
        qInstallMessageHandler(self.handler)
        self.cwd = os.path.dirname(os.path.dirname(__file__))
        self.config = get_dictionary(os.path.join(self.cwd, &#34;config.json&#34;))
        self.ports = self.config[&#34;Ports&#34;]
        self.elapsed_time = 0
        self.files_saved = False
        self.save_files_after_stop = False
        self.roi_extent = None
        self.max_exposure = 4096
        self.slider_values = {
            &#34;Infrared&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Red&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Green&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
            &#34;Blue&#34;: {&#34;None&#34;: 4096, &#34;Normal&#34;: 4096, &#34;Logarithmic&#34;: 4096},
        }
        self.daq_generated = False
        self.onlyFloat = QDoubleValidator()
        self.onlyFloat.setLocale(QLocale(QLocale.English, QLocale.UnitedStates))
        self.onlyFloat.setNotation(QDoubleValidator.StandardNotation)
        self.onlyFramerate = QIntValidator(1, 57, self)
        self.onlyExposure = QIntValidator(1, 900, self)
        self.start_container = QWidget()
        self.start_layout = QVBoxLayout()
        self.start_container.setLayout(self.start_layout)
        self.start_title = QLabel(&#34;Welcome to WideBrain!&#34;)
        self.start_title.setFont(QFont(&#34;IBM Plex Sans&#34;, 20, QFont.Bold))
        self.start_title.setAlignment(Qt.AlignCenter)
        self.start_image = QLabel()
        self.start_image.setPixmap(
            QPixmap(os.path.join(self.cwd, &#34;assets&#34;, &#34;logo-small.png&#34;))
        )
        self.start_image.setAlignment(Qt.AlignCenter)
        self.start_description = QLabel(&#34;Choose the type of experiment you want to run&#34;)
        self.start_description.setFont(QFont(&#34;IBM Plex Sans&#34;, 14, QFont.Light))
        self.start_description.setWordWrap(True)
        self.start_description.setAlignment(Qt.AlignCenter)

        self.trigger_mode_button = QPushButton(&#34;Start in Trigger Mode&#34;)
        self.trigger_mode_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;bolt.png&#34;))
        )
        self.trigger_mode_button.setFont(QFont(&#34;IBM Plex Sans&#34;, 15, QFont.Light))
        self.trigger_mode_button.clicked.connect(self.start_in_trigger_mode)

        self.acquisition_mode_button = QPushButton(&#34;Start in Acquisition Mode&#34;)
        self.acquisition_mode_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;camera.png&#34;))
        )
        self.acquisition_mode_button.setFont(QFont(&#34;IBM Plex Sans&#34;, 15, QFont.Light))
        self.acquisition_mode_button.clicked.connect(self.start_in_acquisition_mode)

        self.start_buttons = QHBoxLayout()
        self.start_buttons.addWidget(self.trigger_mode_button)
        self.start_buttons.addWidget(self.acquisition_mode_button)

        self.start_layout.addWidget(self.start_title)
        self.start_layout.addWidget(self.start_image)
        self.start_layout.addWidget(self.start_description)
        self.start_layout.addLayout(self.start_buttons)

        self.grid_layout = QGridLayout()
        self.grid_layout.addWidget(self.start_container, 0, 0)

        self.setLayout(self.grid_layout)
        self.show()

    def start_in_trigger_mode(self):
        &#34;&#34;&#34;Initialize the interface in trigger mode&#34;&#34;&#34;
        self.start_container.setParent(None)
        self.acquisition_mode = False
        self.initUI()

    def start_in_acquisition_mode(self):
        &#34;&#34;&#34;Initialize the interface in acquisition mode&#34;&#34;&#34;
        self.start_container.setParent(None)
        self.acquisition_mode = True
        self.initUI()

    def closeEvent(self, *args, **kwargs):
        &#34;&#34;&#34;Stop all processes when closing the application&#34;&#34;&#34;
        self.video_running = False
        try:
            self.camera.stop_signal = True
            self.camera.video_running = False
            self.daq.stop_signal = True
            self.daq.camera.cam.stop_acquisition()
            print(&#34;Program Closed&#34;)
        except Exception as err:
            pass
        self.check_if_thread_is_alive()

    def handler(*args, **kwargs):
        &#34;&#34;&#34;Ignore Qt messages&#34;&#34;&#34;
        pass

    def initUI(self):
        &#34;&#34;&#34;Initialize the user interface&#34;&#34;&#34;
        self.title = &#34;Widefield Imaging Aquisition&#34;
        self.dimensions = (10, 10, 640, 480)
        self.setWindowTitle(self.title)
        self.setGeometry(*self.dimensions)

        # self.grid_layout = QGridLayout()
        # self.setLayout(self.grid_layout)
        self.grid_layout.setAlignment(Qt.AlignTop)

        self.experiment_settings_label = QLabel(&#34;Experiment Settings&#34;)
        self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

        self.experiment_settings_main_window = QVBoxLayout()
        self.experiment_name_window = QHBoxLayout()
        self.experiment_name = QLabel(&#34;Experiment Name&#34;)
        self.experiment_name_window.addWidget(self.experiment_name)
        self.experiment_name_cell = QLineEdit()
        self.experiment_name_window.addWidget(self.experiment_name_cell)
        self.experiment_settings_main_window.addLayout(self.experiment_name_window)

        self.mouse_id_window = QHBoxLayout()
        self.mouse_id_label = QLabel(&#34;Mouse ID&#34;)
        self.mouse_id_window.addWidget(self.mouse_id_label)
        self.mouse_id_cell = QLineEdit()
        self.mouse_id_window.addWidget(self.mouse_id_cell)
        self.experiment_settings_main_window.addLayout(self.mouse_id_window)

        self.framerate_exposure_window = QHBoxLayout()
        self.exposure_window = QHBoxLayout()
        self.exposure_label = QLabel(&#34;Exposure (ms)&#34;)
        self.exposure_window.addWidget(self.exposure_label)
        self.exposure_cell = QLineEdit(&#34;10&#34;)
        self.exposure_cell.setValidator(self.onlyExposure)
        self.exposure_cell.textChanged.connect(self.verify_exposure)
        self.exposure_window.addWidget(self.exposure_cell)
        self.framerate_exposure_window.addLayout(self.exposure_window)
        self.framerate_window = QHBoxLayout()
        self.framerate_label = QLabel(&#34;Framerate&#34;)
        self.framerate_window.addWidget(self.framerate_label)
        self.framerate_cell = QLineEdit(&#34;30&#34;)
        self.framerate_cell.setValidator(self.onlyFramerate)
        self.framerate_cell.textChanged.connect(self.verify_exposure)
        self.framerate_window.addWidget(self.framerate_cell)
        self.framerate_exposure_window.addLayout(self.framerate_window)

        if self.acquisition_mode:
            self.experiment_settings_main_window.addLayout(
                self.framerate_exposure_window
            )

        self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
        if self.acquisition_mode:
            self.experiment_settings_main_window.addWidget(self.exposure_warning_label)
        self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
        self.exposure_warning_label.setHidden(True)

        self.directory_window = QHBoxLayout()
        self.directory_save_files_checkbox = QCheckBox()
        self.directory_save_files_checkbox.setText(&#34;Save&#34;)
        self.directory_save_files_checkbox.stateChanged.connect(self.enable_directory)
        self.directory_window.addWidget(self.directory_save_files_checkbox)
        self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
        self.directory_choose_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;))
        )
        # self.directory_choose_button.setIcon(QIcon(os.path.join(&#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;)))
        self.directory_choose_button.setDisabled(True)
        self.directory_choose_button.clicked.connect(self.choose_directory)
        self.directory_window.addWidget(self.directory_choose_button)
        self.directory_cell = QLineEdit(&#34;&#34;)
        self.directory_cell.setReadOnly(True)
        self.directory_window.addWidget(self.directory_cell)
        self.experiment_settings_main_window.addLayout(self.directory_window)
        self.trigger_checkbox = QCheckBox(&#34;Wait for Trigger&#34;)
        self.trigger_activated = False
        self.trigger_checkbox.stateChanged.connect(self.set_trigger)
        # self.experiment_settings_main_window.addWidget(self.trigger_checkbox)

        self.save_config_button = QPushButton(&#34;Save Config&#34;)
        self.save_config_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;save.png&#34;))
        )
        self.save_config_button.clicked.connect(self.save_config)
        self.save_config_button.setEnabled(False)
        self.experiment_settings_main_window.addWidget(self.save_config_button)

        self.experiment_settings_main_window.addStretch()

        if self.acquisition_mode:
            self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)
        else:
            self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0, 1, 2)

        self.image_settings_label = QLabel(&#34;Image Settings&#34;)
        self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.image_settings_label, 0, 1)

        self.image_settings_main_window = QVBoxLayout()
        self.image_settings_main_window.setAlignment(Qt.AlignLeft)
        self.image_settings_main_window.setAlignment(Qt.AlignTop)

        self.image_settings_second_window = QHBoxLayout()
        self.ir_checkbox = QCheckBox(&#34;Infrared&#34;)
        self.ir_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.ir_checkbox)
        self.red_checkbox = QCheckBox(&#34;Red&#34;)
        self.red_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.red_checkbox)
        self.green_checkbox = QCheckBox(&#34;Green&#34;)
        self.green_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.green_checkbox)
        self.fluorescence_checkbox = QCheckBox(&#34;Blue&#34;)
        self.fluorescence_checkbox.stateChanged.connect(self.actualize_lights)
        self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

        self.light_channel_layout = QHBoxLayout()
        self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
        self.light_channel_layout.addWidget(self.preview_light_label)
        self.preview_light_combo = QComboBox()
        self.preview_light_combo.setEnabled(False)
        self.preview_light_combo.currentIndexChanged.connect(
            self.change_preview_light_channel
        )
        self.light_channel_layout.addWidget(self.preview_light_combo)
        # self.activation_map_checkbox = QCheckBox(&#34;Show Activation Map&#34;)
        self.activation_map_window = QHBoxLayout()
        self.activation_map_label = QLabel(&#34;Activation Map&#34;)
        self.activation_map_window.addWidget(self.activation_map_label)
        self.activation_map_combo = QComboBox()
        self.activation_map_combo.addItem(&#34;None&#34;)
        self.activation_map_combo.addItem(&#34;Normal&#34;)
        self.activation_map_combo.addItem(&#34;Logarithmic&#34;)
        self.activation_map_combo.currentIndexChanged.connect(self.adjust_slider)
        self.activation_map_window.addWidget(self.activation_map_combo)

        self.image_settings_main_window.addLayout(self.image_settings_second_window)
        self.image_settings_main_window.addLayout(self.light_channel_layout)
        # self.image_settings_main_window.addWidget(self.activation_map_checkbox)
        self.image_settings_main_window.addLayout(self.activation_map_window)

        self.roi_buttons = QStackedLayout()

        self.roi_layout1 = QHBoxLayout()
        self.roi_layout1.setAlignment(Qt.AlignLeft)
        self.roi_layout1.setAlignment(Qt.AlignTop)
        self.roi_layout1.setContentsMargins(0, 0, 0, 0)
        self.reset_roi_button = QPushButton()
        self.reset_roi_button.setText(&#34;Reset ROI&#34;)
        self.reset_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-out-area.png&#34;))
        )
        # self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
        self.reset_roi_button.setEnabled(False)
        self.reset_roi_button.clicked.connect(self.reset_roi)
        self.roi_layout1.addWidget(self.reset_roi_button)

        self.set_roi_button = QPushButton()
        self.set_roi_button.setText(&#34;Set ROI&#34;)
        self.set_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-in-area.png&#34;))
        )
        self.set_roi_button.clicked.connect(self.set_roi)
        self.roi_layout1.addWidget(self.set_roi_button)
        self.roi_layout1_container = QWidget()
        self.roi_layout1_container.setLayout(self.roi_layout1)

        self.roi_layout2 = QHBoxLayout()
        self.roi_layout2.setAlignment(Qt.AlignLeft)
        self.roi_layout2.setAlignment(Qt.AlignTop)
        self.roi_layout2.setContentsMargins(0, 0, 0, 0)
        self.cancel_roi_button = QPushButton()
        self.cancel_roi_button.setText(&#34;Cancel&#34;)
        self.cancel_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-cancel.png&#34;))
        )
        self.cancel_roi_button.clicked.connect(self.cancel_roi)
        self.roi_layout2.addWidget(self.cancel_roi_button)

        self.save_roi_button = QPushButton()
        self.save_roi_button.setText(&#34;Save ROI&#34;)
        self.save_roi_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-check.png&#34;))
        )
        self.save_roi_button.clicked.connect(self.save_roi)
        self.roi_layout2.addWidget(self.save_roi_button)
        self.roi_layout2_container = QWidget()
        self.roi_layout2_container.setLayout(self.roi_layout2)

        if self.acquisition_mode:
            self.roi_buttons.addWidget(self.roi_layout1_container)
            self.roi_buttons.addWidget(self.roi_layout2_container)
            self.image_settings_main_window.addLayout(self.roi_buttons)

        self.exposure_slider = QSlider(Qt.Horizontal, self)
        self.exposure_slider.setRange(0, 4096)
        self.exposure_slider.setValue(4096)
        self.exposure_slider.valueChanged.connect(self.adjust_exposure)
        self.image_settings_main_window.addWidget(self.exposure_slider)
        self.image_settings_main_window.addStretch()

        self.activate_live_preview_button = QPushButton()
        self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
        self.activate_live_preview_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video.png&#34;))
        )
        self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

        self.deactivate_live_preview_button = QPushButton()
        self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
        self.deactivate_live_preview_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video-off.png&#34;))
        )
        self.deactivate_live_preview_button.clicked.connect(self.stop_live)

        self.image_settings_main_window.addStretch()

        if self.acquisition_mode:
            self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

        self.live_preview_label = QLabel(&#34;Live Preview&#34;)
        self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.image_view = PlotWindow()
        self.plot_image = plt.imshow(
            np.zeros(
                (int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;]))
            ),
            cmap=&#34;binary_r&#34;,
            vmin=0,
            vmax=4096,
            origin=&#34;lower&#34;,
        )
        self.plot_image.axes.get_xaxis().set_visible(False)
        self.plot_image.axes.axes.get_yaxis().set_visible(False)

        if self.acquisition_mode:
            self.grid_layout.addWidget(self.live_preview_label, 0, 2)
            self.grid_layout.addWidget(self.image_view, 1, 2)

        self.tree_label = QLabel(&#34;Stimulation Tree&#34;)
        self.tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.tree_label, 2, 0)

        self.tree_window = QVBoxLayout()
        self.tree = Tree()
        self.tree.setHeaderLabels(
            [
                &#34;0 Name&#34;,
                &#34;1 Iterations&#34;,
                &#34;2 Delay&#34;,
                &#34;3 Jitter&#34;,
                &#34;4 Type&#34;,
                &#34;5 Pulses&#34;,
                &#34;6 Duration&#34;,
                &#34;7 Jitter&#34;,
                &#34;8 Width&#34;,
                &#34;9 Frequency&#34;,
                &#34;10 Duty&#34;,
                &#34;11 Type2&#34;,
                &#34;12 Pulses 2&#34;,
                &#34;13 Jitter 2&#34;,
                &#34;14 Width 2&#34;,
                &#34;15 Frequency 2&#34;,
                &#34;16 Duty 2&#34;,
                &#34;17 Baseline&#34;,
                &#34;18 Canal 1&#34;,
                &#34;19 Canal 2&#34;,
                &#34;20 Valid&#34;,
                &#34;21 Heigth&#34;,
                &#34;22 Heigth 2&#34;,
                &#34;23 Type 3&#34;,
                &#34;24 Pulses 3&#34;,
                &#34;25 Jitter 3&#34;,
                &#34;26 Width 3&#34;,
                &#34;27 Frequency 3&#34;,
                &#34;28 Duty 3&#34;,
                &#34;29 Heigth 3&#34;,
                &#34;30 Canal 3&#34;,
            ]
        )
        if not self.config[&#34;Debug&#34;]:
            for i in range(1, 20):
                self.tree.header().hideSection(i)
            for i in range(21, 31):
                self.tree.header().hideSection(i)
            self.tree.setHeaderHidden(True)
            self.tree.header().setSectionResizeMode(0, QHeaderView.Stretch)
            self.tree.header().setStretchLastSection(False)
        self.tree.currentItemChanged.connect(self.actualize_window)
        self.tree_window.addWidget(self.tree)

        self.tree_switch_window = QStackedLayout()
        self.tree_second_window = QHBoxLayout()
        self.stim_buttons_container = QWidget()
        self.delete_item_button = QPushButton(&#34;Delete&#34;)
        self.delete_item_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;trash.png&#34;))
        )
        self.delete_item_button.clicked.connect(self.tree.delete_item)
        self.tree_second_window.addWidget(self.delete_item_button)
        self.add_brother_branch_button = QPushButton(&#34;Add Sibling&#34;)
        self.add_brother_branch_button.clicked.connect(self.tree.add_brother)
        self.add_brother_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-down.png&#34;))
        )
        self.tree_second_window.addWidget(self.add_brother_branch_button)
        self.add_child_branch_button = QPushButton(&#34;Add Child&#34;)
        self.add_child_branch_button.clicked.connect(self.tree.add_child)
        self.add_child_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-right.png&#34;))
        )
        self.tree_second_window.addWidget(self.add_child_branch_button)
        self.stim_buttons_container.setLayout(self.tree_second_window)
        self.tree_switch_window.addWidget(self.stim_buttons_container)

        self.tree_third_window = QHBoxLayout()
        self.import_button = QPushButton(&#34;Import Configuration&#34;)
        self.import_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;packge-import.png&#34;))
        )
        self.import_button.clicked.connect(self.import_config)
        self.tree_third_window.addWidget(self.import_button)
        self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
        self.new_branch_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;square-plus.png&#34;))
        )
        self.tree_third_window.addWidget(self.new_branch_button)
        self.stim_buttons_container2 = QWidget()
        self.stim_buttons_container2.setLayout(self.tree_third_window)
        self.tree_switch_window.addWidget(self.stim_buttons_container2)
        self.new_branch_button.clicked.connect(self.tree.first_stimulation)
        self.grid_layout.addLayout(self.tree_switch_window, 4, 0)

        self.tree_switch_window.setCurrentIndex(1)
        self.grid_layout.addLayout(self.tree_window, 3, 0)

        self.signal_adjust_label = QLabel(&#34;Signal Adjust&#34;)
        self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

        self.signal_adjust_superposed = QStackedLayout()
        self.stimulation_edit_layout = QVBoxLayout()
        self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

        self.canal_window = QVBoxLayout()
        self.canal_window.setAlignment(Qt.AlignLeft)
        self.canal_window.setAlignment(Qt.AlignTop)
        self.canal_window.setContentsMargins(0, 0, 0, 0)

        self.first_canal_check = QCheckBox()
        self.first_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_canal_check.setText(&#34;Canal 1&#34;)

        self.stim_type_cell = QComboBox()
        self.stim_type_cell.addItem(&#34;square&#34;)
        self.stim_type_cell.addItem(&#34;random-square&#34;)
        self.stim_type_cell.addItem(&#34;Third&#34;)
        self.stim_type_cell.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window = QHBoxLayout()
        self.stimulation_type_window.addWidget(self.first_canal_check)
        self.stimulation_type_window.addWidget(self.stim_type_cell)
        self.canal_window.addLayout(self.stimulation_type_window)

        self.different_signals_window = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window)

        self.second_canal_check = QCheckBox()
        self.second_canal_check.stateChanged.connect(self.canals_to_tree)
        self.second_canal_check.setText(&#34;Canal 2&#34;)

        self.stim_type_cell2 = QComboBox()
        self.stim_type_cell2.addItem(&#34;square&#34;)
        self.stim_type_cell2.addItem(&#34;random-square&#34;)
        self.stim_type_cell2.addItem(&#34;Third&#34;)
        self.stim_type_cell2.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window2 = QHBoxLayout()
        self.stimulation_type_window2.addWidget(self.second_canal_check)
        self.stimulation_type_window2.addWidget(self.stim_type_cell2)
        self.canal_window.addLayout(self.stimulation_type_window2)

        self.different_signals_window2 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window2)

        self.third_canal_check = QCheckBox()
        self.third_canal_check.stateChanged.connect(self.canals_to_tree)
        self.third_canal_check.setText(&#34;Canal 3&#34;)
        # self.canal_window.addWidget(self.third_canal_check)

        self.stim_type_cell3 = QComboBox()
        self.stim_type_cell3.addItem(&#34;square&#34;)
        self.stim_type_cell3.addItem(&#34;random-square&#34;)
        self.stim_type_cell3.addItem(&#34;Third&#34;)
        self.stim_type_cell3.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window3 = QHBoxLayout()
        self.stimulation_type_window3.addWidget(self.third_canal_check)
        # self.stimulation_type_window3.addWidget(self.stim_type_cell3)
        self.canal_window.addLayout(self.stimulation_type_window3)

        self.different_signals_window3 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window3)

        self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
        self.stimulation_name_cell = QLineEdit()
        self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
        self.stimulation_name_window = QHBoxLayout()
        self.stimulation_name_window.addWidget(self.stimulation_name_label)
        self.stimulation_name_window.addWidget(self.stimulation_name_cell)
        self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

        self.duration_window = QHBoxLayout()
        self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
        self.duration_window.addWidget(self.first_signal_type_duration_label)
        self.duration_cell = QLineEdit()
        self.duration_window.addWidget(self.duration_cell)
        self.duration_cell.setValidator(self.onlyFloat)
        self.duration_cell.textEdited.connect(self.signal_to_tree)
        self.stimulation_edit_layout.addLayout(self.duration_window)

        self.baseline_checkbox = QCheckBox(&#34;Baseline&#34;)
        self.baseline_checkbox.stateChanged.connect(self.canals_to_tree)
        if self.acquisition_mode:
            self.stimulation_edit_layout.addWidget(self.baseline_checkbox)
        self.stimulation_edit_layout.addLayout(self.canal_window)

        self.first_signal_type_window = QVBoxLayout()
        self.first_signal_type_window.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window.setAlignment(Qt.AlignTop)
        self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container = QWidget()
        self.first_signal_type_container.setLayout(self.first_signal_type_window)

        self.first_signal_type_window2 = QVBoxLayout()
        self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window2.setAlignment(Qt.AlignTop)
        self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container2 = QWidget()
        self.first_signal_type_container2.setLayout(self.first_signal_type_window2)

        self.first_signal_type_window3 = QVBoxLayout()
        self.first_signal_type_window3.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window3.setAlignment(Qt.AlignTop)
        self.first_signal_type_window3.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container3 = QWidget()
        self.first_signal_type_container3.setLayout(self.first_signal_type_window3)

        self.pulses_window = QHBoxLayout()
        self.pulses_label = QLabel(&#34;Pulses&#34;)
        self.pulses_window.addWidget(self.pulses_label)
        self.pulses_cell = QLineEdit()
        self.pulses_cell.setValidator(QIntValidator())
        self.pulses_cell.textEdited.connect(self.signal_to_tree)
        self.pulses_window.addWidget(self.pulses_cell)

        self.pulses_window2 = QHBoxLayout()
        self.pulses_label2 = QLabel(&#34;Pulses&#34;)
        self.pulses_window2.addWidget(self.pulses_label2)
        self.pulses_cell2 = QLineEdit()
        self.pulses_cell2.setValidator(QIntValidator())
        self.pulses_cell2.textEdited.connect(self.signal_to_tree)
        self.pulses_window2.addWidget(self.pulses_cell2)

        self.pulses_window3 = QHBoxLayout()
        self.pulses_label3 = QLabel(&#34;Pulses&#34;)
        self.pulses_window3.addWidget(self.pulses_label3)
        self.pulses_cell3 = QLineEdit()
        self.pulses_cell3.setValidator(QIntValidator())
        self.pulses_cell3.textEdited.connect(self.signal_to_tree)
        self.pulses_window3.addWidget(self.pulses_cell3)

        self.jitter_window = QHBoxLayout()
        self.jitter_label = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window.addWidget(self.jitter_label)
        self.jitter_cell = QLineEdit()
        self.jitter_cell.setValidator(self.onlyFloat)
        self.jitter_cell.setText(&#34;0&#34;)
        self.jitter_cell.textEdited.connect(self.signal_to_tree)
        self.jitter_window.addWidget(self.jitter_cell)

        self.jitter_window2 = QHBoxLayout()
        self.jitter_window2 = QHBoxLayout()
        self.jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window2.addWidget(self.jitter_label2)
        self.jitter_cell2 = QLineEdit()
        self.jitter_cell2.setValidator(self.onlyFloat)
        self.jitter_cell2.setText(&#34;0&#34;)
        self.jitter_cell2.textEdited.connect(self.signal_to_tree)
        self.jitter_window2.addWidget(self.jitter_cell2)

        self.jitter_window3 = QHBoxLayout()
        self.jitter_window3 = QHBoxLayout()
        self.jitter_label3 = QLabel(&#34;Jitter (s)&#34;)
        self.jitter_window3.addWidget(self.jitter_label3)
        self.jitter_cell3 = QLineEdit()
        self.jitter_cell3.setValidator(self.onlyFloat)
        self.jitter_cell3.setText(&#34;0&#34;)
        self.jitter_cell3.textEdited.connect(self.signal_to_tree)
        self.jitter_window3.addWidget(self.jitter_cell3)

        self.width_window = QHBoxLayout()
        self.width_label = QLabel(&#34;Width (s)&#34;)
        self.width_window.addWidget(self.width_label)
        self.width_cell = QLineEdit()
        self.width_cell.setValidator(self.onlyFloat)
        self.width_cell.setText(&#34;0&#34;)
        self.width_cell.textEdited.connect(self.signal_to_tree)
        self.width_window.addWidget(self.width_cell)

        self.width_window2 = QHBoxLayout()
        self.width_label2 = QLabel(&#34;Width (s)&#34;)
        self.width_window2.addWidget(self.width_label2)
        self.width_cell2 = QLineEdit()
        self.width_cell2.setValidator(self.onlyFloat)
        self.width_cell2.setText(&#34;0&#34;)
        self.width_cell2.textEdited.connect(self.signal_to_tree)
        self.width_window2.addWidget(self.width_cell2)

        self.width_window3 = QHBoxLayout()
        self.width_label3 = QLabel(&#34;Width (s)&#34;)
        self.width_window3.addWidget(self.width_label3)
        self.width_cell3 = QLineEdit()
        self.width_cell3.setValidator(self.onlyFloat)
        self.width_cell3.setText(&#34;0&#34;)
        self.width_cell3.textEdited.connect(self.signal_to_tree)
        self.width_window3.addWidget(self.width_cell3)

        self.first_signal_type_window.addLayout(self.pulses_window)
        self.first_signal_type_window.addLayout(self.width_window)
        self.first_signal_type_window.addLayout(self.jitter_window)

        self.first_signal_type_window2.addLayout(self.pulses_window2)
        self.first_signal_type_window2.addLayout(self.width_window2)
        self.first_signal_type_window2.addLayout(self.jitter_window2)

        self.first_signal_type_window3.addLayout(self.pulses_window3)
        self.first_signal_type_window3.addLayout(self.width_window3)
        self.first_signal_type_window3.addLayout(self.jitter_window3)
        # -------------------

        self.second_signal_type_window = QVBoxLayout()
        self.second_signal_type_container = QWidget()
        self.second_signal_type_window.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window.setAlignment(Qt.AlignTop)
        self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container.setLayout(self.second_signal_type_window)
        # self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.second_signal_type_window2 = QVBoxLayout()
        self.second_signal_type_container2 = QWidget()
        self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window2.setAlignment(Qt.AlignTop)
        self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

        self.second_signal_type_window3 = QVBoxLayout()
        self.second_signal_type_container3 = QWidget()
        self.second_signal_type_window3.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window3.setAlignment(Qt.AlignTop)
        self.second_signal_type_window3.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container3.setLayout(self.second_signal_type_window3)

        self.heigth_window = QHBoxLayout()
        self.heigth_label = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window.addWidget(self.heigth_label)
        self.heigth_cell = QLineEdit()
        self.heigth_cell.setValidator(self.onlyFloat)
        self.heigth_cell.textEdited.connect(self.signal_to_tree)
        self.heigth_window.addWidget(self.heigth_cell)

        self.heigth_window2 = QHBoxLayout()
        self.heigth_label2 = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window2.addWidget(self.heigth_label2)
        self.heigth_cell2 = QLineEdit()
        self.heigth_cell2.setValidator(self.onlyFloat)
        self.heigth_cell2.textEdited.connect(self.signal_to_tree)
        self.heigth_window2.addWidget(self.heigth_cell2)

        self.heigth_window3 = QHBoxLayout()
        self.heigth_label3 = QLabel(&#34;Heigth (V)&#34;)
        self.heigth_window3.addWidget(self.heigth_label3)
        self.heigth_cell3 = QLineEdit()
        self.heigth_cell3.setValidator(self.onlyFloat)
        self.heigth_cell3.textEdited.connect(self.signal_to_tree)
        self.heigth_window3.addWidget(self.heigth_cell3)

        self.frequency_window = QHBoxLayout()
        self.frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window.addWidget(self.frequency_label)
        self.frequency_cell = QLineEdit()
        self.frequency_cell.setValidator(self.onlyFloat)
        self.frequency_cell.textEdited.connect(self.signal_to_tree)
        self.frequency_window.addWidget(self.frequency_cell)

        self.frequency_window2 = QHBoxLayout()
        self.frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window2.addWidget(self.frequency_label2)
        self.frequency_cell2 = QLineEdit()
        self.frequency_cell2.setValidator(self.onlyFloat)
        self.frequency_cell2.textEdited.connect(self.signal_to_tree)
        self.frequency_window2.addWidget(self.frequency_cell2)

        self.frequency_window3 = QHBoxLayout()
        self.frequency_label3 = QLabel(&#34;Frequency (Hz)&#34;)
        self.frequency_window3.addWidget(self.frequency_label3)
        self.frequency_cell3 = QLineEdit()
        self.frequency_cell3.setValidator(self.onlyFloat)
        self.frequency_cell3.textEdited.connect(self.signal_to_tree)
        self.frequency_window3.addWidget(self.frequency_cell3)

        self.duty_window = QHBoxLayout()
        self.duty_label = QLabel(&#34;Duty (%)&#34;)
        self.duty_window.addWidget(self.duty_label)
        self.duty_cell = QLineEdit()
        self.duty_cell.setValidator(self.onlyFloat)
        self.duty_cell.textEdited.connect(self.signal_to_tree)
        self.duty_window.addWidget(self.duty_cell)

        self.duty_window2 = QHBoxLayout()
        self.duty_label2 = QLabel(&#34;Duty (%)&#34;)
        self.duty_window2.addWidget(self.duty_label2)
        self.duty_cell2 = QLineEdit()
        self.duty_cell2.setValidator(self.onlyFloat)
        self.duty_cell2.textEdited.connect(self.signal_to_tree)
        self.duty_window2.addWidget(self.duty_cell2)

        self.duty_window3 = QHBoxLayout()
        self.duty_label3 = QLabel(&#34;Duty (%)&#34;)
        self.duty_window3.addWidget(self.duty_label3)
        self.duty_cell3 = QLineEdit()
        self.duty_cell3.setValidator(self.onlyFloat)
        self.duty_cell3.textEdited.connect(self.signal_to_tree)
        self.duty_window3.addWidget(self.duty_cell3)

        self.second_signal_type_window.addLayout(self.heigth_window)
        self.second_signal_type_window.addLayout(self.frequency_window)
        self.second_signal_type_window.addLayout(self.duty_window)

        self.second_signal_type_window2.addLayout(self.heigth_window2)
        self.second_signal_type_window2.addLayout(self.frequency_window2)
        self.second_signal_type_window2.addLayout(self.duty_window2)

        # self.second_signal_type_window3.addLayout(self.heigth_window3)
        self.second_signal_type_window3.addLayout(self.frequency_window3)
        self.second_signal_type_window3.addLayout(self.duty_window3)

        # -------------------

        self.third_signal_type_window = QVBoxLayout()
        self.third_signal_type_container = QWidget()
        self.third_signal_type_container.setLayout(self.third_signal_type_window)

        self.third_signal_type_window2 = QVBoxLayout()
        self.third_signal_type_container2 = QWidget()
        self.third_signal_type_container2.setLayout(self.third_signal_type_window2)

        self.third_signal_type_window3 = QVBoxLayout()
        self.third_signal_type_container3 = QWidget()
        self.third_signal_type_container3.setLayout(self.third_signal_type_window3)

        self.third_signal_type_name = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window.addWidget(self.third_signal_type_name)

        self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

        self.third_signal_type_name3 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window3.addWidget(self.third_signal_type_name3)

        self.different_signals_window.addWidget(self.second_signal_type_container)
        self.different_signals_window.addWidget(self.first_signal_type_container)
        self.different_signals_window.addWidget(self.third_signal_type_container)

        self.different_signals_window2.addWidget(self.second_signal_type_container2)
        self.different_signals_window2.addWidget(self.first_signal_type_container2)
        self.different_signals_window2.addWidget(self.third_signal_type_container2)

        self.different_signals_window3.addWidget(self.second_signal_type_container3)
        self.different_signals_window3.addWidget(self.first_signal_type_container3)
        self.different_signals_window3.addWidget(self.third_signal_type_container3)

        self.stimulation_edit_container = QWidget()
        self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
        self.block_edit_layout = QVBoxLayout()
        self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
        self.block_edit_layout.setAlignment(Qt.AlignLeft)
        self.block_edit_layout.setAlignment(Qt.AlignTop)

        self.block_name_label = QLabel(&#34;Block Name&#34;)
        self.block_name_cell = QLineEdit()
        self.block_name_cell.textEdited.connect(self.name_to_tree)
        self.block_name_window = QHBoxLayout()
        self.block_name_window.addWidget(self.block_name_label)
        self.block_name_window.addWidget(self.block_name_cell)
        self.block_edit_layout.addLayout(self.block_name_window)

        self.block_iterations_window = QHBoxLayout()
        self.block_iterations_label = QLabel(&#34;Iterations&#34;)
        self.block_iterations_cell = QLineEdit()
        self.block_iterations_cell.setValidator(QIntValidator())
        self.block_iterations_cell.textEdited.connect(self.block_to_tree)
        self.block_iterations_window.addWidget(self.block_iterations_label)
        self.block_iterations_window.addWidget(self.block_iterations_cell)
        self.block_edit_layout.addLayout(self.block_iterations_window)

        self.block_delay_window = QHBoxLayout()
        self.block_delay_label = QLabel(&#34;Delay&#34;)
        self.block_delay_cell = QLineEdit()
        self.block_delay_cell.setValidator(self.onlyFloat)
        self.block_delay_cell.textEdited.connect(self.block_to_tree)
        self.block_delay_window = QHBoxLayout()
        self.block_delay_window.addWidget(self.block_delay_label)
        self.block_delay_window.addWidget(self.block_delay_cell)
        self.block_edit_layout.addLayout(self.block_delay_window)

        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_label = QLabel(&#34;Jitter&#34;)
        self.block_jitter_cell = QLineEdit()
        self.block_jitter_cell.setValidator(self.onlyFloat)
        self.block_jitter_cell.textEdited.connect(self.block_to_tree)
        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_window.addWidget(self.block_jitter_label)
        self.block_jitter_window.addWidget(self.block_jitter_cell)
        self.block_edit_layout.addLayout(self.block_jitter_window)

        self.block_edit_container = QWidget()
        self.block_edit_container.setLayout(self.block_edit_layout)
        self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
        self.signal_adjust_superposed.addWidget(self.block_edit_container)
        self.signal_adjust_superposed.addWidget(QLabel())
        self.signal_adjust_superposed.setCurrentIndex(2)
        self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

        self.signal_preview_label = QLabel(&#34;Signal Preview&#34;)
        self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.signal_preview_label, 2, 2)
        else:
            self.grid_layout.addWidget(self.signal_preview_label, 0, 2)

        self.buttons_main_window = QHBoxLayout()
        self.stop_button = QPushButton(&#34;Stop&#34;)
        self.stop_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-stop.png&#34;))
        )
        self.stop_button.clicked.connect(self.stop_while_running)
        self.stop_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.stop_button)
        self.run_button = QPushButton(&#34;Run&#34;)
        self.run_button.setIcon(
            QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-play.png&#34;))
        )
        self.run_button.clicked.connect(self.run)
        self.run_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.run_button)
        self.plot_window = PlotWindow(subplots=True)
        if self.acquisition_mode:
            self.grid_layout.addWidget(self.plot_window, 3, 2)
        else:
            self.grid_layout.addWidget(self.plot_window, 1, 2, 3, 1)
        self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
        self.open_daq_generation_thread()
        self.initialize_buttons()
        self.show()

    def deactivate_channels(self):
        &#34;&#34;&#34;Deactivate canal checkboxes if the baseline checkbox is checked&#34;&#34;&#34;
        if self.baseline_checkbox.isChecked():
            self.deactivate_buttons(
                [
                    self.first_canal_check,
                    self.second_canal_check,
                ]
            )
        else:
            self.activate_buttons(
                [
                    self.first_canal_check,
                    self.second_canal_check,
                ]
            )

    def adjust_exposure(self):
        &#34;&#34;&#34;Match the exposure of the image preview to the slider value&#34;&#34;&#34;
        self.max_exposure = self.exposure_slider.value()
        self.slider_values[self.preview_light_combo.currentText()][
            self.activation_map_combo.currentText()
        ] = self.max_exposure

    def set_trigger(self):
        &#34;&#34;&#34;Set the trigger for the DAQ&#34;&#34;&#34;
        if not self.acquisition_mode:
            self.run_button.setText(&#34;Run at Trigger&#34;)
            self.daq.set_trigger(self.ports[&#34;trigger&#34;])
        else:
            self.run_button.setText(&#34;Run&#34;)
            self.daq.remove_trigger()

    def import_config(self):
        &#34;&#34;&#34;Import a configuration file&#34;&#34;&#34;
        file = QFileDialog.getOpenFileName()[0]
        try:
            dictionary = get_dictionary(file)
            self.framerate_cell.setText(str(dictionary[&#34;Framerate&#34;]))
            self.exposure_cell.setText(str(dictionary[&#34;Exposition&#34;]))
            self.set_lights(dictionary[&#34;Lights&#34;])
            self.tree.create_tree_item(dictionary[&#34;Blocks&#34;])
            self.enable_run(self.tree.check_global_validity())
            self.tree.graph(self.tree.invisibleRootItem())
            self.draw()
        except Exception as err:
            print(err)

    def set_lights(self, lights):
        &#34;&#34;&#34;Set the lights&#34;&#34;&#34;
        for light in lights:
            if light == &#34;infrared&#34;:
                self.ir_checkbox.setChecked(True)
            elif light == &#34;red&#34;:
                self.red_checkbox.setChecked(True)
            elif light == &#34;green&#34;:
                self.green_checkbox.setChecked(True)
            elif light == &#34;blue&#34;:
                self.fluorescence_checkbox.setChecked(True)

    def run(self):
        &#34;&#34;&#34;Run the experiment&#34;&#34;&#34;
        if self.check_override():
            self.deactivate_buttons(buttons=self.enabled_buttons)
            self.master_block = self.tree.create_blocks()
            self.tree.baseline_values = []
            self.tree.graph(item=self.tree.invisibleRootItem())
            self.root_time, self.root_signal = (
                self.tree.x_values,
                [
                    self.tree.stim1_values,
                    self.tree.stim2_values,
                    self.tree.stim3_values,
                ],
            )
            self.draw(root=True)
            if self.acquisition_mode:
                self.actualize_daq()
                self.open_live_saving_thread()
                self.open_live_preview_thread()
                self.open_baseline_check_thread()
            else:
                self.daq.stop_signal = False
            self.open_signal_preview_thread()
            self.open_start_experiment_thread()

    def check_override(self):
        &#34;&#34;&#34;Check if experiment with the same name already exists&#34;&#34;&#34;
        if os.path.isfile(
            os.path.join(
                self.directory_cell.text(),
                self.experiment_name_cell.text(),
                f&#34;{self.experiment_name_cell.text()}-light_signal.npy&#34;,
            )
        ):
            button = QMessageBox.question(
                self,
                &#34;Files already exist&#34;,
                &#34;Files already exist. \n Do you want to override the existing files?&#34;,
            )
            if button == QMessageBox.Yes:
                return True
            else:
                return False
        else:
            return True

    def open_baseline_check_thread(self):
        &#34;&#34;&#34;Open the thread for the baseline check&#34;&#34;&#34;
        self.baseline_check_thread = Thread(target=self.check_baseline)
        self.baseline_check_thread.start()

    def check_baseline(self):
        &#34;&#34;&#34;Monitor the incoming frames and check if the baseline is reached&#34;&#34;&#34;
        if len(self.daq.lights) &gt; 0:
            self.camera.baseline_data = []
            self.camera.adding_frames = False
            self.camera.completed_baseline = False
            while self.daq.camera_signal is None:
                pass
            frames_acquired = frames_acquired_from_camera_signal(self.daq.camera_signal)
            baseline_indices = get_baseline_frame_indices(
                self.tree.baseline_values, frames_acquired
            )
            for baseline_pair in baseline_indices:
                while not self.daq.stop_signal:
                    try:
                        if (
                            not self.camera.adding_frames
                            and self.camera.frames_read &gt;= baseline_pair[0]
                        ):
                            self.camera.adding_frames = True
                        elif (
                            self.camera.adding_frames
                            and self.camera.frames_read &gt;= baseline_pair[1]
                        ):
                            self.camera.baseline_read_list = []
                            self.camera.average_baseline = average_baseline(
                                self.camera.baseline_data,
                                len(self.daq.lights),
                                self.camera.frames_read_list[0] % len(self.daq.lights),
                            )
                            self.camera.adding_frames = False
                            self.camera.baseline_frames = []
                            self.camera.baseline_completed = True
                            self.camera.frames_read_list = []
                            break
                    except Exception as err:
                        pass
                    time.sleep(0.01)

    def open_start_experiment_thread(self):
        &#34;&#34;&#34;Open the thread for the start of the experiment&#34;&#34;&#34;
        self.start_experiment_thread = Thread(target=self.run_stimulation)
        self.start_experiment_thread.start()

    def save_config(self):
        &#34;&#34;&#34;Save the current configuration to a JSON file&#34;&#34;&#34;
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        if folder != &#34;&#34;:
            self.master_block = self.tree.create_blocks()
            self.experiment = Experiment(
                self.master_block,
                int(self.framerate_cell.text()),
                int(self.exposure_cell.text()),
                self.mouse_id_cell.text(),
                folder,
                self.daq,
                name=self.experiment_name_cell.text(),
                config=self.config,
            )
            self.experiment.save_config(
                [int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;])]
            )

    def run_stimulation(self):
        &#34;&#34;&#34;Run the stimulation in parallel with the lights&#34;&#34;&#34;
        self.experiment = Experiment(
            self.master_block,
            int(self.framerate_cell.text()),
            int(self.exposure_cell.text()),
            self.mouse_id_cell.text(),
            self.directory_cell.text(),
            self.daq,
            name=self.experiment_name_cell.text(),
            config=self.config,
        )
        self.save_files_after_stop = True
        self.daq.launch(self.experiment.name, self.root_time, self.root_signal)
        # if (
        #    not self.daq.stop_signal
        #    and self.save_files_after_stop
        #    and self.directory_save_files_checkbox.isChecked()
        # ):
        if (
            self.save_files_after_stop
            and self.directory_save_files_checkbox.isChecked()
        ):
            try:
                print(&#34;this is the extent&#34;)
                print(self.roi_extent)
                self.experiment.save(self.roi_extent)
            except Exception as err:
                print(&#34;err after saving first&#34;)
                print(err)
                print(&#34;err before entering&#34;)
                self.experiment.save()
        self.stop()

    def open_live_saving_thread(self):
        &#34;&#34;&#34;Open the thread for the live saving&#34;&#34;&#34;
        self.live_save_thread = Thread(target=self.live_save)
        self.live_save_thread.start()

    def live_save(self):
        &#34;&#34;&#34;Save NPY chunked files when the number of frames is over 1200&#34;&#34;&#34;
        self.camera.file_index = 0
        self.camera.is_saving = False
        if self.directory_save_files_checkbox.isChecked():
            try:
                os.mkdir(
                    os.path.join(
                        self.directory_cell.text(), self.experiment_name_cell.text()
                    )
                )
                os.mkdir(
                    os.path.join(
                        self.directory_cell.text(),
                        self.experiment_name_cell.text(),
                        &#34;data&#34;,
                    )
                )
            except Exception as err:
                pass
            while self.camera.video_running is False and not self.camera.stop_signal:
                time.sleep(0.01)
                pass
            while self.camera.video_running is True:
                if len(self.camera.frames) &gt; 1200:
                    self.memory = self.camera.frames[:1200]
                    self.camera.frames = self.camera.frames[1200:]
                    if self.directory_save_files_checkbox.isChecked():
                        try:
                            self.memory = shrink_array(self.memory, self.roi_extent)
                        except Exception:
                            pass
                        self.camera.is_saving = True
                        np.save(
                            os.path.join(
                                self.directory_cell.text(),
                                self.experiment_name_cell.text(),
                                &#34;data&#34;,
                                f&#34;{self.camera.file_index}.npy&#34;,
                            ),
                            self.memory,
                        )
                        self.memory = None
                        self.camera.file_index += 1
                        self.camera.is_saving = False
                time.sleep(0.01)

    def open_live_preview_thread(self):
        &#34;&#34;&#34;Open the thread for the live preview&#34;&#34;&#34;
        self.live_preview_thread = Thread(target=self.start_live)
        self.live_preview_thread.start()

    def start_live(self):
        &#34;&#34;&#34;Start the live preview&#34;&#34;&#34;
        plt.ion()
        self.memory = []
        self.camera.baseline_completed = False
        if len(self.daq.lights) &gt; 0:
            try:
                while self.camera.video_running is False:
                    time.sleep(0.01)
                    pass
                while self.camera.video_running is True:
                    try:
                        if (
                            not self.camera.baseline_completed
                            or self.activation_map_combo.currentIndex() == 0
                        ):
                            self.plot_image.set(
                                array=self.camera.frames[
                                    self.live_preview_light_index :: len(
                                        self.daq.lights
                                    )
                                ][-1],
                                clim=(0, self.max_exposure),
                                cmap=&#34;binary_r&#34;,
                            )
                        elif self.activation_map_combo.currentIndex() == 1:
                            start_index = (
                                self.camera.baseline_read_list[0]
                                + self.live_preview_light_index
                            ) % len(self.daq.lights)
                            activation_map = (
                                self.camera.baseline_frames[
                                    start_index :: len(self.daq.lights)
                                ][-1]
                                - self.camera.average_baseline[
                                    self.live_preview_light_index
                                ]
                            ) / self.camera.average_baseline[
                                self.live_preview_light_index
                            ]
                            self.plot_image.set(
                                array=activation_map,
                                clim=(
                                    -self.max_exposure / 200,
                                    self.max_exposure / 200,
                                ),
                                cmap=&#34;seismic&#34;,
                            )
                        else:
                            start_index = (
                                self.camera.baseline_read_list[0]
                                + self.live_preview_light_index
                            ) % len(self.daq.lights)
                            activation_map = np.log(
                                (
                                    (
                                        self.camera.baseline_frames[
                                            start_index :: len(self.daq.lights)
                                        ][-1]
                                        - self.camera.average_baseline[
                                            self.live_preview_light_index
                                        ]
                                    )
                                    / self.camera.average_baseline[
                                        self.live_preview_light_index
                                    ]
                                )
                            )
                            self.plot_image.set(
                                array=activation_map,
                                clim=(
                                    -self.max_exposure / 2000,
                                    self.max_exposure / 2000,
                                ),
                                cmap=&#34;seismic&#34;,
                            )

                    except Exception as err:
                        print(err)
                        pass
                    time.sleep(0.04)
            except Exception as err:
                pass

    def stop_live(self):
        &#34;&#34;&#34;Stop the live preview&#34;&#34;&#34;
        self.camera.video_running = False

    def open_signal_preview_thread(self):
        &#34;&#34;&#34;Open the thread for the signal preview&#34;&#34;&#34;
        self.signal_preview_thread = Thread(target=self.actualize_progression)
        self.signal_preview_thread.start()

    def actualize_progression(self):
        &#34;&#34;&#34;Actualize the position of the progress bar&#34;&#34;&#34;
        plt.ion()
        while self.daq.stop_signal is False:
            try:
                if self.acquisition_mode:
                    position = self.camera.frames_read / int(self.framerate_cell.text())
                else:
                    position = time.time() - self.daq.start_time
                self.plot_window.vertical_lines[0].set_xdata(position)
                self.plot_window.vertical_lines[1].set_xdata(position)
                self.plot_window.vertical_lines[2].set_xdata(position)
                time.sleep(0.5)
            except Exception as err:
                time.sleep(0.5)
                pass

    def change_preview_light_channel(self):
        &#34;&#34;&#34;Change the light channel for the live preview&#34;&#34;&#34;
        self.live_preview_light_index = self.preview_light_combo.currentIndex()
        self.adjust_slider()

    def adjust_slider(self):
        &#34;&#34;&#34;Adjust the saturation slider using corresponding value in dictionary&#34;&#34;&#34;
        try:
            value = self.slider_values[self.preview_light_combo.currentText()][
                self.activation_map_combo.currentText()
            ]
            self.exposure_slider.setValue(value)
        except Exception:
            pass

    def open_daq_generation_thread(self):
        &#34;&#34;&#34;Open the thread for the DAQ generation&#34;&#34;&#34;
        self.daq_generation_thread = Thread(target=self.generate_daq)
        self.daq_generation_thread.start()

    def generate_daq(self):
        &#34;&#34;&#34;Generate the DAQ&#34;&#34;&#34;
        try:
            self.camera = Camera(self.ports[&#34;camera&#34;], &#34;name&#34;)
        except Exception:
            self.camera = None
        self.stimuli = [
            Instrument(self.ports[&#34;analog0&#34;], &#34;air-pump&#34;),
            Instrument(self.ports[&#34;analog1&#34;], &#34;air-pump2&#34;),
            Instrument(self.ports[&#34;co2&#34;], &#34;air-pump3&#34;),
        ]
        self.daq = DAQ(
            &#34;dev1&#34;,
            [],
            self.stimuli,
            self.camera,
            int(self.framerate_cell.text()),
            int(self.exposure_cell.text()) / 1000,
        )
        self.daq.close_all_lights(self.ports)
        self.daq_generated = True
        self.enable_run(self.tree.check_global_validity())

    def actualize_daq(self):
        &#34;&#34;&#34;Actualize the DAQ with the current settings&#34;&#34;&#34;
        try:
            self.daq.lights = []
            if self.ir_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;infrared&#34;], &#34;ir&#34;))
            if self.red_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;red&#34;], &#34;red&#34;))
            if self.green_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;green&#34;], &#34;green&#34;))
            if self.fluorescence_checkbox.isChecked():
                self.daq.lights.append(Instrument(self.ports[&#34;blue&#34;], &#34;blue&#34;))
            self.daq.framerate = int(self.framerate_cell.text())
            self.daq.exposure = int(self.exposure_cell.text()) / 1000
            self.camera.frames = []
            self.daq.stop_signal = False
        except Exception:
            pass

    def stop(self):
        &#34;&#34;&#34;Stop the experiment and reactivate the interface&#34;&#34;&#34;
        self.stop_live()
        self.activate_buttons(buttons=self.enabled_buttons)
        self.tree.setCurrentItem(self.tree.topLevelItem(0))
        try:
            self.daq.stop_signal = True
        except Exception:
            pass

    def stop_while_running(self):
        &#34;&#34;&#34;Stop the experiment while it is running&#34;&#34;&#34;
        if self.directory_save_files_checkbox.isChecked():
            self.stop_stimulation_dialog()
        self.stop()

    def stop_stimulation_dialog(self):
        &#34;&#34;&#34;Ask if user wants to keep the files after experiment is stopped&#34;&#34;&#34;
        button = QMessageBox.question(
            self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;
        )
        if button == QMessageBox.Yes:
            self.save_files_after_stop = True
        else:
            self.save_files_after_stop = False

    def show_buttons(self, buttons):
        &#34;&#34;&#34;Show the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setVisible(True)

    def hide_buttons(self, buttons):
        &#34;&#34;&#34;Hide the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setVisible(False)

    def activate_buttons(self, buttons):
        &#34;&#34;&#34;Activate the buttons in a list&#34;&#34;&#34;
        for button in buttons:
            button.setEnabled(True)
        if buttons == self.enabled_buttons:
            if self.directory_save_files_checkbox.isChecked():
                self.directory_choose_button.setEnabled(True)
            if self.roi_extent is None:
                self.reset_roi_button.setEnabled(False)
            else:
                self.set_roi_button.setEnabled(False)
            self.stop_button.setDisabled(True)

    def deactivate_buttons(self, buttons):
        &#34;&#34;&#34;Deactivate the buttons in a list&#34;&#34;&#34;
        if buttons == self.enabled_buttons:
            self.stop_button.setEnabled(True)
            self.tree.clearSelection()
        for button in buttons:
            button.setDisabled(True)

    def choose_directory(self):
        &#34;&#34;&#34;Choose the directory where to save the files&#34;&#34;&#34;
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        self.directory_cell.setText(folder)

    def enable_directory(self):
        &#34;&#34;&#34;Enable the directory cell&#34;&#34;&#34;
        self.files_saved = self.directory_save_files_checkbox.isChecked()
        self.directory_choose_button.setEnabled(self.files_saved)
        self.directory_cell.setEnabled(self.files_saved)

    def actualize_window(self):
        &#34;&#34;&#34;Actualize the &#39;Stimulation Edit&#39; and &#39;Signal Preview&#39; windows&#34;&#34;&#34;
        self.activate_buttons(
            [self.add_child_branch_button, self.add_brother_branch_button]
        )
        if self.tree.currentItem():
            self.tree_switch_window.setCurrentIndex(0)
        else:
            self.tree_switch_window.setCurrentIndex(1)
        try:
            if self.tree.currentItem().childCount() &gt; 0:
                self.signal_adjust_superposed.setCurrentIndex(1)
            else:
                self.signal_adjust_superposed.setCurrentIndex(0)
        except AttributeError:
            self.signal_adjust_superposed.setCurrentIndex(2)
        self.tree_to_name()
        self.tree_to_block()
        self.tree_to_type()
        self.tree_to_signal()
        self.tree_to_canal()
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def name_to_tree(self):
        &#34;&#34;&#34;Transfer the name of the current item from the cell to the tree&#34;&#34;&#34;
        branch = self.tree.currentItem()
        branch.setForeground(0, QBrush(QColor(0, 0, 0)))
        if branch.childCount() &gt; 0:
            branch.setText(0, self.block_name_cell.text())
        else:
            branch.setText(0, self.stimulation_name_cell.text())

    def tree_to_name(self):
        &#34;&#34;&#34;Transfer the name of the current item from the tree to the cell&#34;&#34;&#34;
        try:
            if self.tree.currentItem().childCount() &gt; 0:
                if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.block_name_cell.setText(self.tree.currentItem().text(0))
                else:
                    self.block_name_cell.setText(&#34;&#34;)
            else:
                if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.stimulation_name_cell.setText(self.tree.currentItem().text(0))
                else:
                    self.stimulation_name_cell.setText(&#34;&#34;)
        except AttributeError:
            pass

    def type_to_tree(self):
        &#34;&#34;&#34;Transfer the type of the current item from the cell to the tree&#34;&#34;&#34;
        self.enable_run(self.tree.check_global_validity())
        self.different_signals_window.setCurrentIndex(
            self.stim_type_cell.currentIndex()
        )
        self.different_signals_window2.setCurrentIndex(
            self.stim_type_cell2.currentIndex()
        )
        self.different_signals_window3.setCurrentIndex(
            self.stim_type_cell3.currentIndex()
        )
        try:
            self.tree.currentItem().setText(4, str(self.stim_type_cell.currentText()))
        except Exception:
            pass
        try:
            self.tree.currentItem().setText(11, str(self.stim_type_cell2.currentText()))
        except Exception:
            pass
        try:
            self.tree.currentItem().setText(23, str(self.stim_type_cell3.currentText()))
        except Exception:
            pass
        try:
            self.tree.graph(self.tree.currentItem(), current=True)
            self.draw()
        except Exception:
            pass

    def tree_to_type(self):
        &#34;&#34;&#34;Transfer the type of the current item from the tree to the cell&#34;&#34;&#34;
        dico = {&#34;square&#34;: 0, &#34;random-square&#34;: 1, &#34;Third&#34;: 2}
        try:
            self.stim_type_cell.setCurrentIndex(dico[self.tree.currentItem().text(4)])
        except Exception:
            self.stim_type_cell.setCurrentIndex(0)

        try:
            self.stim_type_cell2.setCurrentIndex(dico[self.tree.currentItem().text(11)])
        except Exception:
            self.stim_type_cell2.setCurrentIndex(0)

        try:
            self.stim_type_cell3.setCurrentIndex(dico[self.tree.currentItem().text(23)])
        except Exception:
            self.stim_type_cell3.setCurrentIndex(0)

    def signal_to_tree(self):
        &#34;&#34;&#34;Transfer the signal of the current item from the cell to the tree&#34;&#34;&#34;
        self.tree.currentItem().setText(6, self.duration_cell.text())
        self.tree.currentItem().setText(5, self.pulses_cell.text())
        self.tree.currentItem().setText(7, self.jitter_cell.text())
        self.tree.currentItem().setText(8, self.width_cell.text())
        self.tree.currentItem().setText(9, self.frequency_cell.text())
        self.tree.currentItem().setText(10, self.duty_cell.text())
        self.tree.currentItem().setText(21, self.heigth_cell.text())
        self.tree.currentItem().setText(12, self.pulses_cell2.text())
        self.tree.currentItem().setText(13, self.jitter_cell2.text())
        self.tree.currentItem().setText(14, self.width_cell2.text())
        self.tree.currentItem().setText(15, self.frequency_cell2.text())
        self.tree.currentItem().setText(16, self.duty_cell2.text())
        self.tree.currentItem().setText(22, self.heigth_cell2.text())
        self.tree.currentItem().setText(24, self.pulses_cell3.text())
        self.tree.currentItem().setText(25, self.jitter_cell3.text())
        self.tree.currentItem().setText(26, self.width_cell3.text())
        self.tree.currentItem().setText(27, self.frequency_cell3.text())
        self.tree.currentItem().setText(28, self.duty_cell3.text())
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def tree_to_signal(self):
        &#34;&#34;&#34;Transfer the signal of the current item from the tree to the cell&#34;&#34;&#34;
        try:
            self.pulses_cell.setText(self.tree.currentItem().text(5))
            self.duration_cell.setText(self.tree.currentItem().text(6))
            self.jitter_cell.setText(self.tree.currentItem().text(7))
            self.width_cell.setText(self.tree.currentItem().text(8))
            self.frequency_cell.setText(self.tree.currentItem().text(9))
            self.heigth_cell.setText(self.tree.currentItem().text(21))
            self.duty_cell.setText(self.tree.currentItem().text(10))
            self.pulses_cell2.setText(self.tree.currentItem().text(12))
            self.jitter_cell2.setText(self.tree.currentItem().text(13))
            self.width_cell2.setText(self.tree.currentItem().text(14))
            self.frequency_cell2.setText(self.tree.currentItem().text(15))
            self.heigth_cell2.setText(self.tree.currentItem().text(22))
            self.duty_cell2.setText(self.tree.currentItem().text(16))
            self.pulses_cell3.setText(self.tree.currentItem().text(24))
            self.jitter_cell3.setText(self.tree.currentItem().text(25))
            self.width_cell3.setText(self.tree.currentItem().text(26))
            self.frequency_cell3.setText(self.tree.currentItem().text(27))
            self.duty_cell3.setText(self.tree.currentItem().text(28))
        except Exception as err:
            pass

    def tree_to_block(self):
        &#34;&#34;&#34;Transfer the block attributes from the tree to the cells&#34;&#34;&#34;
        try:
            self.block_iterations_cell.setText(self.tree.currentItem().text(1))
            self.block_delay_cell.setText(self.tree.currentItem().text(2))
            self.block_jitter_cell.setText(self.tree.currentItem().text(3))
        except Exception:
            pass

    def block_to_tree(self):
        &#34;&#34;&#34;Transfer the block attributes from the cells to the tree&#34;&#34;&#34;
        self.tree.currentItem().setText(1, self.block_iterations_cell.text())
        self.tree.currentItem().setText(2, self.block_delay_cell.text())
        self.tree.currentItem().setText(3, self.block_jitter_cell.text())
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()

    def tree_to_canal(self):
        &#34;&#34;&#34;Transfer the canals attributes from the tree to the cells&#34;&#34;&#34;
        self.canal_running = True
        try:
            self.baseline_checkbox.setChecked(
                self.boolean(self.tree.currentItem().text(17))
            )
            self.first_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(18))
            )
            self.second_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(19))
            )
            self.third_canal_check.setChecked(
                self.boolean(self.tree.currentItem().text(30))
            )
            if self.baseline_checkbox.isChecked():
                self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
                self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
                self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
            else:
                self.activate_buttons(
                    [
                        self.first_canal_check,
                        self.second_canal_check,
                        self.third_canal_check,
                    ]
                )
            if self.first_canal_check.isChecked():
                self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.second_canal_check.isChecked():
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
            if self.third_canal_check.isChecked():
                self.activate_buttons(self.canal3buttons)
            else:
                self.deactivate_buttons(self.canal3buttons)
        except Exception as err:
            pass
        self.canal_running = False

    def canals_to_tree(self):
        &#34;&#34;&#34;Transfer the canals attributes from the cells to the tree&#34;&#34;&#34;
        self.baseline_checkbox.setEnabled(True)
        if not self.canal_running:
            if self.baseline_checkbox.isChecked():
                self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
                self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
                self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
            else:
                self.activate_buttons(self.canal1buttons + [self.first_canal_check])
                self.activate_buttons(self.canal2buttons + [self.second_canal_check])
                self.activate_buttons(self.canal3buttons + [self.third_canal_check])
            if self.first_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.second_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
            if self.third_canal_check.isChecked():
                self.baseline_checkbox.setEnabled(False)
                self.activate_buttons(self.canal3buttons)
            else:
                self.deactivate_buttons(self.canal3buttons)
            if (
                self.first_canal_check.isChecked()
                or self.second_canal_check.isChecked()
                or self.third_canal_check.isChecked()
            ):
                self.deactivate_buttons([self.baseline_checkbox])
            else:
                self.activate_buttons([self.baseline_checkbox])
            self.tree.currentItem().setText(17, str(self.baseline_checkbox.isChecked()))
            self.tree.currentItem().setText(18, str(self.first_canal_check.isChecked()))
            self.tree.currentItem().setText(
                19, str(self.second_canal_check.isChecked())
            )
            self.tree.currentItem().setText(30, str(self.third_canal_check.isChecked()))
            self.enable_run(self.tree.check_global_validity())
            self.tree.graph(self.tree.currentItem(), current=True)
            self.draw()

    def enable_run(self, boolean):
        &#34;&#34;&#34;Enable the run button&#34;&#34;&#34;
        if not self.daq_generated:
            boolean = False
        self.save_config_button.setEnabled(boolean)
        self.run_button.setEnabled(boolean)

    def disable_run(self):
        &#34;&#34;&#34;Disable the run button&#34;&#34;&#34;
        self.save_config_button.setDisabled(True)
        self.run_button.setDisabled(True)

    def count_lights(self):
        &#34;&#34;&#34;Return the number of lights and a list of their names&#34;&#34;&#34;
        count = 0
        text = []
        for checkbox in [
            self.ir_checkbox,
            self.red_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
        ]:
            if checkbox.isChecked():
                count += 1
                text.append(checkbox.text())
        return (count, text)

    def actualize_lights(self):
        &#34;&#34;&#34;Update the lights list in the combo box&#34;&#34;&#34;
        self.preview_light_combo.clear()
        if self.count_lights()[0] == 0:
            self.preview_light_combo.setEnabled(False)
        else:
            self.preview_light_combo.setEnabled(True)
        for i in range(4):
            if i &lt; self.count_lights()[0]:
                self.preview_light_combo.addItem(self.count_lights()[1][i])

    def boolean(self, string):
        &#34;&#34;&#34;Return a boolean from a string&#34;&#34;&#34;
        if string == &#34;True&#34;:
            return True
        return False

    def draw(self, root=False):
        &#34;&#34;&#34;Draw the sitmulation channels graph
        
        Args:
            root (bool, optional): If True, the graph includes a progress bar&#34;&#34;&#34;
        try:
            self.plot_window.clear()
            self.plot_window.plot(
                self.tree.x_values, self.tree.stim1_values, root, index=0
            )
            self.plot_window.plot(
                self.tree.x_values,
                self.tree.stim2_values,
                root,
                index=1,
            )
            self.plot_window.plot(
                self.tree.x_values,
                self.tree.stim3_values,
                root,
                index=2,
            )
            self.tree.x_values = []
            self.tree.stim1_values = []
            self.tree.stim2_values = []
            self.tree.stim3_values = []
            self.elapsed_time = 0
        except Exception as err:
            pass

    def set_roi(self):
        &#34;&#34;&#34;Set the ROI&#34;&#34;&#34;
        self.deactivate_buttons(buttons=self.enabled_buttons)
        self.stop_button.setEnabled(False)
        self.save_roi_button.setEnabled(False)
        self.roi_buttons.setCurrentIndex(1)

        def onselect_function(eclick, erelease):
            &#34;&#34;&#34;Save the ROI dimensions as attributes&#34;&#34;&#34;
            self.roi_extent = self.rect_selector.extents
            self.save_roi_button.setEnabled(True)

        self.rect_selector = RectangleSelector(
            self.plot_image.axes,
            onselect_function,
            drawtype=&#34;box&#34;,
            useblit=True,
            button=[1, 3],
            minspanx=5,
            minspany=5,
            spancoords=&#34;pixels&#34;,
            interactive=True,
        )

    def reset_roi(self):
        &#34;&#34;&#34;Reset the ROI&#34;&#34;&#34;
        plt.figure(self.image_view.figure.number)
        plt.xlim(0, int(1024 / self.config[&#34;Binning&#34;]))
        plt.ylim(0, int(1024 / self.config[&#34;Binning&#34;]))
        self.roi_extent = None
        self.reset_roi_button.setEnabled(False)

    def cancel_roi(self):
        &#34;&#34;&#34;Cancel the ROI selection&#34;&#34;&#34;
        self.activate_buttons(buttons=self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        self.rect_selector.clear()
        self.rect_selector = None

    def save_roi(self):
        &#34;&#34;&#34;Save the ROI&#34;&#34;&#34;
        self.activate_buttons(buttons=self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        plt.figure(self.image_view.figure.number)
        plt.ion()
        print(self.roi_extent)
        plt.xlim(self.roi_extent[0], self.roi_extent[1])
        plt.ylim(self.roi_extent[2], self.roi_extent[3])
        self.rect_selector.clear()
        self.rect_selector = None
        self.reset_roi_button.setEnabled(True)

    def verify_exposure(self):
        &#34;&#34;&#34;Verify if the exposure/framerate combination is valid&#34;&#34;&#34;
        try:
            boolean_check = (int(self.exposure_cell.text()) / 1000 + 0.0015) * int(
                self.framerate_cell.text()
            ) &lt; 1 and int(self.framerate_cell.text()) &lt;= 57
        except Exception:
            boolean_check = False
        self.exposure_warning_label.setHidden(boolean_check)

    def check_if_thread_is_alive(self):
        &#34;&#34;&#34;Check what threads are alive&#34;&#34;&#34;
        try:
            if self.live_preview_thread.is_alive():
                print(&#34;Live preview thread is alive&#34;)
            else:
                print(&#34;Live preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.start_experiment_thread.is_alive():
                print(&#34;Start Experiment thread is alive&#34;)
            else:
                print(&#34;Start experiment thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.daq_generation_thread.is_alive():
                print(&#34;Daq Generation thread is alive&#34;)
            else:
                print(&#34;Daq generation thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.signal_preview_thread.is_alive():
                print(&#34;Signal Preview thread is alive&#34;)
            else:
                print(&#34;Signal Preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.live_save_thread.is_alive():
                print(&#34;Live Save thread is alive&#34;)
            else:
                print(&#34;Live Save thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.baseline_check_thread.is_alive():
                print(&#34;Baseline check thread is alive&#34;)
            else:
                print(&#34;Baseline check thread is dead&#34;)
        except Exception as err:
            print(err)

    def initialize_buttons(self):
        &#34;&#34;&#34;Define list of buttons to activate/deactivate&#34;&#34;&#34;
        self.canal1buttons = [
            self.stim_type_cell,
            self.pulses_label,
            self.pulses_cell,
            self.width_label,
            self.width_cell,
            self.jitter_label,
            self.jitter_cell,
            self.frequency_label,
            self.frequency_cell,
            self.duty_label,
            self.duty_cell,
            self.heigth_cell,
            self.heigth_label,
        ]
        self.canal2buttons = [
            self.stim_type_cell2,
            self.pulses_label2,
            self.pulses_cell2,
            self.width_label2,
            self.width_cell2,
            self.jitter_label2,
            self.jitter_cell2,
            self.frequency_label2,
            self.frequency_cell2,
            self.duty_label2,
            self.duty_cell2,
            self.heigth_cell2,
            self.heigth_label2,
        ]
        self.canal3buttons = [
            self.stim_type_cell3,
            self.pulses_label3,
            self.pulses_cell3,
            self.width_label3,
            self.width_cell3,
            self.jitter_label3,
            self.jitter_cell3,
            self.frequency_label3,
            self.frequency_cell3,
            self.duty_label3,
            self.duty_cell3,
            self.heigth_cell3,
            self.heigth_label3,
        ]
        self.enabled_buttons = [
            self.run_button,
            self.experiment_name_cell,
            self.mouse_id_cell,
            self.directory_choose_button,
            self.set_roi_button,
            self.reset_roi_button,
            self.experiment_name,
            self.mouse_id_label,
            self.framerate_label,
            self.framerate_cell,
            self.exposure_cell,
            self.exposure_label,
            self.add_brother_branch_button,
            self.add_child_branch_button,
            self.delete_item_button,
            self.red_checkbox,
            self.ir_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
            self.stimulation_name_label,
            self.directory_save_files_checkbox,
            self.stimulation_name_cell,
            self.stim_type_cell,
            self.stim_type_cell2,
            self.first_canal_check,
            self.second_canal_check,
            self.first_signal_type_duration_label,
            self.duration_cell,
            self.pulses_label,
            self.pulses_cell,
            self.width_label,
            self.width_cell,
            self.jitter_label,
            self.jitter_cell,
            self.frequency_label,
            self.frequency_cell,
            self.heigth_label,
            self.heigth_cell,
            self.duty_label,
            self.duty_cell,
            self.pulses_label2,
            self.pulses_cell2,
            self.width_label2,
            self.width_cell2,
            self.jitter_label2,
            self.jitter_cell2,
            self.frequency_label2,
            self.frequency_cell2,
            self.heigth_label2,
            self.heigth_cell2,
            self.duty_label2,
            self.duty_cell2,
            self.third_canal_check,
            self.stim_type_cell3,
            self.pulses_label3,
            self.pulses_cell3,
            self.width_label3,
            self.width_cell3,
            self.jitter_label3,
            self.jitter_cell3,
            self.frequency_label3,
            self.frequency_cell3,
            self.duty_label3,
            self.duty_cell3,
            self.heigth_cell3,
            self.heigth_label3,
            self.block_iterations_label,
            self.block_iterations_cell,
            self.block_delay_label,
            self.block_delay_cell,
            self.block_jitter_label,
            self.block_jitter_cell,
            self.block_name_label,
            self.block_name_cell,
            self.activate_live_preview_button,
            self.deactivate_live_preview_button,
            self.tree,
        ]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons"><code class="name flex">
<span>def <span class="ident">activate_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"><p>Activate the buttons in a list</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_buttons(self, buttons):
    &#34;&#34;&#34;Activate the buttons in a list&#34;&#34;&#34;
    for button in buttons:
        button.setEnabled(True)
    if buttons == self.enabled_buttons:
        if self.directory_save_files_checkbox.isChecked():
            self.directory_choose_button.setEnabled(True)
        if self.roi_extent is None:
            self.reset_roi_button.setEnabled(False)
        else:
            self.set_roi_button.setEnabled(False)
        self.stop_button.setDisabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq"><code class="name flex">
<span>def <span class="ident">actualize_daq</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Actualize the DAQ with the current settings</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_daq(self):
    &#34;&#34;&#34;Actualize the DAQ with the current settings&#34;&#34;&#34;
    try:
        self.daq.lights = []
        if self.ir_checkbox.isChecked():
            self.daq.lights.append(Instrument(self.ports[&#34;infrared&#34;], &#34;ir&#34;))
        if self.red_checkbox.isChecked():
            self.daq.lights.append(Instrument(self.ports[&#34;red&#34;], &#34;red&#34;))
        if self.green_checkbox.isChecked():
            self.daq.lights.append(Instrument(self.ports[&#34;green&#34;], &#34;green&#34;))
        if self.fluorescence_checkbox.isChecked():
            self.daq.lights.append(Instrument(self.ports[&#34;blue&#34;], &#34;blue&#34;))
        self.daq.framerate = int(self.framerate_cell.text())
        self.daq.exposure = int(self.exposure_cell.text()) / 1000
        self.camera.frames = []
        self.daq.stop_signal = False
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_lights"><code class="name flex">
<span>def <span class="ident">actualize_lights</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Update the lights list in the combo box</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_lights(self):
    &#34;&#34;&#34;Update the lights list in the combo box&#34;&#34;&#34;
    self.preview_light_combo.clear()
    if self.count_lights()[0] == 0:
        self.preview_light_combo.setEnabled(False)
    else:
        self.preview_light_combo.setEnabled(True)
    for i in range(4):
        if i &lt; self.count_lights()[0]:
            self.preview_light_combo.addItem(self.count_lights()[1][i])</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_progression"><code class="name flex">
<span>def <span class="ident">actualize_progression</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Actualize the position of the progress bar</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_progression(self):
    &#34;&#34;&#34;Actualize the position of the progress bar&#34;&#34;&#34;
    plt.ion()
    while self.daq.stop_signal is False:
        try:
            if self.acquisition_mode:
                position = self.camera.frames_read / int(self.framerate_cell.text())
            else:
                position = time.time() - self.daq.start_time
            self.plot_window.vertical_lines[0].set_xdata(position)
            self.plot_window.vertical_lines[1].set_xdata(position)
            self.plot_window.vertical_lines[2].set_xdata(position)
            time.sleep(0.5)
        except Exception as err:
            time.sleep(0.5)
            pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_window"><code class="name flex">
<span>def <span class="ident">actualize_window</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Actualize the 'Stimulation Edit' and 'Signal Preview' windows</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_window(self):
    &#34;&#34;&#34;Actualize the &#39;Stimulation Edit&#39; and &#39;Signal Preview&#39; windows&#34;&#34;&#34;
    self.activate_buttons(
        [self.add_child_branch_button, self.add_brother_branch_button]
    )
    if self.tree.currentItem():
        self.tree_switch_window.setCurrentIndex(0)
    else:
        self.tree_switch_window.setCurrentIndex(1)
    try:
        if self.tree.currentItem().childCount() &gt; 0:
            self.signal_adjust_superposed.setCurrentIndex(1)
        else:
            self.signal_adjust_superposed.setCurrentIndex(0)
    except AttributeError:
        self.signal_adjust_superposed.setCurrentIndex(2)
    self.tree_to_name()
    self.tree_to_block()
    self.tree_to_type()
    self.tree_to_signal()
    self.tree_to_canal()
    self.tree.graph(self.tree.currentItem(), current=True)
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.adjust_exposure"><code class="name flex">
<span>def <span class="ident">adjust_exposure</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Match the exposure of the image preview to the slider value</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjust_exposure(self):
    &#34;&#34;&#34;Match the exposure of the image preview to the slider value&#34;&#34;&#34;
    self.max_exposure = self.exposure_slider.value()
    self.slider_values[self.preview_light_combo.currentText()][
        self.activation_map_combo.currentText()
    ] = self.max_exposure</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.adjust_slider"><code class="name flex">
<span>def <span class="ident">adjust_slider</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Adjust the saturation slider using corresponding value in dictionary</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjust_slider(self):
    &#34;&#34;&#34;Adjust the saturation slider using corresponding value in dictionary&#34;&#34;&#34;
    try:
        value = self.slider_values[self.preview_light_combo.currentText()][
            self.activation_map_combo.currentText()
        ]
        self.exposure_slider.setValue(value)
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree"><code class="name flex">
<span>def <span class="ident">block_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the block attributes from the cells to the tree</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def block_to_tree(self):
    &#34;&#34;&#34;Transfer the block attributes from the cells to the tree&#34;&#34;&#34;
    self.tree.currentItem().setText(1, self.block_iterations_cell.text())
    self.tree.currentItem().setText(2, self.block_delay_cell.text())
    self.tree.currentItem().setText(3, self.block_jitter_cell.text())
    self.enable_run(self.tree.check_global_validity())
    self.tree.graph(self.tree.currentItem(), current=True)
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.boolean"><code class="name flex">
<span>def <span class="ident">boolean</span></span>(<span>self, string)</span>
</code></dt>
<dd>
<div class="desc"><p>Return a boolean from a string</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def boolean(self, string):
    &#34;&#34;&#34;Return a boolean from a string&#34;&#34;&#34;
    if string == &#34;True&#34;:
        return True
    return False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree"><code class="name flex">
<span>def <span class="ident">canals_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the canals attributes from the cells to the tree</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def canals_to_tree(self):
    &#34;&#34;&#34;Transfer the canals attributes from the cells to the tree&#34;&#34;&#34;
    self.baseline_checkbox.setEnabled(True)
    if not self.canal_running:
        if self.baseline_checkbox.isChecked():
            self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
            self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
            self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
        else:
            self.activate_buttons(self.canal1buttons + [self.first_canal_check])
            self.activate_buttons(self.canal2buttons + [self.second_canal_check])
            self.activate_buttons(self.canal3buttons + [self.third_canal_check])
        if self.first_canal_check.isChecked():
            self.baseline_checkbox.setEnabled(False)
            self.activate_buttons(self.canal1buttons)
        else:
            self.deactivate_buttons(self.canal1buttons)
        if self.second_canal_check.isChecked():
            self.baseline_checkbox.setEnabled(False)
            self.activate_buttons(self.canal2buttons)
        else:
            self.deactivate_buttons(self.canal2buttons)
        if self.third_canal_check.isChecked():
            self.baseline_checkbox.setEnabled(False)
            self.activate_buttons(self.canal3buttons)
        else:
            self.deactivate_buttons(self.canal3buttons)
        if (
            self.first_canal_check.isChecked()
            or self.second_canal_check.isChecked()
            or self.third_canal_check.isChecked()
        ):
            self.deactivate_buttons([self.baseline_checkbox])
        else:
            self.activate_buttons([self.baseline_checkbox])
        self.tree.currentItem().setText(17, str(self.baseline_checkbox.isChecked()))
        self.tree.currentItem().setText(18, str(self.first_canal_check.isChecked()))
        self.tree.currentItem().setText(
            19, str(self.second_canal_check.isChecked())
        )
        self.tree.currentItem().setText(30, str(self.third_canal_check.isChecked()))
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi"><code class="name flex">
<span>def <span class="ident">cancel_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Cancel the ROI selection</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel_roi(self):
    &#34;&#34;&#34;Cancel the ROI selection&#34;&#34;&#34;
    self.activate_buttons(buttons=self.enabled_buttons)
    self.roi_buttons.setCurrentIndex(0)
    self.rect_selector.clear()
    self.rect_selector = None</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel"><code class="name flex">
<span>def <span class="ident">change_preview_light_channel</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Change the light channel for the live preview</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def change_preview_light_channel(self):
    &#34;&#34;&#34;Change the light channel for the live preview&#34;&#34;&#34;
    self.live_preview_light_index = self.preview_light_combo.currentIndex()
    self.adjust_slider()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_baseline"><code class="name flex">
<span>def <span class="ident">check_baseline</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Monitor the incoming frames and check if the baseline is reached</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_baseline(self):
    &#34;&#34;&#34;Monitor the incoming frames and check if the baseline is reached&#34;&#34;&#34;
    if len(self.daq.lights) &gt; 0:
        self.camera.baseline_data = []
        self.camera.adding_frames = False
        self.camera.completed_baseline = False
        while self.daq.camera_signal is None:
            pass
        frames_acquired = frames_acquired_from_camera_signal(self.daq.camera_signal)
        baseline_indices = get_baseline_frame_indices(
            self.tree.baseline_values, frames_acquired
        )
        for baseline_pair in baseline_indices:
            while not self.daq.stop_signal:
                try:
                    if (
                        not self.camera.adding_frames
                        and self.camera.frames_read &gt;= baseline_pair[0]
                    ):
                        self.camera.adding_frames = True
                    elif (
                        self.camera.adding_frames
                        and self.camera.frames_read &gt;= baseline_pair[1]
                    ):
                        self.camera.baseline_read_list = []
                        self.camera.average_baseline = average_baseline(
                            self.camera.baseline_data,
                            len(self.daq.lights),
                            self.camera.frames_read_list[0] % len(self.daq.lights),
                        )
                        self.camera.adding_frames = False
                        self.camera.baseline_frames = []
                        self.camera.baseline_completed = True
                        self.camera.frames_read_list = []
                        break
                except Exception as err:
                    pass
                time.sleep(0.01)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive"><code class="name flex">
<span>def <span class="ident">check_if_thread_is_alive</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Check what threads are alive</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_if_thread_is_alive(self):
    &#34;&#34;&#34;Check what threads are alive&#34;&#34;&#34;
    try:
        if self.live_preview_thread.is_alive():
            print(&#34;Live preview thread is alive&#34;)
        else:
            print(&#34;Live preview thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.start_experiment_thread.is_alive():
            print(&#34;Start Experiment thread is alive&#34;)
        else:
            print(&#34;Start experiment thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.daq_generation_thread.is_alive():
            print(&#34;Daq Generation thread is alive&#34;)
        else:
            print(&#34;Daq generation thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.signal_preview_thread.is_alive():
            print(&#34;Signal Preview thread is alive&#34;)
        else:
            print(&#34;Signal Preview thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.live_save_thread.is_alive():
            print(&#34;Live Save thread is alive&#34;)
        else:
            print(&#34;Live Save thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.baseline_check_thread.is_alive():
            print(&#34;Baseline check thread is alive&#34;)
        else:
            print(&#34;Baseline check thread is dead&#34;)
    except Exception as err:
        print(err)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_override"><code class="name flex">
<span>def <span class="ident">check_override</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Check if experiment with the same name already exists</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_override(self):
    &#34;&#34;&#34;Check if experiment with the same name already exists&#34;&#34;&#34;
    if os.path.isfile(
        os.path.join(
            self.directory_cell.text(),
            self.experiment_name_cell.text(),
            f&#34;{self.experiment_name_cell.text()}-light_signal.npy&#34;,
        )
    ):
        button = QMessageBox.question(
            self,
            &#34;Files already exist&#34;,
            &#34;Files already exist. \n Do you want to override the existing files?&#34;,
        )
        if button == QMessageBox.Yes:
            return True
        else:
            return False
    else:
        return True</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.choose_directory"><code class="name flex">
<span>def <span class="ident">choose_directory</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Choose the directory where to save the files</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def choose_directory(self):
    &#34;&#34;&#34;Choose the directory where to save the files&#34;&#34;&#34;
    folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
    self.directory_cell.setText(folder)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.closeEvent"><code class="name flex">
<span>def <span class="ident">closeEvent</span></span>(<span>self, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Stop all processes when closing the application</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def closeEvent(self, *args, **kwargs):
    &#34;&#34;&#34;Stop all processes when closing the application&#34;&#34;&#34;
    self.video_running = False
    try:
        self.camera.stop_signal = True
        self.camera.video_running = False
        self.daq.stop_signal = True
        self.daq.camera.cam.stop_acquisition()
        print(&#34;Program Closed&#34;)
    except Exception as err:
        pass
    self.check_if_thread_is_alive()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.count_lights"><code class="name flex">
<span>def <span class="ident">count_lights</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Return the number of lights and a list of their names</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def count_lights(self):
    &#34;&#34;&#34;Return the number of lights and a list of their names&#34;&#34;&#34;
    count = 0
    text = []
    for checkbox in [
        self.ir_checkbox,
        self.red_checkbox,
        self.green_checkbox,
        self.fluorescence_checkbox,
    ]:
        if checkbox.isChecked():
            count += 1
            text.append(checkbox.text())
    return (count, text)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons"><code class="name flex">
<span>def <span class="ident">deactivate_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"><p>Deactivate the buttons in a list</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deactivate_buttons(self, buttons):
    &#34;&#34;&#34;Deactivate the buttons in a list&#34;&#34;&#34;
    if buttons == self.enabled_buttons:
        self.stop_button.setEnabled(True)
        self.tree.clearSelection()
    for button in buttons:
        button.setDisabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_channels"><code class="name flex">
<span>def <span class="ident">deactivate_channels</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Deactivate canal checkboxes if the baseline checkbox is checked</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deactivate_channels(self):
    &#34;&#34;&#34;Deactivate canal checkboxes if the baseline checkbox is checked&#34;&#34;&#34;
    if self.baseline_checkbox.isChecked():
        self.deactivate_buttons(
            [
                self.first_canal_check,
                self.second_canal_check,
            ]
        )
    else:
        self.activate_buttons(
            [
                self.first_canal_check,
                self.second_canal_check,
            ]
        )</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.disable_run"><code class="name flex">
<span>def <span class="ident">disable_run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Disable the run button</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def disable_run(self):
    &#34;&#34;&#34;Disable the run button&#34;&#34;&#34;
    self.save_config_button.setDisabled(True)
    self.run_button.setDisabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.draw"><code class="name flex">
<span>def <span class="ident">draw</span></span>(<span>self, root=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Draw the sitmulation channels graph</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>root</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If True, the graph includes a progress bar</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def draw(self, root=False):
    &#34;&#34;&#34;Draw the sitmulation channels graph
    
    Args:
        root (bool, optional): If True, the graph includes a progress bar&#34;&#34;&#34;
    try:
        self.plot_window.clear()
        self.plot_window.plot(
            self.tree.x_values, self.tree.stim1_values, root, index=0
        )
        self.plot_window.plot(
            self.tree.x_values,
            self.tree.stim2_values,
            root,
            index=1,
        )
        self.plot_window.plot(
            self.tree.x_values,
            self.tree.stim3_values,
            root,
            index=2,
        )
        self.tree.x_values = []
        self.tree.stim1_values = []
        self.tree.stim2_values = []
        self.tree.stim3_values = []
        self.elapsed_time = 0
    except Exception as err:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.enable_directory"><code class="name flex">
<span>def <span class="ident">enable_directory</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Enable the directory cell</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def enable_directory(self):
    &#34;&#34;&#34;Enable the directory cell&#34;&#34;&#34;
    self.files_saved = self.directory_save_files_checkbox.isChecked()
    self.directory_choose_button.setEnabled(self.files_saved)
    self.directory_cell.setEnabled(self.files_saved)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.enable_run"><code class="name flex">
<span>def <span class="ident">enable_run</span></span>(<span>self, boolean)</span>
</code></dt>
<dd>
<div class="desc"><p>Enable the run button</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def enable_run(self, boolean):
    &#34;&#34;&#34;Enable the run button&#34;&#34;&#34;
    if not self.daq_generated:
        boolean = False
    self.save_config_button.setEnabled(boolean)
    self.run_button.setEnabled(boolean)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.generate_daq"><code class="name flex">
<span>def <span class="ident">generate_daq</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Generate the DAQ</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def generate_daq(self):
    &#34;&#34;&#34;Generate the DAQ&#34;&#34;&#34;
    try:
        self.camera = Camera(self.ports[&#34;camera&#34;], &#34;name&#34;)
    except Exception:
        self.camera = None
    self.stimuli = [
        Instrument(self.ports[&#34;analog0&#34;], &#34;air-pump&#34;),
        Instrument(self.ports[&#34;analog1&#34;], &#34;air-pump2&#34;),
        Instrument(self.ports[&#34;co2&#34;], &#34;air-pump3&#34;),
    ]
    self.daq = DAQ(
        &#34;dev1&#34;,
        [],
        self.stimuli,
        self.camera,
        int(self.framerate_cell.text()),
        int(self.exposure_cell.text()) / 1000,
    )
    self.daq.close_all_lights(self.ports)
    self.daq_generated = True
    self.enable_run(self.tree.check_global_validity())</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.handler"><code class="name flex">
<span>def <span class="ident">handler</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Ignore Qt messages</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handler(*args, **kwargs):
    &#34;&#34;&#34;Ignore Qt messages&#34;&#34;&#34;
    pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons"><code class="name flex">
<span>def <span class="ident">hide_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"><p>Hide the buttons in a list</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def hide_buttons(self, buttons):
    &#34;&#34;&#34;Hide the buttons in a list&#34;&#34;&#34;
    for button in buttons:
        button.setVisible(False)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.import_config"><code class="name flex">
<span>def <span class="ident">import_config</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Import a configuration file</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def import_config(self):
    &#34;&#34;&#34;Import a configuration file&#34;&#34;&#34;
    file = QFileDialog.getOpenFileName()[0]
    try:
        dictionary = get_dictionary(file)
        self.framerate_cell.setText(str(dictionary[&#34;Framerate&#34;]))
        self.exposure_cell.setText(str(dictionary[&#34;Exposition&#34;]))
        self.set_lights(dictionary[&#34;Lights&#34;])
        self.tree.create_tree_item(dictionary[&#34;Blocks&#34;])
        self.enable_run(self.tree.check_global_validity())
        self.tree.graph(self.tree.invisibleRootItem())
        self.draw()
    except Exception as err:
        print(err)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.initUI"><code class="name flex">
<span>def <span class="ident">initUI</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize the user interface</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def initUI(self):
    &#34;&#34;&#34;Initialize the user interface&#34;&#34;&#34;
    self.title = &#34;Widefield Imaging Aquisition&#34;
    self.dimensions = (10, 10, 640, 480)
    self.setWindowTitle(self.title)
    self.setGeometry(*self.dimensions)

    # self.grid_layout = QGridLayout()
    # self.setLayout(self.grid_layout)
    self.grid_layout.setAlignment(Qt.AlignTop)

    self.experiment_settings_label = QLabel(&#34;Experiment Settings&#34;)
    self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

    self.experiment_settings_main_window = QVBoxLayout()
    self.experiment_name_window = QHBoxLayout()
    self.experiment_name = QLabel(&#34;Experiment Name&#34;)
    self.experiment_name_window.addWidget(self.experiment_name)
    self.experiment_name_cell = QLineEdit()
    self.experiment_name_window.addWidget(self.experiment_name_cell)
    self.experiment_settings_main_window.addLayout(self.experiment_name_window)

    self.mouse_id_window = QHBoxLayout()
    self.mouse_id_label = QLabel(&#34;Mouse ID&#34;)
    self.mouse_id_window.addWidget(self.mouse_id_label)
    self.mouse_id_cell = QLineEdit()
    self.mouse_id_window.addWidget(self.mouse_id_cell)
    self.experiment_settings_main_window.addLayout(self.mouse_id_window)

    self.framerate_exposure_window = QHBoxLayout()
    self.exposure_window = QHBoxLayout()
    self.exposure_label = QLabel(&#34;Exposure (ms)&#34;)
    self.exposure_window.addWidget(self.exposure_label)
    self.exposure_cell = QLineEdit(&#34;10&#34;)
    self.exposure_cell.setValidator(self.onlyExposure)
    self.exposure_cell.textChanged.connect(self.verify_exposure)
    self.exposure_window.addWidget(self.exposure_cell)
    self.framerate_exposure_window.addLayout(self.exposure_window)
    self.framerate_window = QHBoxLayout()
    self.framerate_label = QLabel(&#34;Framerate&#34;)
    self.framerate_window.addWidget(self.framerate_label)
    self.framerate_cell = QLineEdit(&#34;30&#34;)
    self.framerate_cell.setValidator(self.onlyFramerate)
    self.framerate_cell.textChanged.connect(self.verify_exposure)
    self.framerate_window.addWidget(self.framerate_cell)
    self.framerate_exposure_window.addLayout(self.framerate_window)

    if self.acquisition_mode:
        self.experiment_settings_main_window.addLayout(
            self.framerate_exposure_window
        )

    self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
    if self.acquisition_mode:
        self.experiment_settings_main_window.addWidget(self.exposure_warning_label)
    self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
    self.exposure_warning_label.setHidden(True)

    self.directory_window = QHBoxLayout()
    self.directory_save_files_checkbox = QCheckBox()
    self.directory_save_files_checkbox.setText(&#34;Save&#34;)
    self.directory_save_files_checkbox.stateChanged.connect(self.enable_directory)
    self.directory_window.addWidget(self.directory_save_files_checkbox)
    self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
    self.directory_choose_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;))
    )
    # self.directory_choose_button.setIcon(QIcon(os.path.join(&#34;gui&#34;, &#34;icons&#34;, &#34;folder-plus.png&#34;)))
    self.directory_choose_button.setDisabled(True)
    self.directory_choose_button.clicked.connect(self.choose_directory)
    self.directory_window.addWidget(self.directory_choose_button)
    self.directory_cell = QLineEdit(&#34;&#34;)
    self.directory_cell.setReadOnly(True)
    self.directory_window.addWidget(self.directory_cell)
    self.experiment_settings_main_window.addLayout(self.directory_window)
    self.trigger_checkbox = QCheckBox(&#34;Wait for Trigger&#34;)
    self.trigger_activated = False
    self.trigger_checkbox.stateChanged.connect(self.set_trigger)
    # self.experiment_settings_main_window.addWidget(self.trigger_checkbox)

    self.save_config_button = QPushButton(&#34;Save Config&#34;)
    self.save_config_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;save.png&#34;))
    )
    self.save_config_button.clicked.connect(self.save_config)
    self.save_config_button.setEnabled(False)
    self.experiment_settings_main_window.addWidget(self.save_config_button)

    self.experiment_settings_main_window.addStretch()

    if self.acquisition_mode:
        self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)
    else:
        self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0, 1, 2)

    self.image_settings_label = QLabel(&#34;Image Settings&#34;)
    self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    if self.acquisition_mode:
        self.grid_layout.addWidget(self.image_settings_label, 0, 1)

    self.image_settings_main_window = QVBoxLayout()
    self.image_settings_main_window.setAlignment(Qt.AlignLeft)
    self.image_settings_main_window.setAlignment(Qt.AlignTop)

    self.image_settings_second_window = QHBoxLayout()
    self.ir_checkbox = QCheckBox(&#34;Infrared&#34;)
    self.ir_checkbox.stateChanged.connect(self.actualize_lights)
    self.image_settings_second_window.addWidget(self.ir_checkbox)
    self.red_checkbox = QCheckBox(&#34;Red&#34;)
    self.red_checkbox.stateChanged.connect(self.actualize_lights)
    self.image_settings_second_window.addWidget(self.red_checkbox)
    self.green_checkbox = QCheckBox(&#34;Green&#34;)
    self.green_checkbox.stateChanged.connect(self.actualize_lights)
    self.image_settings_second_window.addWidget(self.green_checkbox)
    self.fluorescence_checkbox = QCheckBox(&#34;Blue&#34;)
    self.fluorescence_checkbox.stateChanged.connect(self.actualize_lights)
    self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

    self.light_channel_layout = QHBoxLayout()
    self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
    self.light_channel_layout.addWidget(self.preview_light_label)
    self.preview_light_combo = QComboBox()
    self.preview_light_combo.setEnabled(False)
    self.preview_light_combo.currentIndexChanged.connect(
        self.change_preview_light_channel
    )
    self.light_channel_layout.addWidget(self.preview_light_combo)
    # self.activation_map_checkbox = QCheckBox(&#34;Show Activation Map&#34;)
    self.activation_map_window = QHBoxLayout()
    self.activation_map_label = QLabel(&#34;Activation Map&#34;)
    self.activation_map_window.addWidget(self.activation_map_label)
    self.activation_map_combo = QComboBox()
    self.activation_map_combo.addItem(&#34;None&#34;)
    self.activation_map_combo.addItem(&#34;Normal&#34;)
    self.activation_map_combo.addItem(&#34;Logarithmic&#34;)
    self.activation_map_combo.currentIndexChanged.connect(self.adjust_slider)
    self.activation_map_window.addWidget(self.activation_map_combo)

    self.image_settings_main_window.addLayout(self.image_settings_second_window)
    self.image_settings_main_window.addLayout(self.light_channel_layout)
    # self.image_settings_main_window.addWidget(self.activation_map_checkbox)
    self.image_settings_main_window.addLayout(self.activation_map_window)

    self.roi_buttons = QStackedLayout()

    self.roi_layout1 = QHBoxLayout()
    self.roi_layout1.setAlignment(Qt.AlignLeft)
    self.roi_layout1.setAlignment(Qt.AlignTop)
    self.roi_layout1.setContentsMargins(0, 0, 0, 0)
    self.reset_roi_button = QPushButton()
    self.reset_roi_button.setText(&#34;Reset ROI&#34;)
    self.reset_roi_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-out-area.png&#34;))
    )
    # self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
    self.reset_roi_button.setEnabled(False)
    self.reset_roi_button.clicked.connect(self.reset_roi)
    self.roi_layout1.addWidget(self.reset_roi_button)

    self.set_roi_button = QPushButton()
    self.set_roi_button.setText(&#34;Set ROI&#34;)
    self.set_roi_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-in-area.png&#34;))
    )
    self.set_roi_button.clicked.connect(self.set_roi)
    self.roi_layout1.addWidget(self.set_roi_button)
    self.roi_layout1_container = QWidget()
    self.roi_layout1_container.setLayout(self.roi_layout1)

    self.roi_layout2 = QHBoxLayout()
    self.roi_layout2.setAlignment(Qt.AlignLeft)
    self.roi_layout2.setAlignment(Qt.AlignTop)
    self.roi_layout2.setContentsMargins(0, 0, 0, 0)
    self.cancel_roi_button = QPushButton()
    self.cancel_roi_button.setText(&#34;Cancel&#34;)
    self.cancel_roi_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-cancel.png&#34;))
    )
    self.cancel_roi_button.clicked.connect(self.cancel_roi)
    self.roi_layout2.addWidget(self.cancel_roi_button)

    self.save_roi_button = QPushButton()
    self.save_roi_button.setText(&#34;Save ROI&#34;)
    self.save_roi_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;zoom-check.png&#34;))
    )
    self.save_roi_button.clicked.connect(self.save_roi)
    self.roi_layout2.addWidget(self.save_roi_button)
    self.roi_layout2_container = QWidget()
    self.roi_layout2_container.setLayout(self.roi_layout2)

    if self.acquisition_mode:
        self.roi_buttons.addWidget(self.roi_layout1_container)
        self.roi_buttons.addWidget(self.roi_layout2_container)
        self.image_settings_main_window.addLayout(self.roi_buttons)

    self.exposure_slider = QSlider(Qt.Horizontal, self)
    self.exposure_slider.setRange(0, 4096)
    self.exposure_slider.setValue(4096)
    self.exposure_slider.valueChanged.connect(self.adjust_exposure)
    self.image_settings_main_window.addWidget(self.exposure_slider)
    self.image_settings_main_window.addStretch()

    self.activate_live_preview_button = QPushButton()
    self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
    self.activate_live_preview_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video.png&#34;))
    )
    self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

    self.deactivate_live_preview_button = QPushButton()
    self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
    self.deactivate_live_preview_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;video-off.png&#34;))
    )
    self.deactivate_live_preview_button.clicked.connect(self.stop_live)

    self.image_settings_main_window.addStretch()

    if self.acquisition_mode:
        self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

    self.live_preview_label = QLabel(&#34;Live Preview&#34;)
    self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    self.image_view = PlotWindow()
    self.plot_image = plt.imshow(
        np.zeros(
            (int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;]))
        ),
        cmap=&#34;binary_r&#34;,
        vmin=0,
        vmax=4096,
        origin=&#34;lower&#34;,
    )
    self.plot_image.axes.get_xaxis().set_visible(False)
    self.plot_image.axes.axes.get_yaxis().set_visible(False)

    if self.acquisition_mode:
        self.grid_layout.addWidget(self.live_preview_label, 0, 2)
        self.grid_layout.addWidget(self.image_view, 1, 2)

    self.tree_label = QLabel(&#34;Stimulation Tree&#34;)
    self.tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    self.grid_layout.addWidget(self.tree_label, 2, 0)

    self.tree_window = QVBoxLayout()
    self.tree = Tree()
    self.tree.setHeaderLabels(
        [
            &#34;0 Name&#34;,
            &#34;1 Iterations&#34;,
            &#34;2 Delay&#34;,
            &#34;3 Jitter&#34;,
            &#34;4 Type&#34;,
            &#34;5 Pulses&#34;,
            &#34;6 Duration&#34;,
            &#34;7 Jitter&#34;,
            &#34;8 Width&#34;,
            &#34;9 Frequency&#34;,
            &#34;10 Duty&#34;,
            &#34;11 Type2&#34;,
            &#34;12 Pulses 2&#34;,
            &#34;13 Jitter 2&#34;,
            &#34;14 Width 2&#34;,
            &#34;15 Frequency 2&#34;,
            &#34;16 Duty 2&#34;,
            &#34;17 Baseline&#34;,
            &#34;18 Canal 1&#34;,
            &#34;19 Canal 2&#34;,
            &#34;20 Valid&#34;,
            &#34;21 Heigth&#34;,
            &#34;22 Heigth 2&#34;,
            &#34;23 Type 3&#34;,
            &#34;24 Pulses 3&#34;,
            &#34;25 Jitter 3&#34;,
            &#34;26 Width 3&#34;,
            &#34;27 Frequency 3&#34;,
            &#34;28 Duty 3&#34;,
            &#34;29 Heigth 3&#34;,
            &#34;30 Canal 3&#34;,
        ]
    )
    if not self.config[&#34;Debug&#34;]:
        for i in range(1, 20):
            self.tree.header().hideSection(i)
        for i in range(21, 31):
            self.tree.header().hideSection(i)
        self.tree.setHeaderHidden(True)
        self.tree.header().setSectionResizeMode(0, QHeaderView.Stretch)
        self.tree.header().setStretchLastSection(False)
    self.tree.currentItemChanged.connect(self.actualize_window)
    self.tree_window.addWidget(self.tree)

    self.tree_switch_window = QStackedLayout()
    self.tree_second_window = QHBoxLayout()
    self.stim_buttons_container = QWidget()
    self.delete_item_button = QPushButton(&#34;Delete&#34;)
    self.delete_item_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;trash.png&#34;))
    )
    self.delete_item_button.clicked.connect(self.tree.delete_item)
    self.tree_second_window.addWidget(self.delete_item_button)
    self.add_brother_branch_button = QPushButton(&#34;Add Sibling&#34;)
    self.add_brother_branch_button.clicked.connect(self.tree.add_brother)
    self.add_brother_branch_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-down.png&#34;))
    )
    self.tree_second_window.addWidget(self.add_brother_branch_button)
    self.add_child_branch_button = QPushButton(&#34;Add Child&#34;)
    self.add_child_branch_button.clicked.connect(self.tree.add_child)
    self.add_child_branch_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;arrow-bar-right.png&#34;))
    )
    self.tree_second_window.addWidget(self.add_child_branch_button)
    self.stim_buttons_container.setLayout(self.tree_second_window)
    self.tree_switch_window.addWidget(self.stim_buttons_container)

    self.tree_third_window = QHBoxLayout()
    self.import_button = QPushButton(&#34;Import Configuration&#34;)
    self.import_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;packge-import.png&#34;))
    )
    self.import_button.clicked.connect(self.import_config)
    self.tree_third_window.addWidget(self.import_button)
    self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
    self.new_branch_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;square-plus.png&#34;))
    )
    self.tree_third_window.addWidget(self.new_branch_button)
    self.stim_buttons_container2 = QWidget()
    self.stim_buttons_container2.setLayout(self.tree_third_window)
    self.tree_switch_window.addWidget(self.stim_buttons_container2)
    self.new_branch_button.clicked.connect(self.tree.first_stimulation)
    self.grid_layout.addLayout(self.tree_switch_window, 4, 0)

    self.tree_switch_window.setCurrentIndex(1)
    self.grid_layout.addLayout(self.tree_window, 3, 0)

    self.signal_adjust_label = QLabel(&#34;Signal Adjust&#34;)
    self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

    self.signal_adjust_superposed = QStackedLayout()
    self.stimulation_edit_layout = QVBoxLayout()
    self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

    self.canal_window = QVBoxLayout()
    self.canal_window.setAlignment(Qt.AlignLeft)
    self.canal_window.setAlignment(Qt.AlignTop)
    self.canal_window.setContentsMargins(0, 0, 0, 0)

    self.first_canal_check = QCheckBox()
    self.first_canal_check.stateChanged.connect(self.canals_to_tree)
    self.first_canal_check.setText(&#34;Canal 1&#34;)

    self.stim_type_cell = QComboBox()
    self.stim_type_cell.addItem(&#34;square&#34;)
    self.stim_type_cell.addItem(&#34;random-square&#34;)
    self.stim_type_cell.addItem(&#34;Third&#34;)
    self.stim_type_cell.currentIndexChanged.connect(self.type_to_tree)
    self.stimulation_type_window = QHBoxLayout()
    self.stimulation_type_window.addWidget(self.first_canal_check)
    self.stimulation_type_window.addWidget(self.stim_type_cell)
    self.canal_window.addLayout(self.stimulation_type_window)

    self.different_signals_window = QStackedLayout()
    self.canal_window.addLayout(self.different_signals_window)

    self.second_canal_check = QCheckBox()
    self.second_canal_check.stateChanged.connect(self.canals_to_tree)
    self.second_canal_check.setText(&#34;Canal 2&#34;)

    self.stim_type_cell2 = QComboBox()
    self.stim_type_cell2.addItem(&#34;square&#34;)
    self.stim_type_cell2.addItem(&#34;random-square&#34;)
    self.stim_type_cell2.addItem(&#34;Third&#34;)
    self.stim_type_cell2.currentIndexChanged.connect(self.type_to_tree)
    self.stimulation_type_window2 = QHBoxLayout()
    self.stimulation_type_window2.addWidget(self.second_canal_check)
    self.stimulation_type_window2.addWidget(self.stim_type_cell2)
    self.canal_window.addLayout(self.stimulation_type_window2)

    self.different_signals_window2 = QStackedLayout()
    self.canal_window.addLayout(self.different_signals_window2)

    self.third_canal_check = QCheckBox()
    self.third_canal_check.stateChanged.connect(self.canals_to_tree)
    self.third_canal_check.setText(&#34;Canal 3&#34;)
    # self.canal_window.addWidget(self.third_canal_check)

    self.stim_type_cell3 = QComboBox()
    self.stim_type_cell3.addItem(&#34;square&#34;)
    self.stim_type_cell3.addItem(&#34;random-square&#34;)
    self.stim_type_cell3.addItem(&#34;Third&#34;)
    self.stim_type_cell3.currentIndexChanged.connect(self.type_to_tree)
    self.stimulation_type_window3 = QHBoxLayout()
    self.stimulation_type_window3.addWidget(self.third_canal_check)
    # self.stimulation_type_window3.addWidget(self.stim_type_cell3)
    self.canal_window.addLayout(self.stimulation_type_window3)

    self.different_signals_window3 = QStackedLayout()
    self.canal_window.addLayout(self.different_signals_window3)

    self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
    self.stimulation_name_cell = QLineEdit()
    self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
    self.stimulation_name_window = QHBoxLayout()
    self.stimulation_name_window.addWidget(self.stimulation_name_label)
    self.stimulation_name_window.addWidget(self.stimulation_name_cell)
    self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

    self.duration_window = QHBoxLayout()
    self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
    self.duration_window.addWidget(self.first_signal_type_duration_label)
    self.duration_cell = QLineEdit()
    self.duration_window.addWidget(self.duration_cell)
    self.duration_cell.setValidator(self.onlyFloat)
    self.duration_cell.textEdited.connect(self.signal_to_tree)
    self.stimulation_edit_layout.addLayout(self.duration_window)

    self.baseline_checkbox = QCheckBox(&#34;Baseline&#34;)
    self.baseline_checkbox.stateChanged.connect(self.canals_to_tree)
    if self.acquisition_mode:
        self.stimulation_edit_layout.addWidget(self.baseline_checkbox)
    self.stimulation_edit_layout.addLayout(self.canal_window)

    self.first_signal_type_window = QVBoxLayout()
    self.first_signal_type_window.setAlignment(Qt.AlignLeft)
    self.first_signal_type_window.setAlignment(Qt.AlignTop)
    self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
    self.first_signal_type_container = QWidget()
    self.first_signal_type_container.setLayout(self.first_signal_type_window)

    self.first_signal_type_window2 = QVBoxLayout()
    self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
    self.first_signal_type_window2.setAlignment(Qt.AlignTop)
    self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
    self.first_signal_type_container2 = QWidget()
    self.first_signal_type_container2.setLayout(self.first_signal_type_window2)

    self.first_signal_type_window3 = QVBoxLayout()
    self.first_signal_type_window3.setAlignment(Qt.AlignLeft)
    self.first_signal_type_window3.setAlignment(Qt.AlignTop)
    self.first_signal_type_window3.setContentsMargins(0, 0, 0, 0)
    self.first_signal_type_container3 = QWidget()
    self.first_signal_type_container3.setLayout(self.first_signal_type_window3)

    self.pulses_window = QHBoxLayout()
    self.pulses_label = QLabel(&#34;Pulses&#34;)
    self.pulses_window.addWidget(self.pulses_label)
    self.pulses_cell = QLineEdit()
    self.pulses_cell.setValidator(QIntValidator())
    self.pulses_cell.textEdited.connect(self.signal_to_tree)
    self.pulses_window.addWidget(self.pulses_cell)

    self.pulses_window2 = QHBoxLayout()
    self.pulses_label2 = QLabel(&#34;Pulses&#34;)
    self.pulses_window2.addWidget(self.pulses_label2)
    self.pulses_cell2 = QLineEdit()
    self.pulses_cell2.setValidator(QIntValidator())
    self.pulses_cell2.textEdited.connect(self.signal_to_tree)
    self.pulses_window2.addWidget(self.pulses_cell2)

    self.pulses_window3 = QHBoxLayout()
    self.pulses_label3 = QLabel(&#34;Pulses&#34;)
    self.pulses_window3.addWidget(self.pulses_label3)
    self.pulses_cell3 = QLineEdit()
    self.pulses_cell3.setValidator(QIntValidator())
    self.pulses_cell3.textEdited.connect(self.signal_to_tree)
    self.pulses_window3.addWidget(self.pulses_cell3)

    self.jitter_window = QHBoxLayout()
    self.jitter_label = QLabel(&#34;Jitter (s)&#34;)
    self.jitter_window.addWidget(self.jitter_label)
    self.jitter_cell = QLineEdit()
    self.jitter_cell.setValidator(self.onlyFloat)
    self.jitter_cell.setText(&#34;0&#34;)
    self.jitter_cell.textEdited.connect(self.signal_to_tree)
    self.jitter_window.addWidget(self.jitter_cell)

    self.jitter_window2 = QHBoxLayout()
    self.jitter_window2 = QHBoxLayout()
    self.jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
    self.jitter_window2.addWidget(self.jitter_label2)
    self.jitter_cell2 = QLineEdit()
    self.jitter_cell2.setValidator(self.onlyFloat)
    self.jitter_cell2.setText(&#34;0&#34;)
    self.jitter_cell2.textEdited.connect(self.signal_to_tree)
    self.jitter_window2.addWidget(self.jitter_cell2)

    self.jitter_window3 = QHBoxLayout()
    self.jitter_window3 = QHBoxLayout()
    self.jitter_label3 = QLabel(&#34;Jitter (s)&#34;)
    self.jitter_window3.addWidget(self.jitter_label3)
    self.jitter_cell3 = QLineEdit()
    self.jitter_cell3.setValidator(self.onlyFloat)
    self.jitter_cell3.setText(&#34;0&#34;)
    self.jitter_cell3.textEdited.connect(self.signal_to_tree)
    self.jitter_window3.addWidget(self.jitter_cell3)

    self.width_window = QHBoxLayout()
    self.width_label = QLabel(&#34;Width (s)&#34;)
    self.width_window.addWidget(self.width_label)
    self.width_cell = QLineEdit()
    self.width_cell.setValidator(self.onlyFloat)
    self.width_cell.setText(&#34;0&#34;)
    self.width_cell.textEdited.connect(self.signal_to_tree)
    self.width_window.addWidget(self.width_cell)

    self.width_window2 = QHBoxLayout()
    self.width_label2 = QLabel(&#34;Width (s)&#34;)
    self.width_window2.addWidget(self.width_label2)
    self.width_cell2 = QLineEdit()
    self.width_cell2.setValidator(self.onlyFloat)
    self.width_cell2.setText(&#34;0&#34;)
    self.width_cell2.textEdited.connect(self.signal_to_tree)
    self.width_window2.addWidget(self.width_cell2)

    self.width_window3 = QHBoxLayout()
    self.width_label3 = QLabel(&#34;Width (s)&#34;)
    self.width_window3.addWidget(self.width_label3)
    self.width_cell3 = QLineEdit()
    self.width_cell3.setValidator(self.onlyFloat)
    self.width_cell3.setText(&#34;0&#34;)
    self.width_cell3.textEdited.connect(self.signal_to_tree)
    self.width_window3.addWidget(self.width_cell3)

    self.first_signal_type_window.addLayout(self.pulses_window)
    self.first_signal_type_window.addLayout(self.width_window)
    self.first_signal_type_window.addLayout(self.jitter_window)

    self.first_signal_type_window2.addLayout(self.pulses_window2)
    self.first_signal_type_window2.addLayout(self.width_window2)
    self.first_signal_type_window2.addLayout(self.jitter_window2)

    self.first_signal_type_window3.addLayout(self.pulses_window3)
    self.first_signal_type_window3.addLayout(self.width_window3)
    self.first_signal_type_window3.addLayout(self.jitter_window3)
    # -------------------

    self.second_signal_type_window = QVBoxLayout()
    self.second_signal_type_container = QWidget()
    self.second_signal_type_window.setAlignment(Qt.AlignLeft)
    self.second_signal_type_window.setAlignment(Qt.AlignTop)
    self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
    self.second_signal_type_container.setLayout(self.second_signal_type_window)
    # self.stimulation_edit_layout.addLayout(self.different_signals_window)

    self.second_signal_type_window2 = QVBoxLayout()
    self.second_signal_type_container2 = QWidget()
    self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
    self.second_signal_type_window2.setAlignment(Qt.AlignTop)
    self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
    self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

    self.second_signal_type_window3 = QVBoxLayout()
    self.second_signal_type_container3 = QWidget()
    self.second_signal_type_window3.setAlignment(Qt.AlignLeft)
    self.second_signal_type_window3.setAlignment(Qt.AlignTop)
    self.second_signal_type_window3.setContentsMargins(0, 0, 0, 0)
    self.second_signal_type_container3.setLayout(self.second_signal_type_window3)

    self.heigth_window = QHBoxLayout()
    self.heigth_label = QLabel(&#34;Heigth (V)&#34;)
    self.heigth_window.addWidget(self.heigth_label)
    self.heigth_cell = QLineEdit()
    self.heigth_cell.setValidator(self.onlyFloat)
    self.heigth_cell.textEdited.connect(self.signal_to_tree)
    self.heigth_window.addWidget(self.heigth_cell)

    self.heigth_window2 = QHBoxLayout()
    self.heigth_label2 = QLabel(&#34;Heigth (V)&#34;)
    self.heigth_window2.addWidget(self.heigth_label2)
    self.heigth_cell2 = QLineEdit()
    self.heigth_cell2.setValidator(self.onlyFloat)
    self.heigth_cell2.textEdited.connect(self.signal_to_tree)
    self.heigth_window2.addWidget(self.heigth_cell2)

    self.heigth_window3 = QHBoxLayout()
    self.heigth_label3 = QLabel(&#34;Heigth (V)&#34;)
    self.heigth_window3.addWidget(self.heigth_label3)
    self.heigth_cell3 = QLineEdit()
    self.heigth_cell3.setValidator(self.onlyFloat)
    self.heigth_cell3.textEdited.connect(self.signal_to_tree)
    self.heigth_window3.addWidget(self.heigth_cell3)

    self.frequency_window = QHBoxLayout()
    self.frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
    self.frequency_window.addWidget(self.frequency_label)
    self.frequency_cell = QLineEdit()
    self.frequency_cell.setValidator(self.onlyFloat)
    self.frequency_cell.textEdited.connect(self.signal_to_tree)
    self.frequency_window.addWidget(self.frequency_cell)

    self.frequency_window2 = QHBoxLayout()
    self.frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
    self.frequency_window2.addWidget(self.frequency_label2)
    self.frequency_cell2 = QLineEdit()
    self.frequency_cell2.setValidator(self.onlyFloat)
    self.frequency_cell2.textEdited.connect(self.signal_to_tree)
    self.frequency_window2.addWidget(self.frequency_cell2)

    self.frequency_window3 = QHBoxLayout()
    self.frequency_label3 = QLabel(&#34;Frequency (Hz)&#34;)
    self.frequency_window3.addWidget(self.frequency_label3)
    self.frequency_cell3 = QLineEdit()
    self.frequency_cell3.setValidator(self.onlyFloat)
    self.frequency_cell3.textEdited.connect(self.signal_to_tree)
    self.frequency_window3.addWidget(self.frequency_cell3)

    self.duty_window = QHBoxLayout()
    self.duty_label = QLabel(&#34;Duty (%)&#34;)
    self.duty_window.addWidget(self.duty_label)
    self.duty_cell = QLineEdit()
    self.duty_cell.setValidator(self.onlyFloat)
    self.duty_cell.textEdited.connect(self.signal_to_tree)
    self.duty_window.addWidget(self.duty_cell)

    self.duty_window2 = QHBoxLayout()
    self.duty_label2 = QLabel(&#34;Duty (%)&#34;)
    self.duty_window2.addWidget(self.duty_label2)
    self.duty_cell2 = QLineEdit()
    self.duty_cell2.setValidator(self.onlyFloat)
    self.duty_cell2.textEdited.connect(self.signal_to_tree)
    self.duty_window2.addWidget(self.duty_cell2)

    self.duty_window3 = QHBoxLayout()
    self.duty_label3 = QLabel(&#34;Duty (%)&#34;)
    self.duty_window3.addWidget(self.duty_label3)
    self.duty_cell3 = QLineEdit()
    self.duty_cell3.setValidator(self.onlyFloat)
    self.duty_cell3.textEdited.connect(self.signal_to_tree)
    self.duty_window3.addWidget(self.duty_cell3)

    self.second_signal_type_window.addLayout(self.heigth_window)
    self.second_signal_type_window.addLayout(self.frequency_window)
    self.second_signal_type_window.addLayout(self.duty_window)

    self.second_signal_type_window2.addLayout(self.heigth_window2)
    self.second_signal_type_window2.addLayout(self.frequency_window2)
    self.second_signal_type_window2.addLayout(self.duty_window2)

    # self.second_signal_type_window3.addLayout(self.heigth_window3)
    self.second_signal_type_window3.addLayout(self.frequency_window3)
    self.second_signal_type_window3.addLayout(self.duty_window3)

    # -------------------

    self.third_signal_type_window = QVBoxLayout()
    self.third_signal_type_container = QWidget()
    self.third_signal_type_container.setLayout(self.third_signal_type_window)

    self.third_signal_type_window2 = QVBoxLayout()
    self.third_signal_type_container2 = QWidget()
    self.third_signal_type_container2.setLayout(self.third_signal_type_window2)

    self.third_signal_type_window3 = QVBoxLayout()
    self.third_signal_type_container3 = QWidget()
    self.third_signal_type_container3.setLayout(self.third_signal_type_window3)

    self.third_signal_type_name = QLabel(&#34;signal3&#34;)
    self.third_signal_type_window.addWidget(self.third_signal_type_name)

    self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
    self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

    self.third_signal_type_name3 = QLabel(&#34;signal3&#34;)
    self.third_signal_type_window3.addWidget(self.third_signal_type_name3)

    self.different_signals_window.addWidget(self.second_signal_type_container)
    self.different_signals_window.addWidget(self.first_signal_type_container)
    self.different_signals_window.addWidget(self.third_signal_type_container)

    self.different_signals_window2.addWidget(self.second_signal_type_container2)
    self.different_signals_window2.addWidget(self.first_signal_type_container2)
    self.different_signals_window2.addWidget(self.third_signal_type_container2)

    self.different_signals_window3.addWidget(self.second_signal_type_container3)
    self.different_signals_window3.addWidget(self.first_signal_type_container3)
    self.different_signals_window3.addWidget(self.third_signal_type_container3)

    self.stimulation_edit_container = QWidget()
    self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
    self.block_edit_layout = QVBoxLayout()
    self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
    self.block_edit_layout.setAlignment(Qt.AlignLeft)
    self.block_edit_layout.setAlignment(Qt.AlignTop)

    self.block_name_label = QLabel(&#34;Block Name&#34;)
    self.block_name_cell = QLineEdit()
    self.block_name_cell.textEdited.connect(self.name_to_tree)
    self.block_name_window = QHBoxLayout()
    self.block_name_window.addWidget(self.block_name_label)
    self.block_name_window.addWidget(self.block_name_cell)
    self.block_edit_layout.addLayout(self.block_name_window)

    self.block_iterations_window = QHBoxLayout()
    self.block_iterations_label = QLabel(&#34;Iterations&#34;)
    self.block_iterations_cell = QLineEdit()
    self.block_iterations_cell.setValidator(QIntValidator())
    self.block_iterations_cell.textEdited.connect(self.block_to_tree)
    self.block_iterations_window.addWidget(self.block_iterations_label)
    self.block_iterations_window.addWidget(self.block_iterations_cell)
    self.block_edit_layout.addLayout(self.block_iterations_window)

    self.block_delay_window = QHBoxLayout()
    self.block_delay_label = QLabel(&#34;Delay&#34;)
    self.block_delay_cell = QLineEdit()
    self.block_delay_cell.setValidator(self.onlyFloat)
    self.block_delay_cell.textEdited.connect(self.block_to_tree)
    self.block_delay_window = QHBoxLayout()
    self.block_delay_window.addWidget(self.block_delay_label)
    self.block_delay_window.addWidget(self.block_delay_cell)
    self.block_edit_layout.addLayout(self.block_delay_window)

    self.block_jitter_window = QHBoxLayout()
    self.block_jitter_label = QLabel(&#34;Jitter&#34;)
    self.block_jitter_cell = QLineEdit()
    self.block_jitter_cell.setValidator(self.onlyFloat)
    self.block_jitter_cell.textEdited.connect(self.block_to_tree)
    self.block_jitter_window = QHBoxLayout()
    self.block_jitter_window.addWidget(self.block_jitter_label)
    self.block_jitter_window.addWidget(self.block_jitter_cell)
    self.block_edit_layout.addLayout(self.block_jitter_window)

    self.block_edit_container = QWidget()
    self.block_edit_container.setLayout(self.block_edit_layout)
    self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
    self.signal_adjust_superposed.addWidget(self.block_edit_container)
    self.signal_adjust_superposed.addWidget(QLabel())
    self.signal_adjust_superposed.setCurrentIndex(2)
    self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

    self.signal_preview_label = QLabel(&#34;Signal Preview&#34;)
    self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
    if self.acquisition_mode:
        self.grid_layout.addWidget(self.signal_preview_label, 2, 2)
    else:
        self.grid_layout.addWidget(self.signal_preview_label, 0, 2)

    self.buttons_main_window = QHBoxLayout()
    self.stop_button = QPushButton(&#34;Stop&#34;)
    self.stop_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-stop.png&#34;))
    )
    self.stop_button.clicked.connect(self.stop_while_running)
    self.stop_button.setEnabled(False)
    self.buttons_main_window.addWidget(self.stop_button)
    self.run_button = QPushButton(&#34;Run&#34;)
    self.run_button.setIcon(
        QIcon(os.path.join(self.cwd, &#34;gui&#34;, &#34;icons&#34;, &#34;player-play.png&#34;))
    )
    self.run_button.clicked.connect(self.run)
    self.run_button.setEnabled(False)
    self.buttons_main_window.addWidget(self.run_button)
    self.plot_window = PlotWindow(subplots=True)
    if self.acquisition_mode:
        self.grid_layout.addWidget(self.plot_window, 3, 2)
    else:
        self.grid_layout.addWidget(self.plot_window, 1, 2, 3, 1)
    self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
    self.open_daq_generation_thread()
    self.initialize_buttons()
    self.show()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons"><code class="name flex">
<span>def <span class="ident">initialize_buttons</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Define list of buttons to activate/deactivate</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def initialize_buttons(self):
    &#34;&#34;&#34;Define list of buttons to activate/deactivate&#34;&#34;&#34;
    self.canal1buttons = [
        self.stim_type_cell,
        self.pulses_label,
        self.pulses_cell,
        self.width_label,
        self.width_cell,
        self.jitter_label,
        self.jitter_cell,
        self.frequency_label,
        self.frequency_cell,
        self.duty_label,
        self.duty_cell,
        self.heigth_cell,
        self.heigth_label,
    ]
    self.canal2buttons = [
        self.stim_type_cell2,
        self.pulses_label2,
        self.pulses_cell2,
        self.width_label2,
        self.width_cell2,
        self.jitter_label2,
        self.jitter_cell2,
        self.frequency_label2,
        self.frequency_cell2,
        self.duty_label2,
        self.duty_cell2,
        self.heigth_cell2,
        self.heigth_label2,
    ]
    self.canal3buttons = [
        self.stim_type_cell3,
        self.pulses_label3,
        self.pulses_cell3,
        self.width_label3,
        self.width_cell3,
        self.jitter_label3,
        self.jitter_cell3,
        self.frequency_label3,
        self.frequency_cell3,
        self.duty_label3,
        self.duty_cell3,
        self.heigth_cell3,
        self.heigth_label3,
    ]
    self.enabled_buttons = [
        self.run_button,
        self.experiment_name_cell,
        self.mouse_id_cell,
        self.directory_choose_button,
        self.set_roi_button,
        self.reset_roi_button,
        self.experiment_name,
        self.mouse_id_label,
        self.framerate_label,
        self.framerate_cell,
        self.exposure_cell,
        self.exposure_label,
        self.add_brother_branch_button,
        self.add_child_branch_button,
        self.delete_item_button,
        self.red_checkbox,
        self.ir_checkbox,
        self.green_checkbox,
        self.fluorescence_checkbox,
        self.stimulation_name_label,
        self.directory_save_files_checkbox,
        self.stimulation_name_cell,
        self.stim_type_cell,
        self.stim_type_cell2,
        self.first_canal_check,
        self.second_canal_check,
        self.first_signal_type_duration_label,
        self.duration_cell,
        self.pulses_label,
        self.pulses_cell,
        self.width_label,
        self.width_cell,
        self.jitter_label,
        self.jitter_cell,
        self.frequency_label,
        self.frequency_cell,
        self.heigth_label,
        self.heigth_cell,
        self.duty_label,
        self.duty_cell,
        self.pulses_label2,
        self.pulses_cell2,
        self.width_label2,
        self.width_cell2,
        self.jitter_label2,
        self.jitter_cell2,
        self.frequency_label2,
        self.frequency_cell2,
        self.heigth_label2,
        self.heigth_cell2,
        self.duty_label2,
        self.duty_cell2,
        self.third_canal_check,
        self.stim_type_cell3,
        self.pulses_label3,
        self.pulses_cell3,
        self.width_label3,
        self.width_cell3,
        self.jitter_label3,
        self.jitter_cell3,
        self.frequency_label3,
        self.frequency_cell3,
        self.duty_label3,
        self.duty_cell3,
        self.heigth_cell3,
        self.heigth_label3,
        self.block_iterations_label,
        self.block_iterations_cell,
        self.block_delay_label,
        self.block_delay_cell,
        self.block_jitter_label,
        self.block_jitter_cell,
        self.block_name_label,
        self.block_name_cell,
        self.activate_live_preview_button,
        self.deactivate_live_preview_button,
        self.tree,
    ]</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.live_save"><code class="name flex">
<span>def <span class="ident">live_save</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Save NPY chunked files when the number of frames is over 1200</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def live_save(self):
    &#34;&#34;&#34;Save NPY chunked files when the number of frames is over 1200&#34;&#34;&#34;
    self.camera.file_index = 0
    self.camera.is_saving = False
    if self.directory_save_files_checkbox.isChecked():
        try:
            os.mkdir(
                os.path.join(
                    self.directory_cell.text(), self.experiment_name_cell.text()
                )
            )
            os.mkdir(
                os.path.join(
                    self.directory_cell.text(),
                    self.experiment_name_cell.text(),
                    &#34;data&#34;,
                )
            )
        except Exception as err:
            pass
        while self.camera.video_running is False and not self.camera.stop_signal:
            time.sleep(0.01)
            pass
        while self.camera.video_running is True:
            if len(self.camera.frames) &gt; 1200:
                self.memory = self.camera.frames[:1200]
                self.camera.frames = self.camera.frames[1200:]
                if self.directory_save_files_checkbox.isChecked():
                    try:
                        self.memory = shrink_array(self.memory, self.roi_extent)
                    except Exception:
                        pass
                    self.camera.is_saving = True
                    np.save(
                        os.path.join(
                            self.directory_cell.text(),
                            self.experiment_name_cell.text(),
                            &#34;data&#34;,
                            f&#34;{self.camera.file_index}.npy&#34;,
                        ),
                        self.memory,
                    )
                    self.memory = None
                    self.camera.file_index += 1
                    self.camera.is_saving = False
            time.sleep(0.01)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree"><code class="name flex">
<span>def <span class="ident">name_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the name of the current item from the cell to the tree</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def name_to_tree(self):
    &#34;&#34;&#34;Transfer the name of the current item from the cell to the tree&#34;&#34;&#34;
    branch = self.tree.currentItem()
    branch.setForeground(0, QBrush(QColor(0, 0, 0)))
    if branch.childCount() &gt; 0:
        branch.setText(0, self.block_name_cell.text())
    else:
        branch.setText(0, self.stimulation_name_cell.text())</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_baseline_check_thread"><code class="name flex">
<span>def <span class="ident">open_baseline_check_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the baseline check</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_baseline_check_thread(self):
    &#34;&#34;&#34;Open the thread for the baseline check&#34;&#34;&#34;
    self.baseline_check_thread = Thread(target=self.check_baseline)
    self.baseline_check_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread"><code class="name flex">
<span>def <span class="ident">open_daq_generation_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the DAQ generation</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_daq_generation_thread(self):
    &#34;&#34;&#34;Open the thread for the DAQ generation&#34;&#34;&#34;
    self.daq_generation_thread = Thread(target=self.generate_daq)
    self.daq_generation_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread"><code class="name flex">
<span>def <span class="ident">open_live_preview_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the live preview</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_live_preview_thread(self):
    &#34;&#34;&#34;Open the thread for the live preview&#34;&#34;&#34;
    self.live_preview_thread = Thread(target=self.start_live)
    self.live_preview_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_live_saving_thread"><code class="name flex">
<span>def <span class="ident">open_live_saving_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the live saving</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_live_saving_thread(self):
    &#34;&#34;&#34;Open the thread for the live saving&#34;&#34;&#34;
    self.live_save_thread = Thread(target=self.live_save)
    self.live_save_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread"><code class="name flex">
<span>def <span class="ident">open_signal_preview_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the signal preview</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_signal_preview_thread(self):
    &#34;&#34;&#34;Open the thread for the signal preview&#34;&#34;&#34;
    self.signal_preview_thread = Thread(target=self.actualize_progression)
    self.signal_preview_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread"><code class="name flex">
<span>def <span class="ident">open_start_experiment_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Open the thread for the start of the experiment</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_start_experiment_thread(self):
    &#34;&#34;&#34;Open the thread for the start of the experiment&#34;&#34;&#34;
    self.start_experiment_thread = Thread(target=self.run_stimulation)
    self.start_experiment_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.reset_roi"><code class="name flex">
<span>def <span class="ident">reset_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Reset the ROI</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reset_roi(self):
    &#34;&#34;&#34;Reset the ROI&#34;&#34;&#34;
    plt.figure(self.image_view.figure.number)
    plt.xlim(0, int(1024 / self.config[&#34;Binning&#34;]))
    plt.ylim(0, int(1024 / self.config[&#34;Binning&#34;]))
    self.roi_extent = None
    self.reset_roi_button.setEnabled(False)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Run the experiment</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    &#34;&#34;&#34;Run the experiment&#34;&#34;&#34;
    if self.check_override():
        self.deactivate_buttons(buttons=self.enabled_buttons)
        self.master_block = self.tree.create_blocks()
        self.tree.baseline_values = []
        self.tree.graph(item=self.tree.invisibleRootItem())
        self.root_time, self.root_signal = (
            self.tree.x_values,
            [
                self.tree.stim1_values,
                self.tree.stim2_values,
                self.tree.stim3_values,
            ],
        )
        self.draw(root=True)
        if self.acquisition_mode:
            self.actualize_daq()
            self.open_live_saving_thread()
            self.open_live_preview_thread()
            self.open_baseline_check_thread()
        else:
            self.daq.stop_signal = False
        self.open_signal_preview_thread()
        self.open_start_experiment_thread()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation"><code class="name flex">
<span>def <span class="ident">run_stimulation</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Run the stimulation in parallel with the lights</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run_stimulation(self):
    &#34;&#34;&#34;Run the stimulation in parallel with the lights&#34;&#34;&#34;
    self.experiment = Experiment(
        self.master_block,
        int(self.framerate_cell.text()),
        int(self.exposure_cell.text()),
        self.mouse_id_cell.text(),
        self.directory_cell.text(),
        self.daq,
        name=self.experiment_name_cell.text(),
        config=self.config,
    )
    self.save_files_after_stop = True
    self.daq.launch(self.experiment.name, self.root_time, self.root_signal)
    # if (
    #    not self.daq.stop_signal
    #    and self.save_files_after_stop
    #    and self.directory_save_files_checkbox.isChecked()
    # ):
    if (
        self.save_files_after_stop
        and self.directory_save_files_checkbox.isChecked()
    ):
        try:
            print(&#34;this is the extent&#34;)
            print(self.roi_extent)
            self.experiment.save(self.roi_extent)
        except Exception as err:
            print(&#34;err after saving first&#34;)
            print(err)
            print(&#34;err before entering&#34;)
            self.experiment.save()
    self.stop()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.save_config"><code class="name flex">
<span>def <span class="ident">save_config</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Save the current configuration to a JSON file</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_config(self):
    &#34;&#34;&#34;Save the current configuration to a JSON file&#34;&#34;&#34;
    folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
    if folder != &#34;&#34;:
        self.master_block = self.tree.create_blocks()
        self.experiment = Experiment(
            self.master_block,
            int(self.framerate_cell.text()),
            int(self.exposure_cell.text()),
            self.mouse_id_cell.text(),
            folder,
            self.daq,
            name=self.experiment_name_cell.text(),
            config=self.config,
        )
        self.experiment.save_config(
            [int(1024 / self.config[&#34;Binning&#34;]), int(1024 / self.config[&#34;Binning&#34;])]
        )</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.save_roi"><code class="name flex">
<span>def <span class="ident">save_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Save the ROI</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_roi(self):
    &#34;&#34;&#34;Save the ROI&#34;&#34;&#34;
    self.activate_buttons(buttons=self.enabled_buttons)
    self.roi_buttons.setCurrentIndex(0)
    plt.figure(self.image_view.figure.number)
    plt.ion()
    print(self.roi_extent)
    plt.xlim(self.roi_extent[0], self.roi_extent[1])
    plt.ylim(self.roi_extent[2], self.roi_extent[3])
    self.rect_selector.clear()
    self.rect_selector = None
    self.reset_roi_button.setEnabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.set_lights"><code class="name flex">
<span>def <span class="ident">set_lights</span></span>(<span>self, lights)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the lights</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_lights(self, lights):
    &#34;&#34;&#34;Set the lights&#34;&#34;&#34;
    for light in lights:
        if light == &#34;infrared&#34;:
            self.ir_checkbox.setChecked(True)
        elif light == &#34;red&#34;:
            self.red_checkbox.setChecked(True)
        elif light == &#34;green&#34;:
            self.green_checkbox.setChecked(True)
        elif light == &#34;blue&#34;:
            self.fluorescence_checkbox.setChecked(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.set_roi"><code class="name flex">
<span>def <span class="ident">set_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the ROI</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_roi(self):
    &#34;&#34;&#34;Set the ROI&#34;&#34;&#34;
    self.deactivate_buttons(buttons=self.enabled_buttons)
    self.stop_button.setEnabled(False)
    self.save_roi_button.setEnabled(False)
    self.roi_buttons.setCurrentIndex(1)

    def onselect_function(eclick, erelease):
        &#34;&#34;&#34;Save the ROI dimensions as attributes&#34;&#34;&#34;
        self.roi_extent = self.rect_selector.extents
        self.save_roi_button.setEnabled(True)

    self.rect_selector = RectangleSelector(
        self.plot_image.axes,
        onselect_function,
        drawtype=&#34;box&#34;,
        useblit=True,
        button=[1, 3],
        minspanx=5,
        minspany=5,
        spancoords=&#34;pixels&#34;,
        interactive=True,
    )</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.set_trigger"><code class="name flex">
<span>def <span class="ident">set_trigger</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Set the trigger for the DAQ</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_trigger(self):
    &#34;&#34;&#34;Set the trigger for the DAQ&#34;&#34;&#34;
    if not self.acquisition_mode:
        self.run_button.setText(&#34;Run at Trigger&#34;)
        self.daq.set_trigger(self.ports[&#34;trigger&#34;])
    else:
        self.run_button.setText(&#34;Run&#34;)
        self.daq.remove_trigger()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.show_buttons"><code class="name flex">
<span>def <span class="ident">show_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the buttons in a list</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show_buttons(self, buttons):
    &#34;&#34;&#34;Show the buttons in a list&#34;&#34;&#34;
    for button in buttons:
        button.setVisible(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree"><code class="name flex">
<span>def <span class="ident">signal_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the signal of the current item from the cell to the tree</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def signal_to_tree(self):
    &#34;&#34;&#34;Transfer the signal of the current item from the cell to the tree&#34;&#34;&#34;
    self.tree.currentItem().setText(6, self.duration_cell.text())
    self.tree.currentItem().setText(5, self.pulses_cell.text())
    self.tree.currentItem().setText(7, self.jitter_cell.text())
    self.tree.currentItem().setText(8, self.width_cell.text())
    self.tree.currentItem().setText(9, self.frequency_cell.text())
    self.tree.currentItem().setText(10, self.duty_cell.text())
    self.tree.currentItem().setText(21, self.heigth_cell.text())
    self.tree.currentItem().setText(12, self.pulses_cell2.text())
    self.tree.currentItem().setText(13, self.jitter_cell2.text())
    self.tree.currentItem().setText(14, self.width_cell2.text())
    self.tree.currentItem().setText(15, self.frequency_cell2.text())
    self.tree.currentItem().setText(16, self.duty_cell2.text())
    self.tree.currentItem().setText(22, self.heigth_cell2.text())
    self.tree.currentItem().setText(24, self.pulses_cell3.text())
    self.tree.currentItem().setText(25, self.jitter_cell3.text())
    self.tree.currentItem().setText(26, self.width_cell3.text())
    self.tree.currentItem().setText(27, self.frequency_cell3.text())
    self.tree.currentItem().setText(28, self.duty_cell3.text())
    self.enable_run(self.tree.check_global_validity())
    self.tree.graph(self.tree.currentItem(), current=True)
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.start_in_acquisition_mode"><code class="name flex">
<span>def <span class="ident">start_in_acquisition_mode</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize the interface in acquisition mode</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_in_acquisition_mode(self):
    &#34;&#34;&#34;Initialize the interface in acquisition mode&#34;&#34;&#34;
    self.start_container.setParent(None)
    self.acquisition_mode = True
    self.initUI()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.start_in_trigger_mode"><code class="name flex">
<span>def <span class="ident">start_in_trigger_mode</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize the interface in trigger mode</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_in_trigger_mode(self):
    &#34;&#34;&#34;Initialize the interface in trigger mode&#34;&#34;&#34;
    self.start_container.setParent(None)
    self.acquisition_mode = False
    self.initUI()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.start_live"><code class="name flex">
<span>def <span class="ident">start_live</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Start the live preview</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_live(self):
    &#34;&#34;&#34;Start the live preview&#34;&#34;&#34;
    plt.ion()
    self.memory = []
    self.camera.baseline_completed = False
    if len(self.daq.lights) &gt; 0:
        try:
            while self.camera.video_running is False:
                time.sleep(0.01)
                pass
            while self.camera.video_running is True:
                try:
                    if (
                        not self.camera.baseline_completed
                        or self.activation_map_combo.currentIndex() == 0
                    ):
                        self.plot_image.set(
                            array=self.camera.frames[
                                self.live_preview_light_index :: len(
                                    self.daq.lights
                                )
                            ][-1],
                            clim=(0, self.max_exposure),
                            cmap=&#34;binary_r&#34;,
                        )
                    elif self.activation_map_combo.currentIndex() == 1:
                        start_index = (
                            self.camera.baseline_read_list[0]
                            + self.live_preview_light_index
                        ) % len(self.daq.lights)
                        activation_map = (
                            self.camera.baseline_frames[
                                start_index :: len(self.daq.lights)
                            ][-1]
                            - self.camera.average_baseline[
                                self.live_preview_light_index
                            ]
                        ) / self.camera.average_baseline[
                            self.live_preview_light_index
                        ]
                        self.plot_image.set(
                            array=activation_map,
                            clim=(
                                -self.max_exposure / 200,
                                self.max_exposure / 200,
                            ),
                            cmap=&#34;seismic&#34;,
                        )
                    else:
                        start_index = (
                            self.camera.baseline_read_list[0]
                            + self.live_preview_light_index
                        ) % len(self.daq.lights)
                        activation_map = np.log(
                            (
                                (
                                    self.camera.baseline_frames[
                                        start_index :: len(self.daq.lights)
                                    ][-1]
                                    - self.camera.average_baseline[
                                        self.live_preview_light_index
                                    ]
                                )
                                / self.camera.average_baseline[
                                    self.live_preview_light_index
                                ]
                            )
                        )
                        self.plot_image.set(
                            array=activation_map,
                            clim=(
                                -self.max_exposure / 2000,
                                self.max_exposure / 2000,
                            ),
                            cmap=&#34;seismic&#34;,
                        )

                except Exception as err:
                    print(err)
                    pass
                time.sleep(0.04)
        except Exception as err:
            pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Stop the experiment and reactivate the interface</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop(self):
    &#34;&#34;&#34;Stop the experiment and reactivate the interface&#34;&#34;&#34;
    self.stop_live()
    self.activate_buttons(buttons=self.enabled_buttons)
    self.tree.setCurrentItem(self.tree.topLevelItem(0))
    try:
        self.daq.stop_signal = True
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_live"><code class="name flex">
<span>def <span class="ident">stop_live</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Stop the live preview</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_live(self):
    &#34;&#34;&#34;Stop the live preview&#34;&#34;&#34;
    self.camera.video_running = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog"><code class="name flex">
<span>def <span class="ident">stop_stimulation_dialog</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Ask if user wants to keep the files after experiment is stopped</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_stimulation_dialog(self):
    &#34;&#34;&#34;Ask if user wants to keep the files after experiment is stopped&#34;&#34;&#34;
    button = QMessageBox.question(
        self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;
    )
    if button == QMessageBox.Yes:
        self.save_files_after_stop = True
    else:
        self.save_files_after_stop = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running"><code class="name flex">
<span>def <span class="ident">stop_while_running</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Stop the experiment while it is running</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_while_running(self):
    &#34;&#34;&#34;Stop the experiment while it is running&#34;&#34;&#34;
    if self.directory_save_files_checkbox.isChecked():
        self.stop_stimulation_dialog()
    self.stop()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block"><code class="name flex">
<span>def <span class="ident">tree_to_block</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the block attributes from the tree to the cells</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_block(self):
    &#34;&#34;&#34;Transfer the block attributes from the tree to the cells&#34;&#34;&#34;
    try:
        self.block_iterations_cell.setText(self.tree.currentItem().text(1))
        self.block_delay_cell.setText(self.tree.currentItem().text(2))
        self.block_jitter_cell.setText(self.tree.currentItem().text(3))
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal"><code class="name flex">
<span>def <span class="ident">tree_to_canal</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the canals attributes from the tree to the cells</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_canal(self):
    &#34;&#34;&#34;Transfer the canals attributes from the tree to the cells&#34;&#34;&#34;
    self.canal_running = True
    try:
        self.baseline_checkbox.setChecked(
            self.boolean(self.tree.currentItem().text(17))
        )
        self.first_canal_check.setChecked(
            self.boolean(self.tree.currentItem().text(18))
        )
        self.second_canal_check.setChecked(
            self.boolean(self.tree.currentItem().text(19))
        )
        self.third_canal_check.setChecked(
            self.boolean(self.tree.currentItem().text(30))
        )
        if self.baseline_checkbox.isChecked():
            self.deactivate_buttons(self.canal1buttons + [self.first_canal_check])
            self.deactivate_buttons(self.canal2buttons + [self.second_canal_check])
            self.deactivate_buttons(self.canal3buttons + [self.third_canal_check])
        else:
            self.activate_buttons(
                [
                    self.first_canal_check,
                    self.second_canal_check,
                    self.third_canal_check,
                ]
            )
        if self.first_canal_check.isChecked():
            self.activate_buttons(self.canal1buttons)
        else:
            self.deactivate_buttons(self.canal1buttons)
        if self.second_canal_check.isChecked():
            self.activate_buttons(self.canal2buttons)
        else:
            self.deactivate_buttons(self.canal2buttons)
        if self.third_canal_check.isChecked():
            self.activate_buttons(self.canal3buttons)
        else:
            self.deactivate_buttons(self.canal3buttons)
    except Exception as err:
        pass
    self.canal_running = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name"><code class="name flex">
<span>def <span class="ident">tree_to_name</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the name of the current item from the tree to the cell</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_name(self):
    &#34;&#34;&#34;Transfer the name of the current item from the tree to the cell&#34;&#34;&#34;
    try:
        if self.tree.currentItem().childCount() &gt; 0:
            if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                self.block_name_cell.setText(self.tree.currentItem().text(0))
            else:
                self.block_name_cell.setText(&#34;&#34;)
        else:
            if self.tree.currentItem().text(0) != &#34;No Name&#34;:
                self.stimulation_name_cell.setText(self.tree.currentItem().text(0))
            else:
                self.stimulation_name_cell.setText(&#34;&#34;)
    except AttributeError:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal"><code class="name flex">
<span>def <span class="ident">tree_to_signal</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the signal of the current item from the tree to the cell</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_signal(self):
    &#34;&#34;&#34;Transfer the signal of the current item from the tree to the cell&#34;&#34;&#34;
    try:
        self.pulses_cell.setText(self.tree.currentItem().text(5))
        self.duration_cell.setText(self.tree.currentItem().text(6))
        self.jitter_cell.setText(self.tree.currentItem().text(7))
        self.width_cell.setText(self.tree.currentItem().text(8))
        self.frequency_cell.setText(self.tree.currentItem().text(9))
        self.heigth_cell.setText(self.tree.currentItem().text(21))
        self.duty_cell.setText(self.tree.currentItem().text(10))
        self.pulses_cell2.setText(self.tree.currentItem().text(12))
        self.jitter_cell2.setText(self.tree.currentItem().text(13))
        self.width_cell2.setText(self.tree.currentItem().text(14))
        self.frequency_cell2.setText(self.tree.currentItem().text(15))
        self.heigth_cell2.setText(self.tree.currentItem().text(22))
        self.duty_cell2.setText(self.tree.currentItem().text(16))
        self.pulses_cell3.setText(self.tree.currentItem().text(24))
        self.jitter_cell3.setText(self.tree.currentItem().text(25))
        self.width_cell3.setText(self.tree.currentItem().text(26))
        self.frequency_cell3.setText(self.tree.currentItem().text(27))
        self.duty_cell3.setText(self.tree.currentItem().text(28))
    except Exception as err:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type"><code class="name flex">
<span>def <span class="ident">tree_to_type</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the type of the current item from the tree to the cell</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_type(self):
    &#34;&#34;&#34;Transfer the type of the current item from the tree to the cell&#34;&#34;&#34;
    dico = {&#34;square&#34;: 0, &#34;random-square&#34;: 1, &#34;Third&#34;: 2}
    try:
        self.stim_type_cell.setCurrentIndex(dico[self.tree.currentItem().text(4)])
    except Exception:
        self.stim_type_cell.setCurrentIndex(0)

    try:
        self.stim_type_cell2.setCurrentIndex(dico[self.tree.currentItem().text(11)])
    except Exception:
        self.stim_type_cell2.setCurrentIndex(0)

    try:
        self.stim_type_cell3.setCurrentIndex(dico[self.tree.currentItem().text(23)])
    except Exception:
        self.stim_type_cell3.setCurrentIndex(0)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree"><code class="name flex">
<span>def <span class="ident">type_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Transfer the type of the current item from the cell to the tree</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def type_to_tree(self):
    &#34;&#34;&#34;Transfer the type of the current item from the cell to the tree&#34;&#34;&#34;
    self.enable_run(self.tree.check_global_validity())
    self.different_signals_window.setCurrentIndex(
        self.stim_type_cell.currentIndex()
    )
    self.different_signals_window2.setCurrentIndex(
        self.stim_type_cell2.currentIndex()
    )
    self.different_signals_window3.setCurrentIndex(
        self.stim_type_cell3.currentIndex()
    )
    try:
        self.tree.currentItem().setText(4, str(self.stim_type_cell.currentText()))
    except Exception:
        pass
    try:
        self.tree.currentItem().setText(11, str(self.stim_type_cell2.currentText()))
    except Exception:
        pass
    try:
        self.tree.currentItem().setText(23, str(self.stim_type_cell3.currentText()))
    except Exception:
        pass
    try:
        self.tree.graph(self.tree.currentItem(), current=True)
        self.draw()
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure"><code class="name flex">
<span>def <span class="ident">verify_exposure</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Verify if the exposure/framerate combination is valid</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def verify_exposure(self):
    &#34;&#34;&#34;Verify if the exposure/framerate combination is valid&#34;&#34;&#34;
    try:
        boolean_check = (int(self.exposure_cell.text()) / 1000 + 0.0015) * int(
            self.framerate_cell.text()
        ) &lt; 1 and int(self.framerate_cell.text()) &lt;= 57
    except Exception:
        boolean_check = False
    self.exposure_warning_label.setHidden(boolean_check)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="Widefield-Imaging-Acquisition.gui" href="index.html">Widefield-Imaging-Acquisition.gui</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="Widefield-Imaging-Acquisition.gui.interface.App" href="#Widefield-Imaging-Acquisition.gui.interface.App">App</a></code></h4>
<ul class="">
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons">activate_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq">actualize_daq</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_lights" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_lights">actualize_lights</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_progression" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_progression">actualize_progression</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_window" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_window">actualize_window</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.adjust_exposure" href="#Widefield-Imaging-Acquisition.gui.interface.App.adjust_exposure">adjust_exposure</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.adjust_slider" href="#Widefield-Imaging-Acquisition.gui.interface.App.adjust_slider">adjust_slider</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree">block_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.boolean" href="#Widefield-Imaging-Acquisition.gui.interface.App.boolean">boolean</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree">canals_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi">cancel_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel" href="#Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel">change_preview_light_channel</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_baseline" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_baseline">check_baseline</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive">check_if_thread_is_alive</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_override" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_override">check_override</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.choose_directory" href="#Widefield-Imaging-Acquisition.gui.interface.App.choose_directory">choose_directory</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.closeEvent" href="#Widefield-Imaging-Acquisition.gui.interface.App.closeEvent">closeEvent</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.count_lights" href="#Widefield-Imaging-Acquisition.gui.interface.App.count_lights">count_lights</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons">deactivate_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_channels" href="#Widefield-Imaging-Acquisition.gui.interface.App.deactivate_channels">deactivate_channels</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.disable_run" href="#Widefield-Imaging-Acquisition.gui.interface.App.disable_run">disable_run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.draw" href="#Widefield-Imaging-Acquisition.gui.interface.App.draw">draw</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.enable_directory" href="#Widefield-Imaging-Acquisition.gui.interface.App.enable_directory">enable_directory</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.enable_run" href="#Widefield-Imaging-Acquisition.gui.interface.App.enable_run">enable_run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.generate_daq" href="#Widefield-Imaging-Acquisition.gui.interface.App.generate_daq">generate_daq</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.handler" href="#Widefield-Imaging-Acquisition.gui.interface.App.handler">handler</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons">hide_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.import_config" href="#Widefield-Imaging-Acquisition.gui.interface.App.import_config">import_config</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.initUI" href="#Widefield-Imaging-Acquisition.gui.interface.App.initUI">initUI</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons">initialize_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.live_save" href="#Widefield-Imaging-Acquisition.gui.interface.App.live_save">live_save</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree">name_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_baseline_check_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_baseline_check_thread">open_baseline_check_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread">open_daq_generation_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread">open_live_preview_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_live_saving_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_live_saving_thread">open_live_saving_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread">open_signal_preview_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread">open_start_experiment_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.reset_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.reset_roi">reset_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.run" href="#Widefield-Imaging-Acquisition.gui.interface.App.run">run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation" href="#Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation">run_stimulation</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.save_config" href="#Widefield-Imaging-Acquisition.gui.interface.App.save_config">save_config</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.save_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.save_roi">save_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.set_lights" href="#Widefield-Imaging-Acquisition.gui.interface.App.set_lights">set_lights</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.set_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.set_roi">set_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.set_trigger" href="#Widefield-Imaging-Acquisition.gui.interface.App.set_trigger">set_trigger</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.show_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.show_buttons">show_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree">signal_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.start_in_acquisition_mode" href="#Widefield-Imaging-Acquisition.gui.interface.App.start_in_acquisition_mode">start_in_acquisition_mode</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.start_in_trigger_mode" href="#Widefield-Imaging-Acquisition.gui.interface.App.start_in_trigger_mode">start_in_trigger_mode</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.start_live" href="#Widefield-Imaging-Acquisition.gui.interface.App.start_live">start_live</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop">stop</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_live" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_live">stop_live</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog">stop_stimulation_dialog</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running">stop_while_running</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block">tree_to_block</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal">tree_to_canal</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name">tree_to_name</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal">tree_to_signal</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type">tree_to_type</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree">type_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure" href="#Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure">verify_exposure</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>