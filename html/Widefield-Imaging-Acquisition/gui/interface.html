<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>Widefield-Imaging-Acquisition.gui.interface API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>Widefield-Imaging-Acquisition.gui.interface</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import sys
import time
import random
import os
import matplotlib.pyplot as plt
from PyQt5.QtCore import Qt
import numpy as np
from PyQt5.QtWidgets import QDialog, QVBoxLayout, QWidget, QGridLayout, QLabel, QHBoxLayout, QLineEdit, QCheckBox, QPushButton, QStackedLayout, QTreeWidget, QComboBox, QMessageBox, QFileDialog, QTreeWidgetItem, QApplication, QAction, QMenuBar
from PyQt5.QtGui import QIntValidator, QDoubleValidator, QFont, QIcon, QBrush, QColor
from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg as FigureCanvas
from matplotlib.widgets import RectangleSelector
from threading import Thread
sys.path.append(os.path.dirname(os.path.dirname(__file__)))
from src.signal_generator import make_signal, random_square
from src.controls import DAQ, Instrument, Camera
from src.blocks import Stimulation, Block, Experiment


class PlotWindow(QDialog):
    def __init__(self, parent=None):
        super(PlotWindow, self).__init__(parent)
        self.figure = plt.figure()
        self.canvas = FigureCanvas(self.figure)
        layout = QVBoxLayout()
        layout.addWidget(self.canvas)
        self.setLayout(layout)

    def get_data(self, time_values, pulses, jitter, width=0.2):
        y_values = random_square(time_values, pulses, width, jitter)
        return y_values

    def clear(self):
        plt.clf()

    def plot(self, x, y, root, color=&#34;b&#34;):
        plt.ion()
        plt.plot(x,y, color=color)
        if root:
            try:
                self.vertical_line
            except Exception:
                self.vertical_line = plt.axvline(0, ls=&#39;-&#39;, color=&#39;r&#39;, lw=1, zorder=10)
        else:
            try:
                self.vertical_line.remove()
            except Exception:
                pass
        #self.canvas.draw()


class App(QWidget):

    def __init__(self):
        super().__init__()
        self.title = &#39;Widefield Imaging Aquisition&#39;
        self.left = 10
        self.top = 10
        self.width = 640
        self.height = 480
        self.initUI()

    def closeEvent(self, *args, **kwargs):
        self.daq.stop_signal = True
        self.video_running = False
        self.daq.camera.cam.stop_acquisition()
        print(&#34;Closed&#34;)

    def initUI(self):
        self.setWindowTitle(self.title)
        self.setGeometry(self.left, self.top, self.width, self.height)

        self.plot_x_values = []
        self.plot_stim1_values = []
        self.plot_stim2_values = []
        self.elapsed_time = 0
        self.files_saved = False
        self.onlyInt = QIntValidator()
        self.onlyFloat = QDoubleValidator()
        self.onlyFramerate = QIntValidator()
        self.onlyFramerate.setRange(1, 57)
        self.onlyExposure = QIntValidator()
        self.onlyExposure.setRange(1,900)

        self.grid_layout = QGridLayout()
        self.setLayout(self.grid_layout)
        self.grid_layout.setAlignment(Qt.AlignTop)

        self.experiment_settings_label = QLabel(&#39;Experiment Settings&#39;)
        self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

        self.experiment_settings_main_window = QVBoxLayout()
        self.experiment_name_window = QHBoxLayout()
        self.experiment_name = QLabel(&#39;Experiment Name&#39;)
        self.experiment_name_window.addWidget(self.experiment_name)
        self.experiment_name_cell = QLineEdit()
        self.experiment_name_window.addWidget(self.experiment_name_cell)
        self.experiment_settings_main_window.addLayout(self.experiment_name_window)

        self.mouse_id_window = QHBoxLayout()
        self.mouse_id_label = QLabel(&#39;Mouse ID&#39;)
        self.mouse_id_window.addWidget(self.mouse_id_label)
        self.mouse_id_cell = QLineEdit()
        self.mouse_id_window.addWidget(self.mouse_id_cell)
        self.experiment_settings_main_window.addLayout(self.mouse_id_window)

        self.directory_window = QHBoxLayout()
        self.directory_save_files_checkbox = QCheckBox()
        self.directory_save_files_checkbox.setText(&#34;Save&#34;)
        self.directory_save_files_checkbox.stateChanged.connect(self.check_if_thread_is_alive)
        #TODO Change for real function
        self.directory_window.addWidget(self.directory_save_files_checkbox)
        self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
        self.directory_choose_button.setIcon(QIcon(&#34;gui/icons/folder-plus.png&#34;))
        self.directory_choose_button.setDisabled(True)
        self.directory_choose_button.clicked.connect(self.choose_directory)
        self.directory_window.addWidget(self.directory_choose_button)
        self.directory_cell = QLineEdit(&#34;&#34;)
        self.directory_cell.setReadOnly(True)
        self.directory_window.addWidget(self.directory_cell)
        self.experiment_settings_main_window.addLayout(self.directory_window)

        self.experiment_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)

        self.image_settings_label = QLabel(&#39;Image Settings&#39;)
        self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.image_settings_label, 0, 1)

        self.image_settings_main_window = QVBoxLayout()
        self.image_settings_main_window.setAlignment(Qt.AlignLeft)
        self.image_settings_main_window.setAlignment(Qt.AlignTop)

        self.framerate_window = QHBoxLayout()
        self.framerate_label = QLabel(&#39;Framerate&#39;)
        self.framerate_window.addWidget(self.framerate_label)
        self.framerate_cell = QLineEdit(&#39;30&#39;)
        self.framerate_cell.setValidator(self.onlyFramerate)
        self.framerate_cell.textChanged.connect(self.verify_exposure)
        self.framerate_window.addWidget(self.framerate_cell)
        self.image_settings_main_window.addLayout(self.framerate_window)

        self.exposure_window = QHBoxLayout()
        self.exposure_label = QLabel(&#39;Exposure (ms)&#39;)
        self.exposure_window.addWidget(self.exposure_label)
        self.exposure_cell = QLineEdit(&#39;10&#39;)
        self.exposure_cell.setValidator(self.onlyExposure)
        self.exposure_cell.textChanged.connect(self.verify_exposure)
        self.exposure_window.addWidget(self.exposure_cell)
        self.image_settings_main_window.addLayout(self.exposure_window)

        self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
        self.image_settings_main_window.addWidget(self.exposure_warning_label)
        self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
        self.exposure_warning_label.setHidden(True)

        self.image_settings_second_window = QHBoxLayout()
        self.ir_checkbox = QCheckBox(&#39;Infrared&#39;)
        self.ir_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.ir_checkbox)
        self.red_checkbox = QCheckBox(&#39;Red&#39;)
        self.red_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.red_checkbox)
        self.green_checkbox = QCheckBox(&#39;Green&#39;)
        self.green_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.green_checkbox)
        self.fluorescence_checkbox = QCheckBox(&#39;Blue&#39;)
        self.fluorescence_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

        self.light_channel_layout = QHBoxLayout()
        self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
        self.light_channel_layout.addWidget(self.preview_light_label)
        self.preview_light_combo = QComboBox()
        self.preview_light_combo.setEnabled(False)
        self.preview_light_combo.currentIndexChanged.connect(self.change_preview_light_channel)
        self.light_channel_layout.addWidget(self.preview_light_combo)

        self.image_settings_main_window.addLayout(self.image_settings_second_window)
        self.image_settings_main_window.addLayout(self.light_channel_layout)

        self.roi_buttons = QStackedLayout()

        self.roi_layout1 = QHBoxLayout()
        self.roi_layout1.setAlignment(Qt.AlignLeft)
        self.roi_layout1.setAlignment(Qt.AlignTop)
        self.roi_layout1.setContentsMargins(0, 0, 0, 0)
        self.reset_roi_button = QPushButton()
        self.reset_roi_button.setText(&#34;Reset ROI&#34;)
        self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
        self.reset_roi_button.setEnabled(False)
        self.reset_roi_button.clicked.connect(self.reset_roi)
        self.roi_layout1.addWidget(self.reset_roi_button)

        self.set_roi_button = QPushButton()
        self.set_roi_button.setText(&#34;Set ROI&#34;)
        self.set_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-in-area.png&#34;))
        self.set_roi_button.clicked.connect(self.set_roi)
        self.roi_layout1.addWidget(self.set_roi_button)
        self.roi_layout1_container = QWidget()
        self.roi_layout1_container.setLayout(self.roi_layout1)

        self.roi_layout2 = QHBoxLayout()
        self.roi_layout2.setAlignment(Qt.AlignLeft)
        self.roi_layout2.setAlignment(Qt.AlignTop)
        self.roi_layout2.setContentsMargins(0, 0, 0, 0)
        self.cancel_roi_button = QPushButton()
        self.cancel_roi_button.setText(&#34;Cancel&#34;)
        self.cancel_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-cancel.png&#34;))
        self.cancel_roi_button.clicked.connect(self.cancel_roi)
        self.roi_layout2.addWidget(self.cancel_roi_button)

        self.save_roi_button = QPushButton()
        self.save_roi_button.setText(&#34;Save ROI&#34;)
        self.save_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-check.png&#34;))
        self.save_roi_button.clicked.connect(self.save_roi)
        self.roi_layout2.addWidget(self.save_roi_button)
        self.roi_layout2_container = QWidget()
        self.roi_layout2_container.setLayout(self.roi_layout2)

        self.roi_buttons.addWidget(self.roi_layout1_container)
        self.roi_buttons.addWidget(self.roi_layout2_container)

        self.image_settings_main_window.addLayout(self.roi_buttons)
        self.image_settings_main_window.addStretch()

        self.activate_live_preview_button = QPushButton()
        self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
        self.activate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video&#34;))
        self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

        self.deactivate_live_preview_button = QPushButton()
        self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
        self.deactivate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video-off&#34;))
        self.deactivate_live_preview_button.clicked.connect(self.stop_live)

        self.image_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

        self.live_preview_label = QLabel(&#39;Live Preview&#39;)
        self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.numpy = np.random.rand(1024, 1024)
        self.image_view = PlotWindow()
        self.plot_image = plt.imshow(self.numpy, cmap=&#34;binary_r&#34;, vmin=0, vmax=4096)
        self.plot_image.axes.get_xaxis().set_visible(False)
        self.plot_image.axes.axes.get_yaxis().set_visible(False)

        self.grid_layout.addWidget(self.live_preview_label, 0, 2)
        self.grid_layout.addWidget(self.image_view, 1, 2)

        self.stimulation_tree_label = QLabel(&#39;Stimulation Tree&#39;)
        self.stimulation_tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.stimulation_tree_label, 2, 0)

        self.stimulation_tree_window = QVBoxLayout()
        self.stimulation_tree = QTreeWidget()
        self.stimulation_tree.setHeaderLabels([&#34;0 Name&#34;, &#34;1 Iterations&#34;, &#34;2 Delay&#34;, &#34;3 Jitter&#34;, &#34;4 Type&#34;, &#34;5 Pulses&#34;,
                                              &#34;6 Duration&#34;, &#34;7 Jitter&#34;, &#34;8 Width&#34;, &#34;9 Frequency&#34;, &#34;10 Duty&#34;, &#34;11 Type2&#34;, &#34;12 Pulses 2&#34;, &#34;13 Jitter 2&#34;, &#34;14 Width 2&#34;, &#34;15 Frequency 2&#34;, &#34;16 Duty 2&#34;, &#34;17 Blank&#34;, &#34;18 Canal 1&#34;, &#34;19 Canal 2&#34;, &#34;20 Valid&#34;])
        for i in range(19):
            self.stimulation_tree.header().hideSection(i+1)
            pass
        self.stimulation_tree.setHeaderHidden(True)
        self.stimulation_tree.setColumnWidth(0, 330)
        self.stimulation_tree.currentItemChanged.connect(self.actualize_window)
        self.stimulation_tree_window.addWidget(self.stimulation_tree)

        self.stimulation_tree_switch_window = QStackedLayout()
        self.stimulation_tree_second_window = QHBoxLayout()
        self.stim_buttons_container = QWidget()
        self.delete_branch_button = QPushButton(&#39;Delete&#39;)
        self.delete_branch_button.setIcon(QIcon(&#34;gui/icons/trash.png&#34;))
        self.delete_branch_button.clicked.connect(self.delete_branch)
        self.stimulation_tree_second_window.addWidget(self.delete_branch_button)
        self.add_brother_branch_button = QPushButton(&#39;Add Sibling&#39;)
        self.add_brother_branch_button.clicked.connect(self.add_brother)
        self.add_brother_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-down.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_brother_branch_button)
        self.add_child_branch_button = QPushButton(&#39;Add Child&#39;)
        self.add_child_branch_button.clicked.connect(self.add_child)
        self.add_child_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-right.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_child_branch_button)
        self.stim_buttons_container.setLayout(self.stimulation_tree_second_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container)

        self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
        self.new_branch_button.setIcon(QIcon(&#34;gui/icons/square-plus.png&#34;))
        self.stimulation_tree_third_window = QHBoxLayout()
        self.stimulation_tree_third_window.addWidget(self.new_branch_button)
        self.stim_buttons_container2 = QWidget()
        self.stim_buttons_container2.setLayout(self.stimulation_tree_third_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container2)
        self.new_branch_button.clicked.connect(self.first_stimulation)
        self.grid_layout.addLayout(self.stimulation_tree_switch_window, 4, 0)

        self.stimulation_tree_switch_window.setCurrentIndex(1)
        self.grid_layout.addLayout(self.stimulation_tree_window, 3, 0)

        self.signal_adjust_label = QLabel(&#39;Signal Adjust&#39;)
        self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

        self.signal_adjust_superposed = QStackedLayout()
        self.stimulation_edit_layout = QVBoxLayout()
        self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

        self.canal_window = QVBoxLayout()
        self.canal_window.setAlignment(Qt.AlignLeft)
        self.canal_window.setAlignment(Qt.AlignTop)
        self.canal_window.setContentsMargins(0, 0, 0, 0)



        self.first_signal_first_canal_check = QCheckBox()
        self.first_signal_first_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_first_canal_check.setText(&#34;Canal 1&#34;)
        self.canal_window.addWidget(self.first_signal_first_canal_check)



        self.stimulation_type_label = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell = QComboBox()
        self.stimulation_type_cell.addItem(&#34;square&#34;)
        self.stimulation_type_cell.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell.addItem(&#34;Third&#34;)
        self.stimulation_type_cell.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window = QHBoxLayout()
        self.stimulation_type_window.addWidget(self.stimulation_type_label)
        self.stimulation_type_window.addWidget(self.stimulation_type_cell)
        self.canal_window.addLayout(self.stimulation_type_window)

        self.different_signals_window = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window)

        self.first_signal_second_canal_check = QCheckBox()
        self.first_signal_second_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_second_canal_check.setText(&#34;Canal 2&#34;)
        self.canal_window.addWidget(self.first_signal_second_canal_check)

        self.stimulation_type_label2 = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell2 = QComboBox()
        self.stimulation_type_cell2.addItem(&#34;square&#34;)
        self.stimulation_type_cell2.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell2.addItem(&#34;Third&#34;)
        self.stimulation_type_cell2.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window2 = QHBoxLayout()
        self.stimulation_type_window2.addWidget(self.stimulation_type_label2)
        self.stimulation_type_window2.addWidget(self.stimulation_type_cell2)
        self.canal_window.addLayout(self.stimulation_type_window2)

        self.different_signals_window2 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window2)

        self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
        self.stimulation_name_cell = QLineEdit()
        self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
        self.stimulation_name_window = QHBoxLayout()
        self.stimulation_name_window.addWidget(self.stimulation_name_label)
        self.stimulation_name_window.addWidget(self.stimulation_name_cell)
        self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

        self.first_signal_duration_window = QHBoxLayout()
        self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_label)
        self.first_signal_type_duration_cell = QLineEdit()
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_cell)
        self.first_signal_type_duration_cell.setValidator(self.onlyFloat)
        self.first_signal_type_duration_cell.textEdited.connect(self.signal_to_tree)
        self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)

        #self.stimulation_edit_layout.addLayout(self.stimulation_type_window)
        self.stimulation_edit_layout.addLayout(self.canal_window)



        self.first_signal_type_window = QVBoxLayout()
        self.first_signal_type_window.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window.setAlignment(Qt.AlignTop)
        self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container = QWidget()
        self.first_signal_type_container.setLayout(self.first_signal_type_window)

        self.first_signal_type_window2 = QVBoxLayout()
        self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window2.setAlignment(Qt.AlignTop)
        self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container2 = QWidget()
        self.first_signal_type_container2.setLayout(self.first_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.first_signal_pulses_window = QHBoxLayout()
        self.first_signal_type_pulses_label = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_label)
        self.first_signal_type_pulses_cell = QLineEdit()
        self.first_signal_type_pulses_cell.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_cell)

        self.first_signal_pulses_window2 = QHBoxLayout()
        self.first_signal_type_pulses_label2 = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_label2)
        self.first_signal_type_pulses_cell2 = QLineEdit()
        self.first_signal_type_pulses_cell2.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_cell2)

        self.first_signal_jitter_window = QHBoxLayout()
        self.first_signal_type_jitter_label = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_label)
        self.first_signal_type_jitter_cell = QLineEdit()
        self.first_signal_type_jitter_cell.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_cell)

        self.first_signal_jitter_window2 = QHBoxLayout()
        self.first_signal_type_jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_label2)
        self.first_signal_type_jitter_cell2 = QLineEdit()
        self.first_signal_type_jitter_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell2.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_cell2)

        self.first_signal_width_window = QHBoxLayout()
        self.first_signal_type_width_label = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_label)
        self.first_signal_type_width_cell = QLineEdit()
        self.first_signal_type_width_cell.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell.setText(&#34;0&#34;)
        self.first_signal_type_width_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_cell)

        self.first_signal_width_window2 = QHBoxLayout()
        self.first_signal_type_width_label2 = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_label2)
        self.first_signal_type_width_cell2 = QLineEdit()
        self.first_signal_type_width_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell2.setText(&#34;0&#34;)
        self.first_signal_type_width_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_cell2)

        self.first_signal_type_window.addLayout(self.first_signal_pulses_window)
        self.first_signal_type_window.addLayout(self.first_signal_width_window)
        self.first_signal_type_window.addLayout(self.first_signal_jitter_window)

        self.first_signal_type_window2.addLayout(self.first_signal_pulses_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_width_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_jitter_window2)
# -------------------

        self.second_signal_type_window = QVBoxLayout()
        self.second_signal_type_container = QWidget()
        self.second_signal_type_window.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window.setAlignment(Qt.AlignTop)
        self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container.setLayout(self.second_signal_type_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.second_signal_type_window2 = QVBoxLayout()
        self.second_signal_type_container2 = QWidget()
        self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window2.setAlignment(Qt.AlignTop)
        self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

        self.second_signal_frequency_window = QHBoxLayout()
        self.second_signal_type_frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_label)
        self.second_signal_type_frequency_cell = QLineEdit()
        self.second_signal_type_frequency_cell.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_cell)

        self.second_signal_frequency_window2 = QHBoxLayout()
        self.second_signal_type_frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_label2)
        self.second_signal_type_frequency_cell2 = QLineEdit()
        self.second_signal_type_frequency_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_cell2)

        self.second_signal_duty_window = QHBoxLayout()
        self.second_signal_type_duty_label = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_label)
        self.second_signal_type_duty_cell = QLineEdit()
        self.second_signal_type_duty_cell.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_cell)

        self.second_signal_duty_window2 = QHBoxLayout()
        self.second_signal_type_duty_label2 = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_label2)
        self.second_signal_type_duty_cell2 = QLineEdit()
        self.second_signal_type_duty_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_cell2)

        self.second_signal_type_window.addLayout(self.second_signal_frequency_window)
        self.second_signal_type_window.addLayout(self.second_signal_duty_window)

        self.second_signal_type_window2.addLayout(self.second_signal_frequency_window2)
        self.second_signal_type_window2.addLayout(self.second_signal_duty_window2)

# -------------------

        self.third_signal_type_window = QVBoxLayout()
        self.third_signal_type_container = QWidget()
        self.third_signal_type_container.setLayout(self.third_signal_type_window)

        self.third_signal_type_window2 = QVBoxLayout()
        self.third_signal_type_container2 = QWidget()
        self.third_signal_type_container2.setLayout(self.third_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.third_signal_type_name = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window.addWidget(self.third_signal_type_name)

        self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

        self.different_signals_window.addWidget(self.second_signal_type_container)
        self.different_signals_window.addWidget(self.first_signal_type_container)
        self.different_signals_window.addWidget(self.third_signal_type_container)

        self.different_signals_window2.addWidget(self.second_signal_type_container2)
        self.different_signals_window2.addWidget(self.first_signal_type_container2)
        self.different_signals_window2.addWidget(self.third_signal_type_container2)

        self.stimulation_edit_container = QWidget()
        self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
        self.block_edit_layout = QVBoxLayout()
        self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
        self.block_edit_layout.setAlignment(Qt.AlignLeft)
        self.block_edit_layout.setAlignment(Qt.AlignTop)

        self.block_name_label = QLabel(&#34;Block Name&#34;)
        self.block_name_cell = QLineEdit()
        self.block_name_cell.textEdited.connect(self.name_to_tree)
        self.block_name_window = QHBoxLayout()
        self.block_name_window.addWidget(self.block_name_label)
        self.block_name_window.addWidget(self.block_name_cell)
        self.block_edit_layout.addLayout(self.block_name_window)

        self.block_iterations_window = QHBoxLayout()
        self.block_iterations_label = QLabel(&#34;Iterations&#34;)
        self.block_iterations_cell = QLineEdit()
        self.block_iterations_cell.setValidator(self.onlyInt)
        self.block_iterations_cell.textEdited.connect(self.block_to_tree)
        self.block_iterations_window.addWidget(self.block_iterations_label)
        self.block_iterations_window.addWidget(self.block_iterations_cell)
        self.block_edit_layout.addLayout(self.block_iterations_window)

        self.block_delay_window = QHBoxLayout()
        self.block_delay_label = QLabel(&#34;Delay&#34;)
        self.block_delay_cell = QLineEdit()
        self.block_delay_cell.setValidator(self.onlyFloat)
        self.block_delay_cell.textEdited.connect(self.block_to_tree)
        self.block_delay_window = QHBoxLayout()
        self.block_delay_window.addWidget(self.block_delay_label)
        self.block_delay_window.addWidget(self.block_delay_cell)
        self.block_edit_layout.addLayout(self.block_delay_window)

        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_label = QLabel(&#34;Jitter&#34;)
        self.block_jitter_cell = QLineEdit()
        self.block_jitter_cell.setValidator(self.onlyFloat)
        self.block_jitter_cell.textEdited.connect(self.block_to_tree)
        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_window.addWidget(self.block_jitter_label)
        self.block_jitter_window.addWidget(self.block_jitter_cell)
        self.block_edit_layout.addLayout(self.block_jitter_window)

        self.block_edit_container = QWidget()
        self.block_edit_container.setLayout(self.block_edit_layout)
        self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
        self.signal_adjust_superposed.addWidget(self.block_edit_container)
        self.signal_adjust_superposed.addWidget(QLabel())
        self.signal_adjust_superposed.setCurrentIndex(2)
        self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

        self.signal_preview_label = QLabel(&#39;Signal Preview&#39;)
        self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_preview_label, 2, 2)

        self.buttons_main_window = QHBoxLayout()
        self.stop_button = QPushButton(&#39;Stop&#39;)
        self.stop_button.setIcon(QIcon(&#34;gui/icons/player-stop.png&#34;))
        self.stop_button.clicked.connect(self.stop_while_running)
        self.stop_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.stop_button)
        self.run_button = QPushButton(&#39;Run&#39;)
        self.run_button.setIcon(QIcon(&#34;gui/icons/player-play.png&#34;))
        self.run_button.clicked.connect(self.run)
        self.run_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.run_button)
        self.plot_window = PlotWindow()
        self.grid_layout.addWidget(self.plot_window, 3, 2)
        self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
        self.open_daq_generation_thread()
        self.initialize_buttons()
        self.show()

    def run(self):
        self.daq.start_runtime = time.time()
        self.deactivate_buttons(buttons=self.enabled_buttons)
        print(str(time.time()-self.daq.start_runtime) + &#34;to deactivate buttons&#34;)
        self.master_block = self.create_blocks()
        print(str(time.time()-self.daq.start_runtime) + &#34;to generate master block&#34;)
        self.plot(item=self.stimulation_tree.invisibleRootItem())
        print(str(time.time()-self.daq.start_runtime) + &#34;to plot the signal&#34;)
        self.root_time, self.root_signal = self.plot_x_values, [self.plot_stim1_values, self.plot_stim2_values]
        self.draw(root=True)
        print(str(time.time()-self.daq.start_runtime) + &#34;to draw the signal&#34;)
        #self.open_signal_preview_thread()
        self.open_live_preview_thread()
        self.open_start_experiment_thread()

    def open_start_experiment_thread(self):
        self.start_experiment_thread = Thread(target=self.run_stimulation)
        self.start_experiment_thread.start()

    def run_stimulation(self):
        self.actualize_daq()
        self.experiment = Experiment(self.master_block, int(self.framerate_cell.text()), int(self.exposure_cell.text(
        )), self.mouse_id_cell.text(), self.directory_cell.text(), self.daq, name=self.experiment_name_cell.text())
        print(str(time.time()-self.daq.start_runtime) + &#34;to intialize the experiment&#34;)
        self.experiment.start(self.root_time, self.root_signal)
        try:
            self.experiment.save(self.files_saved, self.roi_extent)
        except Exception:
            self.experiment.save(self.directory_save_files_checkbox.isChecked())
        self.stop()
        
    def open_live_preview_thread(self):
        self.live_preview_thread = Thread(target=self.start_live)
        self.live_preview_thread.start()

    def start_live(self):
        plt.ion()
        while self.camera.video_running is False:
            pass
        first =True
        while self.camera.video_running is True:
            self.plot_image.set_array(self.camera.frames[self.live_preview_light_index::len(self.daq.lights)][-1])
            if first is True:
                print(str(time.time()-self.daq.start_runtime) + &#34;to set first image&#34;)
                first = False

    def stop_live(self):
        self.video_running = False

    def open_signal_preview_thread(self):
        self.signal_preview_thread = Thread(target=self.preview_signal)
        self.signal_preview_thread.start()

    def preview_signal(self):
        plt.ion()
        while self.stop_signal is False and self.daq.control_task.is_task_done() is False:
            try:
                self.plot_window.vertical_line.set_xdata([self.daq.current_signal_time,self.daq.current_signal_time])
                time.sleep(0.5)
            except Exception:
                time.sleep(0.5)
                pass

    def change_preview_light_channel(self):
        self.live_preview_light_index = self.preview_light_combo.currentIndex()

    def open_daq_generation_thread(self):
        self.daq_generation_thread = Thread(target=self.generate_daq)
        self.daq_generation_thread.start()

    def generate_daq(self):
        self.stimuli = [Instrument(&#39;ao0&#39;, &#39;air-pump&#39;), Instrument(&#39;ao1&#39;, &#39;air-pump2&#39;)]
        self.camera = Camera(&#39;port0/line4&#39;, &#39;name&#39;)
        self.daq = DAQ(&#39;dev1&#39;, [], self.stimuli, self.camera, int(self.framerate_cell.text()), int(self.exposure_cell.text())/100)

    def actualize_daq(self):
        lights = []
        if self.ir_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line3&#39;, &#39;ir&#39;))
        if self.red_checkbox.isChecked():
            lights.append( Instrument(&#39;port0/line0&#39;, &#39;red&#39;))
        if self.green_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line2&#39;, &#39;green&#39;))
        if self.fluorescence_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line1&#39;, &#39;blue&#39;))
        self.daq.lights = lights
        self.camera.frames = []
        self.daq.stop_signal = False


        # TODO divide by 1000

    def create_blocks(self, item=None):
        try:
            if item is None:
                item = self.stimulation_tree.invisibleRootItem()
            if item.childCount() &gt; 0:
                children = []
                for index in range(item.childCount()):
                    children.append(self.create_blocks(item=item.child(index)))
                if item == self.stimulation_tree.invisibleRootItem():
                    return Block(&#34;root&#34;, children)
                return Block(item.text(0), children, delay=int(item.text(2)), iterations=int(item.text(1)))
            else:
                duration = int(item.text(6))
                if item.text(18) == &#34;True&#34;:
                    canal1 = True
                    sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
                else:
                    canal1=False
                    sign_type, pulses, jitter, width, frequency, duty = 0, 0, 0, 0, 0,0

                if item.text(19) == &#34;True&#34;:
                    canal2 =True
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
                else:
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = 0,0,0,0,0,0
                    canal2 = False
                return Stimulation(self.daq, duration, canal1=canal1, canal2=canal2, pulses=pulses, pulses2=pulses2, jitter=jitter, jitter2=jitter2, width=width, width2=width2, frequency=frequency, frequency2=frequency2, duty=duty, duty2=duty2, pulse_type1=sign_type, pulse_type2=sign_type2, name=item.text(0))
        except Exception as err:
            pass

    def get_tree_item_attributes(self, item, canal=1):
        if canal ==1:
            sign_type = item.text(4)
            duration = float(item.text(6))
            try:
                pulses = int(item.text(5))
                jitter = float(item.text(7))
                width = float(item.text(8))
            except Exception:
                pulses, jitter, width = 0, 0, 0
            try:
                frequency = float(item.text(9))
                duty = float(item.text(10))/100
            except Exception:
                frequency, duty = 0, 0
            return [sign_type, pulses, jitter, width, frequency, duty]

        elif canal ==2:
            sign_type = item.text(11)
            duration = float(item.text(6))
            try:
                pulses = int(item.text(12))
                jitter = float(item.text(13))
                width = float(item.text(14))
            except Exception:
                pulses, jitter, width = 0, 0, 0
            try:
                frequency = float(item.text(15))
                duty = float(item.text(16))/100
            except Exception:
                frequency, duty = 0, 0
            return [sign_type, pulses, jitter, width, frequency, duty]

    def stop(self):
        self.daq.stop_signal = True
        self.daq.stop_signal = True
        self.stop_live()
        self.activate_buttons(buttons = self.enabled_buttons)

    def stop_while_running(self):
        self.stop()
        if self.directory_save_files_checkbox.isChecked():
            self.stop_stimulation_dialog()

    def stop_stimulation_dialog(self):
        button = QMessageBox.question(self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;)
        if button == QMessageBox.Yes:
            print(&#34;Yes!&#34;)
        else:
            print(&#34;No!&#34;)


    def show_buttons(self, buttons):
        for button in buttons:
            button.setVisible(True)

    def hide_buttons(self, buttons):
        for button in buttons:
            button.setVisible(False)

    def activate_buttons(self, buttons):
        if buttons == self.enabled_buttons:
            if self.directory_save_files_checkbox.isChecked():
                self.directory_choose_button.setEnabled(True)
            self.stop_button.setDisabled(True)
        for button in buttons:
            button.setEnabled(True)

    def deactivate_buttons(self, buttons):
        if buttons == self.enabled_buttons:
            self.stop_button.setEnabled(True)
            self.stimulation_tree.clearSelection()
        for button in buttons:
            button.setDisabled(True)

    def choose_directory(self):
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        self.directory_cell.setText(folder)

    def enable_directory(self):
        self.files_saved = self.directory_save_files_checkbox.isChecked()
        self.directory_choose_button.setEnabled(self.files_saved)
        self.directory_cell.setEnabled(self.files_saved)

    def first_stimulation(self):
        #self.run_button.setEnabled(True)
        stimulation_tree_item = QTreeWidgetItem()
        self.style_tree_item(stimulation_tree_item)
        self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
        self.stimulation_tree_switch_window.setCurrentIndex(0)
        self.stimulation_tree.setCurrentItem(stimulation_tree_item)
        self.canals_to_tree(first=True)
        self.type_to_tree(first=True)
        self.check_global_validity()

    def add_brother(self):
        if self.stimulation_tree.currentItem():
            stimulation_tree_item = QTreeWidgetItem()
            self.style_tree_item(stimulation_tree_item)
            parent = self.stimulation_tree.selectedItems()[0].parent()
            if parent:
                index = parent.indexOfChild(self.stimulation_tree.selectedItems()[0])
                parent.insertChild(index+1, stimulation_tree_item)
            else:
                self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
            self.stimulation_tree.setCurrentItem(stimulation_tree_item)
            self.type_to_tree(first=True)
            self.canals_to_tree(first=True)
            self.check_global_validity()

    def add_child(self):
        if self.stimulation_tree.currentItem():
            self.stimulation_tree.currentItem().setIcon(0, QIcon(&#34;gui/icons/package.png&#34;))
            self.stimulation_tree.currentItem().setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
            stimulation_tree_item = QTreeWidgetItem()
            self.style_tree_item(stimulation_tree_item)
            self.stimulation_tree.selectedItems()[0].addChild(stimulation_tree_item)
            self.stimulation_tree.selectedItems()[0].setExpanded(True)
            self.stimulation_tree.setCurrentItem(stimulation_tree_item)
            self.type_to_tree(first=True)
            self.canals_to_tree(first=True)
            self.check_global_validity()

    def delete_branch(self):
        try:
            parent = self.stimulation_tree.currentItem().parent()
            if parent.childCount() == 1:
                parent.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
        except Exception:
            parent = self.stimulation_tree.invisibleRootItem()
        parent.removeChild(self.stimulation_tree.currentItem())
        self.check_global_validity()


    def style_tree_item(self, item):
        item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
        item.setForeground(0, QBrush(QColor(211, 211, 211)))
        item.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
        item.setText(0, &#34;No Name&#34;)


    def actualize_window(self):
        if self.stimulation_tree.currentItem():
            self.stimulation_tree_switch_window.setCurrentIndex(0)
        else:
            self.stimulation_tree_switch_window.setCurrentIndex(1)
        try:
            if self.stimulation_tree.currentItem().childCount() &gt; 0:
                self.signal_adjust_superposed.setCurrentIndex(1)
            else:
                self.signal_adjust_superposed.setCurrentIndex(0)
        except AttributeError:
            self.signal_adjust_superposed.setCurrentIndex(2)
        self.tree_to_name()
        self.tree_to_block()
        self.tree_to_type()
        self.tree_to_signal()
        self.tree_to_canal()
        self.clear_plot()
        self.plot()
        self.draw()

    def name_to_tree(self):
        branch = self.stimulation_tree.currentItem()
        branch.setForeground(0, QBrush(QColor(0, 0, 0)))
        if branch.childCount() &gt; 0:
            branch.setText(0, self.block_name_cell.text())
        else:
            branch.setText(0, self.stimulation_name_cell.text())

    def tree_to_name(self):
        try:
            if self.stimulation_tree.currentItem().childCount() &gt; 0:
                if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.block_name_cell.setText(
                        self.stimulation_tree.currentItem().text(0))
                else:
                    self.block_name_cell.setText(&#34;&#34;)
            else:
                if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.stimulation_name_cell.setText(
                        self.stimulation_tree.currentItem().text(0))
                else:
                    self.stimulation_name_cell.setText(&#34;&#34;)
        except AttributeError:
            pass

    def type_to_tree(self, first=False):
        if first is True:
            self.stimulation_type_cell.setCurrentIndex(0)
            self.stimulation_type_cell2.setCurrentIndex(0)
        else:
            self.check_global_validity()
        self.different_signals_window.setCurrentIndex(self.stimulation_type_cell.currentIndex())
        self.different_signals_window2.setCurrentIndex(self.stimulation_type_cell2.currentIndex())
        #self.check_stim_validity()
        try:
            self.stimulation_tree.currentItem().setText(4, str(self.stimulation_type_cell.currentText()))
        except Exception:
            pass
        try:
            self.stimulation_tree.currentItem().setText(11, str(self.stimulation_type_cell2.currentText()))
        except Exception:
            pass
        try:
            self.clear_plot()
            self.plot()
            self.draw()
        except Exception:
            pass

    def tree_to_type(self):
        dico = {
            &#34;square&#34;: 0,
            &#34;random-square&#34;: 1,
            &#34;Third&#34;: 2
        }
        try:
            self.stimulation_type_cell.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(4)])
        except Exception:
            self.stimulation_type_cell.setCurrentIndex(0)

        try:
            self.stimulation_type_cell2.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(11)])
        except Exception:
            self.stimulation_type_cell2.setCurrentIndex(0)

    def signal_to_tree(self):
        self.stimulation_tree.currentItem().setText(6, self.first_signal_type_duration_cell.text())

        self.stimulation_tree.currentItem().setText(5, self.first_signal_type_pulses_cell.text())
        self.stimulation_tree.currentItem().setText(7, self.first_signal_type_jitter_cell.text())
        self.stimulation_tree.currentItem().setText(8, self.first_signal_type_width_cell.text())
        self.stimulation_tree.currentItem().setText(9, self.second_signal_type_frequency_cell.text())
        self.stimulation_tree.currentItem().setText(10, self.second_signal_type_duty_cell.text())

        self.stimulation_tree.currentItem().setText(12, self.first_signal_type_pulses_cell2.text())
        self.stimulation_tree.currentItem().setText(13, self.first_signal_type_jitter_cell2.text())
        self.stimulation_tree.currentItem().setText(14, self.first_signal_type_width_cell2.text())
        self.stimulation_tree.currentItem().setText(15, self.second_signal_type_frequency_cell2.text())
        self.stimulation_tree.currentItem().setText(16, self.second_signal_type_duty_cell2.text())


        self.check_global_validity()
        self.clear_plot()
        self.plot()
        self.draw()


    def tree_to_signal(self):
        try:
            self.first_signal_type_pulses_cell.setText(self.stimulation_tree.currentItem().text(5))
            self.first_signal_type_duration_cell.setText(self.stimulation_tree.currentItem().text(6))
            self.first_signal_type_jitter_cell.setText(self.stimulation_tree.currentItem().text(7))
            self.first_signal_type_width_cell.setText(self.stimulation_tree.currentItem().text(8))
            self.second_signal_type_frequency_cell.setText(self.stimulation_tree.currentItem().text(9))
            self.second_signal_type_duty_cell.setText(self.stimulation_tree.currentItem().text(10))
            self.first_signal_type_pulses_cell2.setText(self.stimulation_tree.currentItem().text(12))
            self.first_signal_type_jitter_cell2.setText(self.stimulation_tree.currentItem().text(13))
            self.first_signal_type_width_cell2.setText(self.stimulation_tree.currentItem().text(14))
            self.second_signal_type_frequency_cell2.setText(self.stimulation_tree.currentItem().text(15))
            self.second_signal_type_duty_cell2.setText(self.stimulation_tree.currentItem().text(16))
        except Exception as err:
            pass

    def tree_to_block(self):
        try:
            self.block_iterations_cell.setText(self.stimulation_tree.currentItem().text(1))
            self.block_delay_cell.setText(self.stimulation_tree.currentItem().text(2))
            self.block_jitter_cell.setText(self.stimulation_tree.currentItem().text(3))
        except Exception:
            pass

    def block_to_tree(self):
        self.stimulation_tree.currentItem().setText(1, self.block_iterations_cell.text())
        self.stimulation_tree.currentItem().setText(2, self.block_delay_cell.text())
        self.stimulation_tree.currentItem().setText(3, self.block_jitter_cell.text())
        self.check_global_validity()
        self.clear_plot()
        self.plot()
        self.draw()

    def tree_to_canal(self):
        self.canal_running = True
        try:
            self.first_signal_first_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(18)))
            self.first_signal_second_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(19)))
            if self.first_signal_first_canal_check.isChecked():
                    self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.first_signal_second_canal_check.isChecked():
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
        except Exception:
            pass
        self.canal_running = False

    def canals_to_tree(self, int=0, first=False):
        if not self.canal_running:
            if first:
                self.stimulation_tree.currentItem().setText(18, &#34;False&#34;)
                self.stimulation_tree.currentItem().setText(19, &#34;False&#34;)
                self.deactivate_buttons(self.canal1buttons)
                self.deactivate_buttons(self.canal2buttons)
            else:
                self.stimulation_tree.currentItem().setText(18, str(self.first_signal_first_canal_check.isChecked()))
                if self.first_signal_first_canal_check.isChecked():
                    self.activate_buttons(self.canal1buttons)
                else:
                    self.deactivate_buttons(self.canal1buttons)
                if self.first_signal_second_canal_check.isChecked():
                    self.activate_buttons(self.canal2buttons)
                else:
                    self.deactivate_buttons(self.canal2buttons)
                self.stimulation_tree.currentItem().setText(19, str(self.first_signal_second_canal_check.isChecked()))
                self.first_signal_type_pulses_cell2.setEnabled(self.first_signal_second_canal_check.isChecked())
                self.check_global_validity()

    def enable_run(self):
        self.run_button.setDisabled(False)

    def disable_run(self):
        self.run_button.setDisabled(True)

    def count_lights(self):
        count = 0
        text = []
        for checkbox in [self.ir_checkbox, self.red_checkbox, self.green_checkbox, self.fluorescence_checkbox]:
            if checkbox.isChecked():
                count += 1
                text.append(checkbox.text())
        return (count, text)

    def check_lights(self):
        self.preview_light_combo.clear()
        if self.count_lights()[0] == 0:
            self.preview_light_combo.setEnabled(False)
        else:
            self.preview_light_combo.setEnabled(True)
        for i in range(4):
            if i &lt; self.count_lights()[0]:
                self.preview_light_combo.addItem(self.count_lights()[1][i])
        self.check_global_validity()
    
    def check_global_validity(self, item=None):
        if item is None:
            item = self.stimulation_tree.invisibleRootItem()
            if self.check_block_validity(item) is True and (self.ir_checkbox.isChecked() or self.red_checkbox.isChecked() or self.green_checkbox.isChecked() or self.fluorescence_checkbox.isChecked()):
                self.enable_run()
            else:
                self.disable_run()
        elif item.childCount() &gt; 0:
            self.set_icon(item, self.check_block_validity(item))
        else:
            self.set_icon(item, self.check_stim_validity(item))
        for child_index in range(item.childCount()):
            self.check_global_validity(item.child(child_index))

    def check_stim_validity(self, item=None):
        valid = True
        if item is None:
            item == self.stimulation_tree.currentItem()
        if item.text(6) == &#34;&#34;:
            valid = False

        if item.text(18) == &#34;True&#34;:
            if item.text(4) == &#34;square&#34; and item.text(9) != &#34;&#34; and item.text(10) != &#34;&#34;:
                pass
            elif item.text(4) == &#34;random-square&#34; and item.text(5) != &#34;&#34; and item.text(7) != &#34;&#34; and item.text(8) != &#34;&#34;:
                pass
            else:
                valid = False

        if item.text(19) == &#34;True&#34;:
            if item.text(11) == &#34;square&#34; and item.text(15) != &#34;&#34; and item.text(16) != &#34;&#34;:
                pass
            elif item.text(11) == &#34;random-square&#34; and item.text(12) != &#34;&#34; and item.text(13) != &#34;&#34; and item.text(4) != &#34;&#34;:
                pass
            else:
                valid = False
        return valid

    def check_block_validity(self, item=None):
        valid = True
        if item is None:
            item = self.stimulation_tree.currentItem()
        if item.childCount() == 0:
            return self.check_stim_validity(item=item)
        if item == self.stimulation_tree.invisibleRootItem():
            if item.childCount() == 0:
                valid = False
        elif item.childCount() &gt; 0:
            valid = item.text(1) != &#34;&#34; and item.text(2) != &#34;&#34; and item.text(3) != &#34;&#34;
        for child_index in range(item.childCount()):
            if not self.check_block_validity(item.child(child_index)):
                valid = False
        return valid

    def set_icon(self, item, valid):
        try:
            if valid:
                item.setIcon(20, QIcon(&#34;gui/icons/circle-check.png&#34;))
            else:
                item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
        except Exception:
            pass


    def boolean(self, string):
        if string == &#34;True&#34;:
            return True
        return False

    def clear_plot(self):
        self.plot_window.clear()

    def plot(self, item=None):
        try:
            if item is None:
                item = self.stimulation_tree.currentItem()
            if item.childCount() &gt; 0:
                if item == self.stimulation_tree.invisibleRootItem():
                    jitter, block_delay, iterations_number = 0, 0, 1
                else:
                    jitter = float(item.text(3))
                    iterations_number = int(item.text(1))
                    block_delay = float(item.text(2))

                for iteration in range(iterations_number):
                    for index in range(item.childCount()):
                        child = item.child(index)
                        self.plot(child)
                    delay = round(block_delay + random.random()*jitter, 3)
                    time_values = np.linspace(0, delay, int(round(delay))*3000)
                    data = np.zeros(len(time_values))
                    time_values += self.elapsed_time
                    self.elapsed_time += delay
                    self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data))
            else:
                duration = float(item.text(6))
                time_values = np.linspace(0, duration, int(round(duration))*3000)
                time_values += self.elapsed_time
                self.elapsed_time += duration
                self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
                if item.text(18) == &#34;True&#34;:
                    sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
                    data = make_signal(time_values, sign_type, width, pulses, jitter, frequency, duty)
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
                else:
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, np.zeros(len(time_values))))

                if item.text(19) == &#34;True&#34;:
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
                    data2 = make_signal(time_values, sign_type2, width2, pulses2, jitter2, frequency2, duty2)
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data2))
                else:
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, np.zeros(len(time_values))))
        except Exception as err:
            self.plot_x_values = []
            self.plot_y_values = []
            self.elapsed_time = 0

    def draw(self, root=False):
        new_x_values = []
        new_stim1_values = []
        new_stim2_values = []
        try:
            time_start = time.time()
            sampling_indexes = np.linspace(0, len(self.plot_x_values)-1, round(3000+len(self.plot_x_values)/10), dtype=int)
            new_x_values = np.take(self.plot_x_values, sampling_indexes, 0)
            new_stim1_values = np.take(self.plot_stim1_values, sampling_indexes, 0)
            new_stim2_values = np.take(self.plot_stim2_values, sampling_indexes, 0)
            #self.plot_window.plot(new_x_values, new_stim1_values, root)
            #self.plot_window.plot(new_x_values, new_stim2_values, root, color=&#34;g&#34;)
            self.plot_window.plot(self.plot_x_values, self.plot_stim1_values, root)
            self.plot_window.plot(self.plot_x_values, self.plot_stim2_values, root, color=&#34;g&#34;)
            #print(f&#34;plot time:{time.time()-time_start}&#34;)
            self.plot_x_values = []
            self.plot_stim1_values = []
            self.plot_stim2_values = []
            self.elapsed_time = 0
        except Exception as err:
            pass

    def set_roi(self):
        self.deactivate_buttons(buttons = self.enabled_buttons)
        self.stop_button.setEnabled(False)
        self.save_roi_button.setEnabled(False)
        self.roi_buttons.setCurrentIndex(1)

        def onselect_function(eclick, erelease):
            self.roi_extent = self.rect_selector.extents
            self.save_roi_button.setEnabled(True)

        self.rect_selector = RectangleSelector(self.plot_image.axes, onselect_function,
                                               drawtype=&#39;box&#39;, useblit=True,
                                               button=[1, 3],
                                               minspanx=5, minspany=5,
                                               spancoords=&#39;pixels&#39;,
                                               interactive=True)

    def reset_roi(self):
        plt.xlim(0, 1024)
        plt.ylim(0, 1024)
        self.roi_extent = None
        self.reset_roi_button.setEnabled(False)

    def cancel_roi(self):
        self.activate_buttons(buttons = self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        self.rect_selector.clear()
        self.rect_selector = None

    def save_roi(self):
        self.activate_buttons(buttons = self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        plt.ion()
        plt.xlim(self.roi_extent[0], self.roi_extent[1])
        plt.ylim(self.roi_extent[2], self.roi_extent[3])
        self.rect_selector.clear()
        self.rect_selector = None
        self.reset_roi_button.setEnabled(True)

    def verify_exposure(self):
        try:
            boolean_check =  (int(self.exposure_cell.text())/1000+0.0015)*int(self.framerate_cell.text()) &lt; 1
        except Exception:
            boolean_check = False
        self.exposure_warning_label.setHidden(boolean_check)
        self.check_run()

    def check_run(self):
        pass

    def check_if_thread_is_alive(self):
        try:
            if self.live_preview_thread.is_alive():
                print(&#34;Live preview thread is alive&#34;)
            else:
                print(&#34;Live preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.start_experiment_thread.is_alive():
                print(&#34;Start Experiment thread is alive&#34;)
            else:
                print(&#34;Start experiment thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.daq_generation_thread.is_alive():
                print(&#34;Daq Generation thread is alive&#34;)
            else:
                print(&#34;Daq generation thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.signal_preview_thread.is_alive():
                print(&#34;Signal Preview thread is alive&#34;)
            else:
                print(&#34;Signal Preview thread is dead&#34;)
        except Exception as err:
            print(err)

    def initialize_buttons(self):
        self.canal1buttons = [self.stimulation_type_label, self.stimulation_type_cell, self.first_signal_type_pulses_label, self.first_signal_type_pulses_cell, self.first_signal_type_width_label, self.first_signal_type_width_cell, self.first_signal_type_jitter_label, self.first_signal_type_jitter_cell, self.second_signal_type_frequency_label, self.second_signal_type_frequency_cell, self.second_signal_type_duty_label, self.second_signal_type_duty_cell]
        self.canal2buttons = [self.stimulation_type_label2, self.stimulation_type_cell2, self.first_signal_type_pulses_label2, self.first_signal_type_pulses_cell2, self.first_signal_type_width_label2, self.first_signal_type_width_cell2, self.first_signal_type_jitter_label2, self.first_signal_type_jitter_cell2, self.second_signal_type_frequency_label2, self.second_signal_type_frequency_cell2, self.second_signal_type_duty_label2, self.second_signal_type_duty_cell2]
        self.enabled_buttons = [
            self.run_button,
            self.experiment_name_cell,
            self.mouse_id_cell,
            #self.directory_save_files_checkbox,
            self.directory_choose_button,
            self.set_roi_button,
            self.experiment_name,
            self.mouse_id_label,
            self.framerate_label,
            self.framerate_cell,
            self.exposure_cell,
            self.exposure_label,
            self.add_brother_branch_button,
            self.add_child_branch_button,
            self.delete_branch_button,
            self.red_checkbox,
            self.ir_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
            self.stimulation_name_label,
            self.stimulation_name_cell,
            self.stimulation_type_label,
            self.stimulation_type_cell,
            self.first_signal_first_canal_check,
            self.first_signal_second_canal_check,
            self.first_signal_type_duration_label,
            self.first_signal_type_duration_cell,
            self.first_signal_type_pulses_label,
            self.first_signal_type_pulses_cell,
            self.first_signal_type_width_label,
            self.first_signal_type_width_cell,
            self.first_signal_type_jitter_label,
            self.first_signal_type_jitter_cell,
            self.second_signal_type_frequency_label,
            self.second_signal_type_frequency_cell,
            self.second_signal_type_duty_label,
            self.second_signal_type_duty_cell,
            self.block_iterations_label,
            self.block_iterations_cell,
            self.block_delay_label,
            self.block_delay_cell,
            self.block_jitter_label,
            self.block_jitter_cell,
            self.block_name_label,
            self.block_name_cell,
            self.activate_live_preview_button,
            self.deactivate_live_preview_button,
            self.stimulation_tree
        ]


if __name__ == &#39;__main__&#39;:
    app = QApplication(sys.argv)
    font = QFont()
    font.setFamily(&#34;IBM Plex Sans&#34;)
    app.setFont(font)
    ex = App()
    sys.exit(app.exec_())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App"><code class="flex name class">
<span>class <span class="ident">App</span></span>
</code></dt>
<dd>
<div class="desc"><p>QWidget(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class App(QWidget):

    def __init__(self):
        super().__init__()
        self.title = &#39;Widefield Imaging Aquisition&#39;
        self.left = 10
        self.top = 10
        self.width = 640
        self.height = 480
        self.initUI()

    def closeEvent(self, *args, **kwargs):
        self.daq.stop_signal = True
        self.video_running = False
        self.daq.camera.cam.stop_acquisition()
        print(&#34;Closed&#34;)

    def initUI(self):
        self.setWindowTitle(self.title)
        self.setGeometry(self.left, self.top, self.width, self.height)

        self.plot_x_values = []
        self.plot_stim1_values = []
        self.plot_stim2_values = []
        self.elapsed_time = 0
        self.files_saved = False
        self.onlyInt = QIntValidator()
        self.onlyFloat = QDoubleValidator()
        self.onlyFramerate = QIntValidator()
        self.onlyFramerate.setRange(1, 57)
        self.onlyExposure = QIntValidator()
        self.onlyExposure.setRange(1,900)

        self.grid_layout = QGridLayout()
        self.setLayout(self.grid_layout)
        self.grid_layout.setAlignment(Qt.AlignTop)

        self.experiment_settings_label = QLabel(&#39;Experiment Settings&#39;)
        self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

        self.experiment_settings_main_window = QVBoxLayout()
        self.experiment_name_window = QHBoxLayout()
        self.experiment_name = QLabel(&#39;Experiment Name&#39;)
        self.experiment_name_window.addWidget(self.experiment_name)
        self.experiment_name_cell = QLineEdit()
        self.experiment_name_window.addWidget(self.experiment_name_cell)
        self.experiment_settings_main_window.addLayout(self.experiment_name_window)

        self.mouse_id_window = QHBoxLayout()
        self.mouse_id_label = QLabel(&#39;Mouse ID&#39;)
        self.mouse_id_window.addWidget(self.mouse_id_label)
        self.mouse_id_cell = QLineEdit()
        self.mouse_id_window.addWidget(self.mouse_id_cell)
        self.experiment_settings_main_window.addLayout(self.mouse_id_window)

        self.directory_window = QHBoxLayout()
        self.directory_save_files_checkbox = QCheckBox()
        self.directory_save_files_checkbox.setText(&#34;Save&#34;)
        self.directory_save_files_checkbox.stateChanged.connect(self.check_if_thread_is_alive)
        #TODO Change for real function
        self.directory_window.addWidget(self.directory_save_files_checkbox)
        self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
        self.directory_choose_button.setIcon(QIcon(&#34;gui/icons/folder-plus.png&#34;))
        self.directory_choose_button.setDisabled(True)
        self.directory_choose_button.clicked.connect(self.choose_directory)
        self.directory_window.addWidget(self.directory_choose_button)
        self.directory_cell = QLineEdit(&#34;&#34;)
        self.directory_cell.setReadOnly(True)
        self.directory_window.addWidget(self.directory_cell)
        self.experiment_settings_main_window.addLayout(self.directory_window)

        self.experiment_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)

        self.image_settings_label = QLabel(&#39;Image Settings&#39;)
        self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.image_settings_label, 0, 1)

        self.image_settings_main_window = QVBoxLayout()
        self.image_settings_main_window.setAlignment(Qt.AlignLeft)
        self.image_settings_main_window.setAlignment(Qt.AlignTop)

        self.framerate_window = QHBoxLayout()
        self.framerate_label = QLabel(&#39;Framerate&#39;)
        self.framerate_window.addWidget(self.framerate_label)
        self.framerate_cell = QLineEdit(&#39;30&#39;)
        self.framerate_cell.setValidator(self.onlyFramerate)
        self.framerate_cell.textChanged.connect(self.verify_exposure)
        self.framerate_window.addWidget(self.framerate_cell)
        self.image_settings_main_window.addLayout(self.framerate_window)

        self.exposure_window = QHBoxLayout()
        self.exposure_label = QLabel(&#39;Exposure (ms)&#39;)
        self.exposure_window.addWidget(self.exposure_label)
        self.exposure_cell = QLineEdit(&#39;10&#39;)
        self.exposure_cell.setValidator(self.onlyExposure)
        self.exposure_cell.textChanged.connect(self.verify_exposure)
        self.exposure_window.addWidget(self.exposure_cell)
        self.image_settings_main_window.addLayout(self.exposure_window)

        self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
        self.image_settings_main_window.addWidget(self.exposure_warning_label)
        self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
        self.exposure_warning_label.setHidden(True)

        self.image_settings_second_window = QHBoxLayout()
        self.ir_checkbox = QCheckBox(&#39;Infrared&#39;)
        self.ir_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.ir_checkbox)
        self.red_checkbox = QCheckBox(&#39;Red&#39;)
        self.red_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.red_checkbox)
        self.green_checkbox = QCheckBox(&#39;Green&#39;)
        self.green_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.green_checkbox)
        self.fluorescence_checkbox = QCheckBox(&#39;Blue&#39;)
        self.fluorescence_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

        self.light_channel_layout = QHBoxLayout()
        self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
        self.light_channel_layout.addWidget(self.preview_light_label)
        self.preview_light_combo = QComboBox()
        self.preview_light_combo.setEnabled(False)
        self.preview_light_combo.currentIndexChanged.connect(self.change_preview_light_channel)
        self.light_channel_layout.addWidget(self.preview_light_combo)

        self.image_settings_main_window.addLayout(self.image_settings_second_window)
        self.image_settings_main_window.addLayout(self.light_channel_layout)

        self.roi_buttons = QStackedLayout()

        self.roi_layout1 = QHBoxLayout()
        self.roi_layout1.setAlignment(Qt.AlignLeft)
        self.roi_layout1.setAlignment(Qt.AlignTop)
        self.roi_layout1.setContentsMargins(0, 0, 0, 0)
        self.reset_roi_button = QPushButton()
        self.reset_roi_button.setText(&#34;Reset ROI&#34;)
        self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
        self.reset_roi_button.setEnabled(False)
        self.reset_roi_button.clicked.connect(self.reset_roi)
        self.roi_layout1.addWidget(self.reset_roi_button)

        self.set_roi_button = QPushButton()
        self.set_roi_button.setText(&#34;Set ROI&#34;)
        self.set_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-in-area.png&#34;))
        self.set_roi_button.clicked.connect(self.set_roi)
        self.roi_layout1.addWidget(self.set_roi_button)
        self.roi_layout1_container = QWidget()
        self.roi_layout1_container.setLayout(self.roi_layout1)

        self.roi_layout2 = QHBoxLayout()
        self.roi_layout2.setAlignment(Qt.AlignLeft)
        self.roi_layout2.setAlignment(Qt.AlignTop)
        self.roi_layout2.setContentsMargins(0, 0, 0, 0)
        self.cancel_roi_button = QPushButton()
        self.cancel_roi_button.setText(&#34;Cancel&#34;)
        self.cancel_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-cancel.png&#34;))
        self.cancel_roi_button.clicked.connect(self.cancel_roi)
        self.roi_layout2.addWidget(self.cancel_roi_button)

        self.save_roi_button = QPushButton()
        self.save_roi_button.setText(&#34;Save ROI&#34;)
        self.save_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-check.png&#34;))
        self.save_roi_button.clicked.connect(self.save_roi)
        self.roi_layout2.addWidget(self.save_roi_button)
        self.roi_layout2_container = QWidget()
        self.roi_layout2_container.setLayout(self.roi_layout2)

        self.roi_buttons.addWidget(self.roi_layout1_container)
        self.roi_buttons.addWidget(self.roi_layout2_container)

        self.image_settings_main_window.addLayout(self.roi_buttons)
        self.image_settings_main_window.addStretch()

        self.activate_live_preview_button = QPushButton()
        self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
        self.activate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video&#34;))
        self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

        self.deactivate_live_preview_button = QPushButton()
        self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
        self.deactivate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video-off&#34;))
        self.deactivate_live_preview_button.clicked.connect(self.stop_live)

        self.image_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

        self.live_preview_label = QLabel(&#39;Live Preview&#39;)
        self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.numpy = np.random.rand(1024, 1024)
        self.image_view = PlotWindow()
        self.plot_image = plt.imshow(self.numpy, cmap=&#34;binary_r&#34;, vmin=0, vmax=4096)
        self.plot_image.axes.get_xaxis().set_visible(False)
        self.plot_image.axes.axes.get_yaxis().set_visible(False)

        self.grid_layout.addWidget(self.live_preview_label, 0, 2)
        self.grid_layout.addWidget(self.image_view, 1, 2)

        self.stimulation_tree_label = QLabel(&#39;Stimulation Tree&#39;)
        self.stimulation_tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.stimulation_tree_label, 2, 0)

        self.stimulation_tree_window = QVBoxLayout()
        self.stimulation_tree = QTreeWidget()
        self.stimulation_tree.setHeaderLabels([&#34;0 Name&#34;, &#34;1 Iterations&#34;, &#34;2 Delay&#34;, &#34;3 Jitter&#34;, &#34;4 Type&#34;, &#34;5 Pulses&#34;,
                                              &#34;6 Duration&#34;, &#34;7 Jitter&#34;, &#34;8 Width&#34;, &#34;9 Frequency&#34;, &#34;10 Duty&#34;, &#34;11 Type2&#34;, &#34;12 Pulses 2&#34;, &#34;13 Jitter 2&#34;, &#34;14 Width 2&#34;, &#34;15 Frequency 2&#34;, &#34;16 Duty 2&#34;, &#34;17 Blank&#34;, &#34;18 Canal 1&#34;, &#34;19 Canal 2&#34;, &#34;20 Valid&#34;])
        for i in range(19):
            self.stimulation_tree.header().hideSection(i+1)
            pass
        self.stimulation_tree.setHeaderHidden(True)
        self.stimulation_tree.setColumnWidth(0, 330)
        self.stimulation_tree.currentItemChanged.connect(self.actualize_window)
        self.stimulation_tree_window.addWidget(self.stimulation_tree)

        self.stimulation_tree_switch_window = QStackedLayout()
        self.stimulation_tree_second_window = QHBoxLayout()
        self.stim_buttons_container = QWidget()
        self.delete_branch_button = QPushButton(&#39;Delete&#39;)
        self.delete_branch_button.setIcon(QIcon(&#34;gui/icons/trash.png&#34;))
        self.delete_branch_button.clicked.connect(self.delete_branch)
        self.stimulation_tree_second_window.addWidget(self.delete_branch_button)
        self.add_brother_branch_button = QPushButton(&#39;Add Sibling&#39;)
        self.add_brother_branch_button.clicked.connect(self.add_brother)
        self.add_brother_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-down.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_brother_branch_button)
        self.add_child_branch_button = QPushButton(&#39;Add Child&#39;)
        self.add_child_branch_button.clicked.connect(self.add_child)
        self.add_child_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-right.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_child_branch_button)
        self.stim_buttons_container.setLayout(self.stimulation_tree_second_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container)

        self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
        self.new_branch_button.setIcon(QIcon(&#34;gui/icons/square-plus.png&#34;))
        self.stimulation_tree_third_window = QHBoxLayout()
        self.stimulation_tree_third_window.addWidget(self.new_branch_button)
        self.stim_buttons_container2 = QWidget()
        self.stim_buttons_container2.setLayout(self.stimulation_tree_third_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container2)
        self.new_branch_button.clicked.connect(self.first_stimulation)
        self.grid_layout.addLayout(self.stimulation_tree_switch_window, 4, 0)

        self.stimulation_tree_switch_window.setCurrentIndex(1)
        self.grid_layout.addLayout(self.stimulation_tree_window, 3, 0)

        self.signal_adjust_label = QLabel(&#39;Signal Adjust&#39;)
        self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

        self.signal_adjust_superposed = QStackedLayout()
        self.stimulation_edit_layout = QVBoxLayout()
        self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

        self.canal_window = QVBoxLayout()
        self.canal_window.setAlignment(Qt.AlignLeft)
        self.canal_window.setAlignment(Qt.AlignTop)
        self.canal_window.setContentsMargins(0, 0, 0, 0)



        self.first_signal_first_canal_check = QCheckBox()
        self.first_signal_first_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_first_canal_check.setText(&#34;Canal 1&#34;)
        self.canal_window.addWidget(self.first_signal_first_canal_check)



        self.stimulation_type_label = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell = QComboBox()
        self.stimulation_type_cell.addItem(&#34;square&#34;)
        self.stimulation_type_cell.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell.addItem(&#34;Third&#34;)
        self.stimulation_type_cell.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window = QHBoxLayout()
        self.stimulation_type_window.addWidget(self.stimulation_type_label)
        self.stimulation_type_window.addWidget(self.stimulation_type_cell)
        self.canal_window.addLayout(self.stimulation_type_window)

        self.different_signals_window = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window)

        self.first_signal_second_canal_check = QCheckBox()
        self.first_signal_second_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_second_canal_check.setText(&#34;Canal 2&#34;)
        self.canal_window.addWidget(self.first_signal_second_canal_check)

        self.stimulation_type_label2 = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell2 = QComboBox()
        self.stimulation_type_cell2.addItem(&#34;square&#34;)
        self.stimulation_type_cell2.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell2.addItem(&#34;Third&#34;)
        self.stimulation_type_cell2.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window2 = QHBoxLayout()
        self.stimulation_type_window2.addWidget(self.stimulation_type_label2)
        self.stimulation_type_window2.addWidget(self.stimulation_type_cell2)
        self.canal_window.addLayout(self.stimulation_type_window2)

        self.different_signals_window2 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window2)

        self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
        self.stimulation_name_cell = QLineEdit()
        self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
        self.stimulation_name_window = QHBoxLayout()
        self.stimulation_name_window.addWidget(self.stimulation_name_label)
        self.stimulation_name_window.addWidget(self.stimulation_name_cell)
        self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

        self.first_signal_duration_window = QHBoxLayout()
        self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_label)
        self.first_signal_type_duration_cell = QLineEdit()
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_cell)
        self.first_signal_type_duration_cell.setValidator(self.onlyFloat)
        self.first_signal_type_duration_cell.textEdited.connect(self.signal_to_tree)
        self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)

        #self.stimulation_edit_layout.addLayout(self.stimulation_type_window)
        self.stimulation_edit_layout.addLayout(self.canal_window)



        self.first_signal_type_window = QVBoxLayout()
        self.first_signal_type_window.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window.setAlignment(Qt.AlignTop)
        self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container = QWidget()
        self.first_signal_type_container.setLayout(self.first_signal_type_window)

        self.first_signal_type_window2 = QVBoxLayout()
        self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window2.setAlignment(Qt.AlignTop)
        self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container2 = QWidget()
        self.first_signal_type_container2.setLayout(self.first_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.first_signal_pulses_window = QHBoxLayout()
        self.first_signal_type_pulses_label = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_label)
        self.first_signal_type_pulses_cell = QLineEdit()
        self.first_signal_type_pulses_cell.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_cell)

        self.first_signal_pulses_window2 = QHBoxLayout()
        self.first_signal_type_pulses_label2 = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_label2)
        self.first_signal_type_pulses_cell2 = QLineEdit()
        self.first_signal_type_pulses_cell2.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_cell2)

        self.first_signal_jitter_window = QHBoxLayout()
        self.first_signal_type_jitter_label = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_label)
        self.first_signal_type_jitter_cell = QLineEdit()
        self.first_signal_type_jitter_cell.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_cell)

        self.first_signal_jitter_window2 = QHBoxLayout()
        self.first_signal_type_jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_label2)
        self.first_signal_type_jitter_cell2 = QLineEdit()
        self.first_signal_type_jitter_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell2.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_cell2)

        self.first_signal_width_window = QHBoxLayout()
        self.first_signal_type_width_label = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_label)
        self.first_signal_type_width_cell = QLineEdit()
        self.first_signal_type_width_cell.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell.setText(&#34;0&#34;)
        self.first_signal_type_width_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_cell)

        self.first_signal_width_window2 = QHBoxLayout()
        self.first_signal_type_width_label2 = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_label2)
        self.first_signal_type_width_cell2 = QLineEdit()
        self.first_signal_type_width_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell2.setText(&#34;0&#34;)
        self.first_signal_type_width_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_cell2)

        self.first_signal_type_window.addLayout(self.first_signal_pulses_window)
        self.first_signal_type_window.addLayout(self.first_signal_width_window)
        self.first_signal_type_window.addLayout(self.first_signal_jitter_window)

        self.first_signal_type_window2.addLayout(self.first_signal_pulses_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_width_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_jitter_window2)
# -------------------

        self.second_signal_type_window = QVBoxLayout()
        self.second_signal_type_container = QWidget()
        self.second_signal_type_window.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window.setAlignment(Qt.AlignTop)
        self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container.setLayout(self.second_signal_type_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.second_signal_type_window2 = QVBoxLayout()
        self.second_signal_type_container2 = QWidget()
        self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window2.setAlignment(Qt.AlignTop)
        self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

        self.second_signal_frequency_window = QHBoxLayout()
        self.second_signal_type_frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_label)
        self.second_signal_type_frequency_cell = QLineEdit()
        self.second_signal_type_frequency_cell.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_cell)

        self.second_signal_frequency_window2 = QHBoxLayout()
        self.second_signal_type_frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_label2)
        self.second_signal_type_frequency_cell2 = QLineEdit()
        self.second_signal_type_frequency_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_cell2)

        self.second_signal_duty_window = QHBoxLayout()
        self.second_signal_type_duty_label = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_label)
        self.second_signal_type_duty_cell = QLineEdit()
        self.second_signal_type_duty_cell.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_cell)

        self.second_signal_duty_window2 = QHBoxLayout()
        self.second_signal_type_duty_label2 = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_label2)
        self.second_signal_type_duty_cell2 = QLineEdit()
        self.second_signal_type_duty_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_cell2)

        self.second_signal_type_window.addLayout(self.second_signal_frequency_window)
        self.second_signal_type_window.addLayout(self.second_signal_duty_window)

        self.second_signal_type_window2.addLayout(self.second_signal_frequency_window2)
        self.second_signal_type_window2.addLayout(self.second_signal_duty_window2)

# -------------------

        self.third_signal_type_window = QVBoxLayout()
        self.third_signal_type_container = QWidget()
        self.third_signal_type_container.setLayout(self.third_signal_type_window)

        self.third_signal_type_window2 = QVBoxLayout()
        self.third_signal_type_container2 = QWidget()
        self.third_signal_type_container2.setLayout(self.third_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.third_signal_type_name = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window.addWidget(self.third_signal_type_name)

        self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

        self.different_signals_window.addWidget(self.second_signal_type_container)
        self.different_signals_window.addWidget(self.first_signal_type_container)
        self.different_signals_window.addWidget(self.third_signal_type_container)

        self.different_signals_window2.addWidget(self.second_signal_type_container2)
        self.different_signals_window2.addWidget(self.first_signal_type_container2)
        self.different_signals_window2.addWidget(self.third_signal_type_container2)

        self.stimulation_edit_container = QWidget()
        self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
        self.block_edit_layout = QVBoxLayout()
        self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
        self.block_edit_layout.setAlignment(Qt.AlignLeft)
        self.block_edit_layout.setAlignment(Qt.AlignTop)

        self.block_name_label = QLabel(&#34;Block Name&#34;)
        self.block_name_cell = QLineEdit()
        self.block_name_cell.textEdited.connect(self.name_to_tree)
        self.block_name_window = QHBoxLayout()
        self.block_name_window.addWidget(self.block_name_label)
        self.block_name_window.addWidget(self.block_name_cell)
        self.block_edit_layout.addLayout(self.block_name_window)

        self.block_iterations_window = QHBoxLayout()
        self.block_iterations_label = QLabel(&#34;Iterations&#34;)
        self.block_iterations_cell = QLineEdit()
        self.block_iterations_cell.setValidator(self.onlyInt)
        self.block_iterations_cell.textEdited.connect(self.block_to_tree)
        self.block_iterations_window.addWidget(self.block_iterations_label)
        self.block_iterations_window.addWidget(self.block_iterations_cell)
        self.block_edit_layout.addLayout(self.block_iterations_window)

        self.block_delay_window = QHBoxLayout()
        self.block_delay_label = QLabel(&#34;Delay&#34;)
        self.block_delay_cell = QLineEdit()
        self.block_delay_cell.setValidator(self.onlyFloat)
        self.block_delay_cell.textEdited.connect(self.block_to_tree)
        self.block_delay_window = QHBoxLayout()
        self.block_delay_window.addWidget(self.block_delay_label)
        self.block_delay_window.addWidget(self.block_delay_cell)
        self.block_edit_layout.addLayout(self.block_delay_window)

        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_label = QLabel(&#34;Jitter&#34;)
        self.block_jitter_cell = QLineEdit()
        self.block_jitter_cell.setValidator(self.onlyFloat)
        self.block_jitter_cell.textEdited.connect(self.block_to_tree)
        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_window.addWidget(self.block_jitter_label)
        self.block_jitter_window.addWidget(self.block_jitter_cell)
        self.block_edit_layout.addLayout(self.block_jitter_window)

        self.block_edit_container = QWidget()
        self.block_edit_container.setLayout(self.block_edit_layout)
        self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
        self.signal_adjust_superposed.addWidget(self.block_edit_container)
        self.signal_adjust_superposed.addWidget(QLabel())
        self.signal_adjust_superposed.setCurrentIndex(2)
        self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

        self.signal_preview_label = QLabel(&#39;Signal Preview&#39;)
        self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_preview_label, 2, 2)

        self.buttons_main_window = QHBoxLayout()
        self.stop_button = QPushButton(&#39;Stop&#39;)
        self.stop_button.setIcon(QIcon(&#34;gui/icons/player-stop.png&#34;))
        self.stop_button.clicked.connect(self.stop_while_running)
        self.stop_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.stop_button)
        self.run_button = QPushButton(&#39;Run&#39;)
        self.run_button.setIcon(QIcon(&#34;gui/icons/player-play.png&#34;))
        self.run_button.clicked.connect(self.run)
        self.run_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.run_button)
        self.plot_window = PlotWindow()
        self.grid_layout.addWidget(self.plot_window, 3, 2)
        self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
        self.open_daq_generation_thread()
        self.initialize_buttons()
        self.show()

    def run(self):
        self.daq.start_runtime = time.time()
        self.deactivate_buttons(buttons=self.enabled_buttons)
        print(str(time.time()-self.daq.start_runtime) + &#34;to deactivate buttons&#34;)
        self.master_block = self.create_blocks()
        print(str(time.time()-self.daq.start_runtime) + &#34;to generate master block&#34;)
        self.plot(item=self.stimulation_tree.invisibleRootItem())
        print(str(time.time()-self.daq.start_runtime) + &#34;to plot the signal&#34;)
        self.root_time, self.root_signal = self.plot_x_values, [self.plot_stim1_values, self.plot_stim2_values]
        self.draw(root=True)
        print(str(time.time()-self.daq.start_runtime) + &#34;to draw the signal&#34;)
        #self.open_signal_preview_thread()
        self.open_live_preview_thread()
        self.open_start_experiment_thread()

    def open_start_experiment_thread(self):
        self.start_experiment_thread = Thread(target=self.run_stimulation)
        self.start_experiment_thread.start()

    def run_stimulation(self):
        self.actualize_daq()
        self.experiment = Experiment(self.master_block, int(self.framerate_cell.text()), int(self.exposure_cell.text(
        )), self.mouse_id_cell.text(), self.directory_cell.text(), self.daq, name=self.experiment_name_cell.text())
        print(str(time.time()-self.daq.start_runtime) + &#34;to intialize the experiment&#34;)
        self.experiment.start(self.root_time, self.root_signal)
        try:
            self.experiment.save(self.files_saved, self.roi_extent)
        except Exception:
            self.experiment.save(self.directory_save_files_checkbox.isChecked())
        self.stop()
        
    def open_live_preview_thread(self):
        self.live_preview_thread = Thread(target=self.start_live)
        self.live_preview_thread.start()

    def start_live(self):
        plt.ion()
        while self.camera.video_running is False:
            pass
        first =True
        while self.camera.video_running is True:
            self.plot_image.set_array(self.camera.frames[self.live_preview_light_index::len(self.daq.lights)][-1])
            if first is True:
                print(str(time.time()-self.daq.start_runtime) + &#34;to set first image&#34;)
                first = False

    def stop_live(self):
        self.video_running = False

    def open_signal_preview_thread(self):
        self.signal_preview_thread = Thread(target=self.preview_signal)
        self.signal_preview_thread.start()

    def preview_signal(self):
        plt.ion()
        while self.stop_signal is False and self.daq.control_task.is_task_done() is False:
            try:
                self.plot_window.vertical_line.set_xdata([self.daq.current_signal_time,self.daq.current_signal_time])
                time.sleep(0.5)
            except Exception:
                time.sleep(0.5)
                pass

    def change_preview_light_channel(self):
        self.live_preview_light_index = self.preview_light_combo.currentIndex()

    def open_daq_generation_thread(self):
        self.daq_generation_thread = Thread(target=self.generate_daq)
        self.daq_generation_thread.start()

    def generate_daq(self):
        self.stimuli = [Instrument(&#39;ao0&#39;, &#39;air-pump&#39;), Instrument(&#39;ao1&#39;, &#39;air-pump2&#39;)]
        self.camera = Camera(&#39;port0/line4&#39;, &#39;name&#39;)
        self.daq = DAQ(&#39;dev1&#39;, [], self.stimuli, self.camera, int(self.framerate_cell.text()), int(self.exposure_cell.text())/100)

    def actualize_daq(self):
        lights = []
        if self.ir_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line3&#39;, &#39;ir&#39;))
        if self.red_checkbox.isChecked():
            lights.append( Instrument(&#39;port0/line0&#39;, &#39;red&#39;))
        if self.green_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line2&#39;, &#39;green&#39;))
        if self.fluorescence_checkbox.isChecked():
            lights.append(Instrument(&#39;port0/line1&#39;, &#39;blue&#39;))
        self.daq.lights = lights
        self.camera.frames = []
        self.daq.stop_signal = False


        # TODO divide by 1000

    def create_blocks(self, item=None):
        try:
            if item is None:
                item = self.stimulation_tree.invisibleRootItem()
            if item.childCount() &gt; 0:
                children = []
                for index in range(item.childCount()):
                    children.append(self.create_blocks(item=item.child(index)))
                if item == self.stimulation_tree.invisibleRootItem():
                    return Block(&#34;root&#34;, children)
                return Block(item.text(0), children, delay=int(item.text(2)), iterations=int(item.text(1)))
            else:
                duration = int(item.text(6))
                if item.text(18) == &#34;True&#34;:
                    canal1 = True
                    sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
                else:
                    canal1=False
                    sign_type, pulses, jitter, width, frequency, duty = 0, 0, 0, 0, 0,0

                if item.text(19) == &#34;True&#34;:
                    canal2 =True
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
                else:
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = 0,0,0,0,0,0
                    canal2 = False
                return Stimulation(self.daq, duration, canal1=canal1, canal2=canal2, pulses=pulses, pulses2=pulses2, jitter=jitter, jitter2=jitter2, width=width, width2=width2, frequency=frequency, frequency2=frequency2, duty=duty, duty2=duty2, pulse_type1=sign_type, pulse_type2=sign_type2, name=item.text(0))
        except Exception as err:
            pass

    def get_tree_item_attributes(self, item, canal=1):
        if canal ==1:
            sign_type = item.text(4)
            duration = float(item.text(6))
            try:
                pulses = int(item.text(5))
                jitter = float(item.text(7))
                width = float(item.text(8))
            except Exception:
                pulses, jitter, width = 0, 0, 0
            try:
                frequency = float(item.text(9))
                duty = float(item.text(10))/100
            except Exception:
                frequency, duty = 0, 0
            return [sign_type, pulses, jitter, width, frequency, duty]

        elif canal ==2:
            sign_type = item.text(11)
            duration = float(item.text(6))
            try:
                pulses = int(item.text(12))
                jitter = float(item.text(13))
                width = float(item.text(14))
            except Exception:
                pulses, jitter, width = 0, 0, 0
            try:
                frequency = float(item.text(15))
                duty = float(item.text(16))/100
            except Exception:
                frequency, duty = 0, 0
            return [sign_type, pulses, jitter, width, frequency, duty]

    def stop(self):
        self.daq.stop_signal = True
        self.daq.stop_signal = True
        self.stop_live()
        self.activate_buttons(buttons = self.enabled_buttons)

    def stop_while_running(self):
        self.stop()
        if self.directory_save_files_checkbox.isChecked():
            self.stop_stimulation_dialog()

    def stop_stimulation_dialog(self):
        button = QMessageBox.question(self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;)
        if button == QMessageBox.Yes:
            print(&#34;Yes!&#34;)
        else:
            print(&#34;No!&#34;)


    def show_buttons(self, buttons):
        for button in buttons:
            button.setVisible(True)

    def hide_buttons(self, buttons):
        for button in buttons:
            button.setVisible(False)

    def activate_buttons(self, buttons):
        if buttons == self.enabled_buttons:
            if self.directory_save_files_checkbox.isChecked():
                self.directory_choose_button.setEnabled(True)
            self.stop_button.setDisabled(True)
        for button in buttons:
            button.setEnabled(True)

    def deactivate_buttons(self, buttons):
        if buttons == self.enabled_buttons:
            self.stop_button.setEnabled(True)
            self.stimulation_tree.clearSelection()
        for button in buttons:
            button.setDisabled(True)

    def choose_directory(self):
        folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
        self.directory_cell.setText(folder)

    def enable_directory(self):
        self.files_saved = self.directory_save_files_checkbox.isChecked()
        self.directory_choose_button.setEnabled(self.files_saved)
        self.directory_cell.setEnabled(self.files_saved)

    def first_stimulation(self):
        #self.run_button.setEnabled(True)
        stimulation_tree_item = QTreeWidgetItem()
        self.style_tree_item(stimulation_tree_item)
        self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
        self.stimulation_tree_switch_window.setCurrentIndex(0)
        self.stimulation_tree.setCurrentItem(stimulation_tree_item)
        self.canals_to_tree(first=True)
        self.type_to_tree(first=True)
        self.check_global_validity()

    def add_brother(self):
        if self.stimulation_tree.currentItem():
            stimulation_tree_item = QTreeWidgetItem()
            self.style_tree_item(stimulation_tree_item)
            parent = self.stimulation_tree.selectedItems()[0].parent()
            if parent:
                index = parent.indexOfChild(self.stimulation_tree.selectedItems()[0])
                parent.insertChild(index+1, stimulation_tree_item)
            else:
                self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
            self.stimulation_tree.setCurrentItem(stimulation_tree_item)
            self.type_to_tree(first=True)
            self.canals_to_tree(first=True)
            self.check_global_validity()

    def add_child(self):
        if self.stimulation_tree.currentItem():
            self.stimulation_tree.currentItem().setIcon(0, QIcon(&#34;gui/icons/package.png&#34;))
            self.stimulation_tree.currentItem().setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
            stimulation_tree_item = QTreeWidgetItem()
            self.style_tree_item(stimulation_tree_item)
            self.stimulation_tree.selectedItems()[0].addChild(stimulation_tree_item)
            self.stimulation_tree.selectedItems()[0].setExpanded(True)
            self.stimulation_tree.setCurrentItem(stimulation_tree_item)
            self.type_to_tree(first=True)
            self.canals_to_tree(first=True)
            self.check_global_validity()

    def delete_branch(self):
        try:
            parent = self.stimulation_tree.currentItem().parent()
            if parent.childCount() == 1:
                parent.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
        except Exception:
            parent = self.stimulation_tree.invisibleRootItem()
        parent.removeChild(self.stimulation_tree.currentItem())
        self.check_global_validity()


    def style_tree_item(self, item):
        item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
        item.setForeground(0, QBrush(QColor(211, 211, 211)))
        item.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
        item.setText(0, &#34;No Name&#34;)


    def actualize_window(self):
        if self.stimulation_tree.currentItem():
            self.stimulation_tree_switch_window.setCurrentIndex(0)
        else:
            self.stimulation_tree_switch_window.setCurrentIndex(1)
        try:
            if self.stimulation_tree.currentItem().childCount() &gt; 0:
                self.signal_adjust_superposed.setCurrentIndex(1)
            else:
                self.signal_adjust_superposed.setCurrentIndex(0)
        except AttributeError:
            self.signal_adjust_superposed.setCurrentIndex(2)
        self.tree_to_name()
        self.tree_to_block()
        self.tree_to_type()
        self.tree_to_signal()
        self.tree_to_canal()
        self.clear_plot()
        self.plot()
        self.draw()

    def name_to_tree(self):
        branch = self.stimulation_tree.currentItem()
        branch.setForeground(0, QBrush(QColor(0, 0, 0)))
        if branch.childCount() &gt; 0:
            branch.setText(0, self.block_name_cell.text())
        else:
            branch.setText(0, self.stimulation_name_cell.text())

    def tree_to_name(self):
        try:
            if self.stimulation_tree.currentItem().childCount() &gt; 0:
                if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.block_name_cell.setText(
                        self.stimulation_tree.currentItem().text(0))
                else:
                    self.block_name_cell.setText(&#34;&#34;)
            else:
                if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                    self.stimulation_name_cell.setText(
                        self.stimulation_tree.currentItem().text(0))
                else:
                    self.stimulation_name_cell.setText(&#34;&#34;)
        except AttributeError:
            pass

    def type_to_tree(self, first=False):
        if first is True:
            self.stimulation_type_cell.setCurrentIndex(0)
            self.stimulation_type_cell2.setCurrentIndex(0)
        else:
            self.check_global_validity()
        self.different_signals_window.setCurrentIndex(self.stimulation_type_cell.currentIndex())
        self.different_signals_window2.setCurrentIndex(self.stimulation_type_cell2.currentIndex())
        #self.check_stim_validity()
        try:
            self.stimulation_tree.currentItem().setText(4, str(self.stimulation_type_cell.currentText()))
        except Exception:
            pass
        try:
            self.stimulation_tree.currentItem().setText(11, str(self.stimulation_type_cell2.currentText()))
        except Exception:
            pass
        try:
            self.clear_plot()
            self.plot()
            self.draw()
        except Exception:
            pass

    def tree_to_type(self):
        dico = {
            &#34;square&#34;: 0,
            &#34;random-square&#34;: 1,
            &#34;Third&#34;: 2
        }
        try:
            self.stimulation_type_cell.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(4)])
        except Exception:
            self.stimulation_type_cell.setCurrentIndex(0)

        try:
            self.stimulation_type_cell2.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(11)])
        except Exception:
            self.stimulation_type_cell2.setCurrentIndex(0)

    def signal_to_tree(self):
        self.stimulation_tree.currentItem().setText(6, self.first_signal_type_duration_cell.text())

        self.stimulation_tree.currentItem().setText(5, self.first_signal_type_pulses_cell.text())
        self.stimulation_tree.currentItem().setText(7, self.first_signal_type_jitter_cell.text())
        self.stimulation_tree.currentItem().setText(8, self.first_signal_type_width_cell.text())
        self.stimulation_tree.currentItem().setText(9, self.second_signal_type_frequency_cell.text())
        self.stimulation_tree.currentItem().setText(10, self.second_signal_type_duty_cell.text())

        self.stimulation_tree.currentItem().setText(12, self.first_signal_type_pulses_cell2.text())
        self.stimulation_tree.currentItem().setText(13, self.first_signal_type_jitter_cell2.text())
        self.stimulation_tree.currentItem().setText(14, self.first_signal_type_width_cell2.text())
        self.stimulation_tree.currentItem().setText(15, self.second_signal_type_frequency_cell2.text())
        self.stimulation_tree.currentItem().setText(16, self.second_signal_type_duty_cell2.text())


        self.check_global_validity()
        self.clear_plot()
        self.plot()
        self.draw()


    def tree_to_signal(self):
        try:
            self.first_signal_type_pulses_cell.setText(self.stimulation_tree.currentItem().text(5))
            self.first_signal_type_duration_cell.setText(self.stimulation_tree.currentItem().text(6))
            self.first_signal_type_jitter_cell.setText(self.stimulation_tree.currentItem().text(7))
            self.first_signal_type_width_cell.setText(self.stimulation_tree.currentItem().text(8))
            self.second_signal_type_frequency_cell.setText(self.stimulation_tree.currentItem().text(9))
            self.second_signal_type_duty_cell.setText(self.stimulation_tree.currentItem().text(10))
            self.first_signal_type_pulses_cell2.setText(self.stimulation_tree.currentItem().text(12))
            self.first_signal_type_jitter_cell2.setText(self.stimulation_tree.currentItem().text(13))
            self.first_signal_type_width_cell2.setText(self.stimulation_tree.currentItem().text(14))
            self.second_signal_type_frequency_cell2.setText(self.stimulation_tree.currentItem().text(15))
            self.second_signal_type_duty_cell2.setText(self.stimulation_tree.currentItem().text(16))
        except Exception as err:
            pass

    def tree_to_block(self):
        try:
            self.block_iterations_cell.setText(self.stimulation_tree.currentItem().text(1))
            self.block_delay_cell.setText(self.stimulation_tree.currentItem().text(2))
            self.block_jitter_cell.setText(self.stimulation_tree.currentItem().text(3))
        except Exception:
            pass

    def block_to_tree(self):
        self.stimulation_tree.currentItem().setText(1, self.block_iterations_cell.text())
        self.stimulation_tree.currentItem().setText(2, self.block_delay_cell.text())
        self.stimulation_tree.currentItem().setText(3, self.block_jitter_cell.text())
        self.check_global_validity()
        self.clear_plot()
        self.plot()
        self.draw()

    def tree_to_canal(self):
        self.canal_running = True
        try:
            self.first_signal_first_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(18)))
            self.first_signal_second_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(19)))
            if self.first_signal_first_canal_check.isChecked():
                    self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.first_signal_second_canal_check.isChecked():
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
        except Exception:
            pass
        self.canal_running = False

    def canals_to_tree(self, int=0, first=False):
        if not self.canal_running:
            if first:
                self.stimulation_tree.currentItem().setText(18, &#34;False&#34;)
                self.stimulation_tree.currentItem().setText(19, &#34;False&#34;)
                self.deactivate_buttons(self.canal1buttons)
                self.deactivate_buttons(self.canal2buttons)
            else:
                self.stimulation_tree.currentItem().setText(18, str(self.first_signal_first_canal_check.isChecked()))
                if self.first_signal_first_canal_check.isChecked():
                    self.activate_buttons(self.canal1buttons)
                else:
                    self.deactivate_buttons(self.canal1buttons)
                if self.first_signal_second_canal_check.isChecked():
                    self.activate_buttons(self.canal2buttons)
                else:
                    self.deactivate_buttons(self.canal2buttons)
                self.stimulation_tree.currentItem().setText(19, str(self.first_signal_second_canal_check.isChecked()))
                self.first_signal_type_pulses_cell2.setEnabled(self.first_signal_second_canal_check.isChecked())
                self.check_global_validity()

    def enable_run(self):
        self.run_button.setDisabled(False)

    def disable_run(self):
        self.run_button.setDisabled(True)

    def count_lights(self):
        count = 0
        text = []
        for checkbox in [self.ir_checkbox, self.red_checkbox, self.green_checkbox, self.fluorescence_checkbox]:
            if checkbox.isChecked():
                count += 1
                text.append(checkbox.text())
        return (count, text)

    def check_lights(self):
        self.preview_light_combo.clear()
        if self.count_lights()[0] == 0:
            self.preview_light_combo.setEnabled(False)
        else:
            self.preview_light_combo.setEnabled(True)
        for i in range(4):
            if i &lt; self.count_lights()[0]:
                self.preview_light_combo.addItem(self.count_lights()[1][i])
        self.check_global_validity()
    
    def check_global_validity(self, item=None):
        if item is None:
            item = self.stimulation_tree.invisibleRootItem()
            if self.check_block_validity(item) is True and (self.ir_checkbox.isChecked() or self.red_checkbox.isChecked() or self.green_checkbox.isChecked() or self.fluorescence_checkbox.isChecked()):
                self.enable_run()
            else:
                self.disable_run()
        elif item.childCount() &gt; 0:
            self.set_icon(item, self.check_block_validity(item))
        else:
            self.set_icon(item, self.check_stim_validity(item))
        for child_index in range(item.childCount()):
            self.check_global_validity(item.child(child_index))

    def check_stim_validity(self, item=None):
        valid = True
        if item is None:
            item == self.stimulation_tree.currentItem()
        if item.text(6) == &#34;&#34;:
            valid = False

        if item.text(18) == &#34;True&#34;:
            if item.text(4) == &#34;square&#34; and item.text(9) != &#34;&#34; and item.text(10) != &#34;&#34;:
                pass
            elif item.text(4) == &#34;random-square&#34; and item.text(5) != &#34;&#34; and item.text(7) != &#34;&#34; and item.text(8) != &#34;&#34;:
                pass
            else:
                valid = False

        if item.text(19) == &#34;True&#34;:
            if item.text(11) == &#34;square&#34; and item.text(15) != &#34;&#34; and item.text(16) != &#34;&#34;:
                pass
            elif item.text(11) == &#34;random-square&#34; and item.text(12) != &#34;&#34; and item.text(13) != &#34;&#34; and item.text(4) != &#34;&#34;:
                pass
            else:
                valid = False
        return valid

    def check_block_validity(self, item=None):
        valid = True
        if item is None:
            item = self.stimulation_tree.currentItem()
        if item.childCount() == 0:
            return self.check_stim_validity(item=item)
        if item == self.stimulation_tree.invisibleRootItem():
            if item.childCount() == 0:
                valid = False
        elif item.childCount() &gt; 0:
            valid = item.text(1) != &#34;&#34; and item.text(2) != &#34;&#34; and item.text(3) != &#34;&#34;
        for child_index in range(item.childCount()):
            if not self.check_block_validity(item.child(child_index)):
                valid = False
        return valid

    def set_icon(self, item, valid):
        try:
            if valid:
                item.setIcon(20, QIcon(&#34;gui/icons/circle-check.png&#34;))
            else:
                item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
        except Exception:
            pass


    def boolean(self, string):
        if string == &#34;True&#34;:
            return True
        return False

    def clear_plot(self):
        self.plot_window.clear()

    def plot(self, item=None):
        try:
            if item is None:
                item = self.stimulation_tree.currentItem()
            if item.childCount() &gt; 0:
                if item == self.stimulation_tree.invisibleRootItem():
                    jitter, block_delay, iterations_number = 0, 0, 1
                else:
                    jitter = float(item.text(3))
                    iterations_number = int(item.text(1))
                    block_delay = float(item.text(2))

                for iteration in range(iterations_number):
                    for index in range(item.childCount()):
                        child = item.child(index)
                        self.plot(child)
                    delay = round(block_delay + random.random()*jitter, 3)
                    time_values = np.linspace(0, delay, int(round(delay))*3000)
                    data = np.zeros(len(time_values))
                    time_values += self.elapsed_time
                    self.elapsed_time += delay
                    self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data))
            else:
                duration = float(item.text(6))
                time_values = np.linspace(0, duration, int(round(duration))*3000)
                time_values += self.elapsed_time
                self.elapsed_time += duration
                self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
                if item.text(18) == &#34;True&#34;:
                    sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
                    data = make_signal(time_values, sign_type, width, pulses, jitter, frequency, duty)
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
                else:
                    self.plot_stim1_values = np.concatenate((self.plot_stim1_values, np.zeros(len(time_values))))

                if item.text(19) == &#34;True&#34;:
                    sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
                    data2 = make_signal(time_values, sign_type2, width2, pulses2, jitter2, frequency2, duty2)
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data2))
                else:
                    self.plot_stim2_values = np.concatenate((self.plot_stim2_values, np.zeros(len(time_values))))
        except Exception as err:
            self.plot_x_values = []
            self.plot_y_values = []
            self.elapsed_time = 0

    def draw(self, root=False):
        new_x_values = []
        new_stim1_values = []
        new_stim2_values = []
        try:
            time_start = time.time()
            sampling_indexes = np.linspace(0, len(self.plot_x_values)-1, round(3000+len(self.plot_x_values)/10), dtype=int)
            new_x_values = np.take(self.plot_x_values, sampling_indexes, 0)
            new_stim1_values = np.take(self.plot_stim1_values, sampling_indexes, 0)
            new_stim2_values = np.take(self.plot_stim2_values, sampling_indexes, 0)
            #self.plot_window.plot(new_x_values, new_stim1_values, root)
            #self.plot_window.plot(new_x_values, new_stim2_values, root, color=&#34;g&#34;)
            self.plot_window.plot(self.plot_x_values, self.plot_stim1_values, root)
            self.plot_window.plot(self.plot_x_values, self.plot_stim2_values, root, color=&#34;g&#34;)
            #print(f&#34;plot time:{time.time()-time_start}&#34;)
            self.plot_x_values = []
            self.plot_stim1_values = []
            self.plot_stim2_values = []
            self.elapsed_time = 0
        except Exception as err:
            pass

    def set_roi(self):
        self.deactivate_buttons(buttons = self.enabled_buttons)
        self.stop_button.setEnabled(False)
        self.save_roi_button.setEnabled(False)
        self.roi_buttons.setCurrentIndex(1)

        def onselect_function(eclick, erelease):
            self.roi_extent = self.rect_selector.extents
            self.save_roi_button.setEnabled(True)

        self.rect_selector = RectangleSelector(self.plot_image.axes, onselect_function,
                                               drawtype=&#39;box&#39;, useblit=True,
                                               button=[1, 3],
                                               minspanx=5, minspany=5,
                                               spancoords=&#39;pixels&#39;,
                                               interactive=True)

    def reset_roi(self):
        plt.xlim(0, 1024)
        plt.ylim(0, 1024)
        self.roi_extent = None
        self.reset_roi_button.setEnabled(False)

    def cancel_roi(self):
        self.activate_buttons(buttons = self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        self.rect_selector.clear()
        self.rect_selector = None

    def save_roi(self):
        self.activate_buttons(buttons = self.enabled_buttons)
        self.roi_buttons.setCurrentIndex(0)
        plt.ion()
        plt.xlim(self.roi_extent[0], self.roi_extent[1])
        plt.ylim(self.roi_extent[2], self.roi_extent[3])
        self.rect_selector.clear()
        self.rect_selector = None
        self.reset_roi_button.setEnabled(True)

    def verify_exposure(self):
        try:
            boolean_check =  (int(self.exposure_cell.text())/1000+0.0015)*int(self.framerate_cell.text()) &lt; 1
        except Exception:
            boolean_check = False
        self.exposure_warning_label.setHidden(boolean_check)
        self.check_run()

    def check_run(self):
        pass

    def check_if_thread_is_alive(self):
        try:
            if self.live_preview_thread.is_alive():
                print(&#34;Live preview thread is alive&#34;)
            else:
                print(&#34;Live preview thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.start_experiment_thread.is_alive():
                print(&#34;Start Experiment thread is alive&#34;)
            else:
                print(&#34;Start experiment thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.daq_generation_thread.is_alive():
                print(&#34;Daq Generation thread is alive&#34;)
            else:
                print(&#34;Daq generation thread is dead&#34;)
        except Exception as err:
            print(err)

        try:
            if self.signal_preview_thread.is_alive():
                print(&#34;Signal Preview thread is alive&#34;)
            else:
                print(&#34;Signal Preview thread is dead&#34;)
        except Exception as err:
            print(err)

    def initialize_buttons(self):
        self.canal1buttons = [self.stimulation_type_label, self.stimulation_type_cell, self.first_signal_type_pulses_label, self.first_signal_type_pulses_cell, self.first_signal_type_width_label, self.first_signal_type_width_cell, self.first_signal_type_jitter_label, self.first_signal_type_jitter_cell, self.second_signal_type_frequency_label, self.second_signal_type_frequency_cell, self.second_signal_type_duty_label, self.second_signal_type_duty_cell]
        self.canal2buttons = [self.stimulation_type_label2, self.stimulation_type_cell2, self.first_signal_type_pulses_label2, self.first_signal_type_pulses_cell2, self.first_signal_type_width_label2, self.first_signal_type_width_cell2, self.first_signal_type_jitter_label2, self.first_signal_type_jitter_cell2, self.second_signal_type_frequency_label2, self.second_signal_type_frequency_cell2, self.second_signal_type_duty_label2, self.second_signal_type_duty_cell2]
        self.enabled_buttons = [
            self.run_button,
            self.experiment_name_cell,
            self.mouse_id_cell,
            #self.directory_save_files_checkbox,
            self.directory_choose_button,
            self.set_roi_button,
            self.experiment_name,
            self.mouse_id_label,
            self.framerate_label,
            self.framerate_cell,
            self.exposure_cell,
            self.exposure_label,
            self.add_brother_branch_button,
            self.add_child_branch_button,
            self.delete_branch_button,
            self.red_checkbox,
            self.ir_checkbox,
            self.green_checkbox,
            self.fluorescence_checkbox,
            self.stimulation_name_label,
            self.stimulation_name_cell,
            self.stimulation_type_label,
            self.stimulation_type_cell,
            self.first_signal_first_canal_check,
            self.first_signal_second_canal_check,
            self.first_signal_type_duration_label,
            self.first_signal_type_duration_cell,
            self.first_signal_type_pulses_label,
            self.first_signal_type_pulses_cell,
            self.first_signal_type_width_label,
            self.first_signal_type_width_cell,
            self.first_signal_type_jitter_label,
            self.first_signal_type_jitter_cell,
            self.second_signal_type_frequency_label,
            self.second_signal_type_frequency_cell,
            self.second_signal_type_duty_label,
            self.second_signal_type_duty_cell,
            self.block_iterations_label,
            self.block_iterations_cell,
            self.block_delay_label,
            self.block_delay_cell,
            self.block_jitter_label,
            self.block_jitter_cell,
            self.block_name_label,
            self.block_name_cell,
            self.activate_live_preview_button,
            self.deactivate_live_preview_button,
            self.stimulation_tree
        ]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons"><code class="name flex">
<span>def <span class="ident">activate_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_buttons(self, buttons):
    if buttons == self.enabled_buttons:
        if self.directory_save_files_checkbox.isChecked():
            self.directory_choose_button.setEnabled(True)
        self.stop_button.setDisabled(True)
    for button in buttons:
        button.setEnabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq"><code class="name flex">
<span>def <span class="ident">actualize_daq</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_daq(self):
    lights = []
    if self.ir_checkbox.isChecked():
        lights.append(Instrument(&#39;port0/line3&#39;, &#39;ir&#39;))
    if self.red_checkbox.isChecked():
        lights.append( Instrument(&#39;port0/line0&#39;, &#39;red&#39;))
    if self.green_checkbox.isChecked():
        lights.append(Instrument(&#39;port0/line2&#39;, &#39;green&#39;))
    if self.fluorescence_checkbox.isChecked():
        lights.append(Instrument(&#39;port0/line1&#39;, &#39;blue&#39;))
    self.daq.lights = lights
    self.camera.frames = []
    self.daq.stop_signal = False


    # TODO divide by 1000</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.actualize_window"><code class="name flex">
<span>def <span class="ident">actualize_window</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def actualize_window(self):
    if self.stimulation_tree.currentItem():
        self.stimulation_tree_switch_window.setCurrentIndex(0)
    else:
        self.stimulation_tree_switch_window.setCurrentIndex(1)
    try:
        if self.stimulation_tree.currentItem().childCount() &gt; 0:
            self.signal_adjust_superposed.setCurrentIndex(1)
        else:
            self.signal_adjust_superposed.setCurrentIndex(0)
    except AttributeError:
        self.signal_adjust_superposed.setCurrentIndex(2)
    self.tree_to_name()
    self.tree_to_block()
    self.tree_to_type()
    self.tree_to_signal()
    self.tree_to_canal()
    self.clear_plot()
    self.plot()
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.add_brother"><code class="name flex">
<span>def <span class="ident">add_brother</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_brother(self):
    if self.stimulation_tree.currentItem():
        stimulation_tree_item = QTreeWidgetItem()
        self.style_tree_item(stimulation_tree_item)
        parent = self.stimulation_tree.selectedItems()[0].parent()
        if parent:
            index = parent.indexOfChild(self.stimulation_tree.selectedItems()[0])
            parent.insertChild(index+1, stimulation_tree_item)
        else:
            self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
        self.stimulation_tree.setCurrentItem(stimulation_tree_item)
        self.type_to_tree(first=True)
        self.canals_to_tree(first=True)
        self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.add_child"><code class="name flex">
<span>def <span class="ident">add_child</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_child(self):
    if self.stimulation_tree.currentItem():
        self.stimulation_tree.currentItem().setIcon(0, QIcon(&#34;gui/icons/package.png&#34;))
        self.stimulation_tree.currentItem().setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
        stimulation_tree_item = QTreeWidgetItem()
        self.style_tree_item(stimulation_tree_item)
        self.stimulation_tree.selectedItems()[0].addChild(stimulation_tree_item)
        self.stimulation_tree.selectedItems()[0].setExpanded(True)
        self.stimulation_tree.setCurrentItem(stimulation_tree_item)
        self.type_to_tree(first=True)
        self.canals_to_tree(first=True)
        self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree"><code class="name flex">
<span>def <span class="ident">block_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def block_to_tree(self):
    self.stimulation_tree.currentItem().setText(1, self.block_iterations_cell.text())
    self.stimulation_tree.currentItem().setText(2, self.block_delay_cell.text())
    self.stimulation_tree.currentItem().setText(3, self.block_jitter_cell.text())
    self.check_global_validity()
    self.clear_plot()
    self.plot()
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.boolean"><code class="name flex">
<span>def <span class="ident">boolean</span></span>(<span>self, string)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def boolean(self, string):
    if string == &#34;True&#34;:
        return True
    return False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree"><code class="name flex">
<span>def <span class="ident">canals_to_tree</span></span>(<span>self, int=0, first=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def canals_to_tree(self, int=0, first=False):
    if not self.canal_running:
        if first:
            self.stimulation_tree.currentItem().setText(18, &#34;False&#34;)
            self.stimulation_tree.currentItem().setText(19, &#34;False&#34;)
            self.deactivate_buttons(self.canal1buttons)
            self.deactivate_buttons(self.canal2buttons)
        else:
            self.stimulation_tree.currentItem().setText(18, str(self.first_signal_first_canal_check.isChecked()))
            if self.first_signal_first_canal_check.isChecked():
                self.activate_buttons(self.canal1buttons)
            else:
                self.deactivate_buttons(self.canal1buttons)
            if self.first_signal_second_canal_check.isChecked():
                self.activate_buttons(self.canal2buttons)
            else:
                self.deactivate_buttons(self.canal2buttons)
            self.stimulation_tree.currentItem().setText(19, str(self.first_signal_second_canal_check.isChecked()))
            self.first_signal_type_pulses_cell2.setEnabled(self.first_signal_second_canal_check.isChecked())
            self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi"><code class="name flex">
<span>def <span class="ident">cancel_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel_roi(self):
    self.activate_buttons(buttons = self.enabled_buttons)
    self.roi_buttons.setCurrentIndex(0)
    self.rect_selector.clear()
    self.rect_selector = None</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel"><code class="name flex">
<span>def <span class="ident">change_preview_light_channel</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def change_preview_light_channel(self):
    self.live_preview_light_index = self.preview_light_combo.currentIndex()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_block_validity"><code class="name flex">
<span>def <span class="ident">check_block_validity</span></span>(<span>self, item=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_block_validity(self, item=None):
    valid = True
    if item is None:
        item = self.stimulation_tree.currentItem()
    if item.childCount() == 0:
        return self.check_stim_validity(item=item)
    if item == self.stimulation_tree.invisibleRootItem():
        if item.childCount() == 0:
            valid = False
    elif item.childCount() &gt; 0:
        valid = item.text(1) != &#34;&#34; and item.text(2) != &#34;&#34; and item.text(3) != &#34;&#34;
    for child_index in range(item.childCount()):
        if not self.check_block_validity(item.child(child_index)):
            valid = False
    return valid</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_global_validity"><code class="name flex">
<span>def <span class="ident">check_global_validity</span></span>(<span>self, item=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_global_validity(self, item=None):
    if item is None:
        item = self.stimulation_tree.invisibleRootItem()
        if self.check_block_validity(item) is True and (self.ir_checkbox.isChecked() or self.red_checkbox.isChecked() or self.green_checkbox.isChecked() or self.fluorescence_checkbox.isChecked()):
            self.enable_run()
        else:
            self.disable_run()
    elif item.childCount() &gt; 0:
        self.set_icon(item, self.check_block_validity(item))
    else:
        self.set_icon(item, self.check_stim_validity(item))
    for child_index in range(item.childCount()):
        self.check_global_validity(item.child(child_index))</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive"><code class="name flex">
<span>def <span class="ident">check_if_thread_is_alive</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_if_thread_is_alive(self):
    try:
        if self.live_preview_thread.is_alive():
            print(&#34;Live preview thread is alive&#34;)
        else:
            print(&#34;Live preview thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.start_experiment_thread.is_alive():
            print(&#34;Start Experiment thread is alive&#34;)
        else:
            print(&#34;Start experiment thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.daq_generation_thread.is_alive():
            print(&#34;Daq Generation thread is alive&#34;)
        else:
            print(&#34;Daq generation thread is dead&#34;)
    except Exception as err:
        print(err)

    try:
        if self.signal_preview_thread.is_alive():
            print(&#34;Signal Preview thread is alive&#34;)
        else:
            print(&#34;Signal Preview thread is dead&#34;)
    except Exception as err:
        print(err)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_lights"><code class="name flex">
<span>def <span class="ident">check_lights</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_lights(self):
    self.preview_light_combo.clear()
    if self.count_lights()[0] == 0:
        self.preview_light_combo.setEnabled(False)
    else:
        self.preview_light_combo.setEnabled(True)
    for i in range(4):
        if i &lt; self.count_lights()[0]:
            self.preview_light_combo.addItem(self.count_lights()[1][i])
    self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_run"><code class="name flex">
<span>def <span class="ident">check_run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_run(self):
    pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.check_stim_validity"><code class="name flex">
<span>def <span class="ident">check_stim_validity</span></span>(<span>self, item=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_stim_validity(self, item=None):
    valid = True
    if item is None:
        item == self.stimulation_tree.currentItem()
    if item.text(6) == &#34;&#34;:
        valid = False

    if item.text(18) == &#34;True&#34;:
        if item.text(4) == &#34;square&#34; and item.text(9) != &#34;&#34; and item.text(10) != &#34;&#34;:
            pass
        elif item.text(4) == &#34;random-square&#34; and item.text(5) != &#34;&#34; and item.text(7) != &#34;&#34; and item.text(8) != &#34;&#34;:
            pass
        else:
            valid = False

    if item.text(19) == &#34;True&#34;:
        if item.text(11) == &#34;square&#34; and item.text(15) != &#34;&#34; and item.text(16) != &#34;&#34;:
            pass
        elif item.text(11) == &#34;random-square&#34; and item.text(12) != &#34;&#34; and item.text(13) != &#34;&#34; and item.text(4) != &#34;&#34;:
            pass
        else:
            valid = False
    return valid</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.choose_directory"><code class="name flex">
<span>def <span class="ident">choose_directory</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def choose_directory(self):
    folder = str(QFileDialog.getExistingDirectory(self, &#34;Select Directory&#34;))
    self.directory_cell.setText(folder)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.clear_plot"><code class="name flex">
<span>def <span class="ident">clear_plot</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear_plot(self):
    self.plot_window.clear()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.closeEvent"><code class="name flex">
<span>def <span class="ident">closeEvent</span></span>(<span>self, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>closeEvent(self, QCloseEvent)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def closeEvent(self, *args, **kwargs):
    self.daq.stop_signal = True
    self.video_running = False
    self.daq.camera.cam.stop_acquisition()
    print(&#34;Closed&#34;)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.count_lights"><code class="name flex">
<span>def <span class="ident">count_lights</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def count_lights(self):
    count = 0
    text = []
    for checkbox in [self.ir_checkbox, self.red_checkbox, self.green_checkbox, self.fluorescence_checkbox]:
        if checkbox.isChecked():
            count += 1
            text.append(checkbox.text())
    return (count, text)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.create_blocks"><code class="name flex">
<span>def <span class="ident">create_blocks</span></span>(<span>self, item=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_blocks(self, item=None):
    try:
        if item is None:
            item = self.stimulation_tree.invisibleRootItem()
        if item.childCount() &gt; 0:
            children = []
            for index in range(item.childCount()):
                children.append(self.create_blocks(item=item.child(index)))
            if item == self.stimulation_tree.invisibleRootItem():
                return Block(&#34;root&#34;, children)
            return Block(item.text(0), children, delay=int(item.text(2)), iterations=int(item.text(1)))
        else:
            duration = int(item.text(6))
            if item.text(18) == &#34;True&#34;:
                canal1 = True
                sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
            else:
                canal1=False
                sign_type, pulses, jitter, width, frequency, duty = 0, 0, 0, 0, 0,0

            if item.text(19) == &#34;True&#34;:
                canal2 =True
                sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
            else:
                sign_type2, pulses2, jitter2, width2, frequency2, duty2 = 0,0,0,0,0,0
                canal2 = False
            return Stimulation(self.daq, duration, canal1=canal1, canal2=canal2, pulses=pulses, pulses2=pulses2, jitter=jitter, jitter2=jitter2, width=width, width2=width2, frequency=frequency, frequency2=frequency2, duty=duty, duty2=duty2, pulse_type1=sign_type, pulse_type2=sign_type2, name=item.text(0))
    except Exception as err:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons"><code class="name flex">
<span>def <span class="ident">deactivate_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deactivate_buttons(self, buttons):
    if buttons == self.enabled_buttons:
        self.stop_button.setEnabled(True)
        self.stimulation_tree.clearSelection()
    for button in buttons:
        button.setDisabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.delete_branch"><code class="name flex">
<span>def <span class="ident">delete_branch</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_branch(self):
    try:
        parent = self.stimulation_tree.currentItem().parent()
        if parent.childCount() == 1:
            parent.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
    except Exception:
        parent = self.stimulation_tree.invisibleRootItem()
    parent.removeChild(self.stimulation_tree.currentItem())
    self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.disable_run"><code class="name flex">
<span>def <span class="ident">disable_run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def disable_run(self):
    self.run_button.setDisabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.draw"><code class="name flex">
<span>def <span class="ident">draw</span></span>(<span>self, root=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def draw(self, root=False):
    new_x_values = []
    new_stim1_values = []
    new_stim2_values = []
    try:
        time_start = time.time()
        sampling_indexes = np.linspace(0, len(self.plot_x_values)-1, round(3000+len(self.plot_x_values)/10), dtype=int)
        new_x_values = np.take(self.plot_x_values, sampling_indexes, 0)
        new_stim1_values = np.take(self.plot_stim1_values, sampling_indexes, 0)
        new_stim2_values = np.take(self.plot_stim2_values, sampling_indexes, 0)
        #self.plot_window.plot(new_x_values, new_stim1_values, root)
        #self.plot_window.plot(new_x_values, new_stim2_values, root, color=&#34;g&#34;)
        self.plot_window.plot(self.plot_x_values, self.plot_stim1_values, root)
        self.plot_window.plot(self.plot_x_values, self.plot_stim2_values, root, color=&#34;g&#34;)
        #print(f&#34;plot time:{time.time()-time_start}&#34;)
        self.plot_x_values = []
        self.plot_stim1_values = []
        self.plot_stim2_values = []
        self.elapsed_time = 0
    except Exception as err:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.enable_directory"><code class="name flex">
<span>def <span class="ident">enable_directory</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def enable_directory(self):
    self.files_saved = self.directory_save_files_checkbox.isChecked()
    self.directory_choose_button.setEnabled(self.files_saved)
    self.directory_cell.setEnabled(self.files_saved)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.enable_run"><code class="name flex">
<span>def <span class="ident">enable_run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def enable_run(self):
    self.run_button.setDisabled(False)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.first_stimulation"><code class="name flex">
<span>def <span class="ident">first_stimulation</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def first_stimulation(self):
    #self.run_button.setEnabled(True)
    stimulation_tree_item = QTreeWidgetItem()
    self.style_tree_item(stimulation_tree_item)
    self.stimulation_tree.addTopLevelItem(stimulation_tree_item)
    self.stimulation_tree_switch_window.setCurrentIndex(0)
    self.stimulation_tree.setCurrentItem(stimulation_tree_item)
    self.canals_to_tree(first=True)
    self.type_to_tree(first=True)
    self.check_global_validity()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.generate_daq"><code class="name flex">
<span>def <span class="ident">generate_daq</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def generate_daq(self):
    self.stimuli = [Instrument(&#39;ao0&#39;, &#39;air-pump&#39;), Instrument(&#39;ao1&#39;, &#39;air-pump2&#39;)]
    self.camera = Camera(&#39;port0/line4&#39;, &#39;name&#39;)
    self.daq = DAQ(&#39;dev1&#39;, [], self.stimuli, self.camera, int(self.framerate_cell.text()), int(self.exposure_cell.text())/100)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.get_tree_item_attributes"><code class="name flex">
<span>def <span class="ident">get_tree_item_attributes</span></span>(<span>self, item, canal=1)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_tree_item_attributes(self, item, canal=1):
    if canal ==1:
        sign_type = item.text(4)
        duration = float(item.text(6))
        try:
            pulses = int(item.text(5))
            jitter = float(item.text(7))
            width = float(item.text(8))
        except Exception:
            pulses, jitter, width = 0, 0, 0
        try:
            frequency = float(item.text(9))
            duty = float(item.text(10))/100
        except Exception:
            frequency, duty = 0, 0
        return [sign_type, pulses, jitter, width, frequency, duty]

    elif canal ==2:
        sign_type = item.text(11)
        duration = float(item.text(6))
        try:
            pulses = int(item.text(12))
            jitter = float(item.text(13))
            width = float(item.text(14))
        except Exception:
            pulses, jitter, width = 0, 0, 0
        try:
            frequency = float(item.text(15))
            duty = float(item.text(16))/100
        except Exception:
            frequency, duty = 0, 0
        return [sign_type, pulses, jitter, width, frequency, duty]</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons"><code class="name flex">
<span>def <span class="ident">hide_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def hide_buttons(self, buttons):
    for button in buttons:
        button.setVisible(False)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.initUI"><code class="name flex">
<span>def <span class="ident">initUI</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">    def initUI(self):
        self.setWindowTitle(self.title)
        self.setGeometry(self.left, self.top, self.width, self.height)

        self.plot_x_values = []
        self.plot_stim1_values = []
        self.plot_stim2_values = []
        self.elapsed_time = 0
        self.files_saved = False
        self.onlyInt = QIntValidator()
        self.onlyFloat = QDoubleValidator()
        self.onlyFramerate = QIntValidator()
        self.onlyFramerate.setRange(1, 57)
        self.onlyExposure = QIntValidator()
        self.onlyExposure.setRange(1,900)

        self.grid_layout = QGridLayout()
        self.setLayout(self.grid_layout)
        self.grid_layout.setAlignment(Qt.AlignTop)

        self.experiment_settings_label = QLabel(&#39;Experiment Settings&#39;)
        self.experiment_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.experiment_settings_label, 0, 0)

        self.experiment_settings_main_window = QVBoxLayout()
        self.experiment_name_window = QHBoxLayout()
        self.experiment_name = QLabel(&#39;Experiment Name&#39;)
        self.experiment_name_window.addWidget(self.experiment_name)
        self.experiment_name_cell = QLineEdit()
        self.experiment_name_window.addWidget(self.experiment_name_cell)
        self.experiment_settings_main_window.addLayout(self.experiment_name_window)

        self.mouse_id_window = QHBoxLayout()
        self.mouse_id_label = QLabel(&#39;Mouse ID&#39;)
        self.mouse_id_window.addWidget(self.mouse_id_label)
        self.mouse_id_cell = QLineEdit()
        self.mouse_id_window.addWidget(self.mouse_id_cell)
        self.experiment_settings_main_window.addLayout(self.mouse_id_window)

        self.directory_window = QHBoxLayout()
        self.directory_save_files_checkbox = QCheckBox()
        self.directory_save_files_checkbox.setText(&#34;Save&#34;)
        self.directory_save_files_checkbox.stateChanged.connect(self.check_if_thread_is_alive)
        #TODO Change for real function
        self.directory_window.addWidget(self.directory_save_files_checkbox)
        self.directory_choose_button = QPushButton(&#34;Select Directory&#34;)
        self.directory_choose_button.setIcon(QIcon(&#34;gui/icons/folder-plus.png&#34;))
        self.directory_choose_button.setDisabled(True)
        self.directory_choose_button.clicked.connect(self.choose_directory)
        self.directory_window.addWidget(self.directory_choose_button)
        self.directory_cell = QLineEdit(&#34;&#34;)
        self.directory_cell.setReadOnly(True)
        self.directory_window.addWidget(self.directory_cell)
        self.experiment_settings_main_window.addLayout(self.directory_window)

        self.experiment_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.experiment_settings_main_window, 1, 0)

        self.image_settings_label = QLabel(&#39;Image Settings&#39;)
        self.image_settings_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.image_settings_label, 0, 1)

        self.image_settings_main_window = QVBoxLayout()
        self.image_settings_main_window.setAlignment(Qt.AlignLeft)
        self.image_settings_main_window.setAlignment(Qt.AlignTop)

        self.framerate_window = QHBoxLayout()
        self.framerate_label = QLabel(&#39;Framerate&#39;)
        self.framerate_window.addWidget(self.framerate_label)
        self.framerate_cell = QLineEdit(&#39;30&#39;)
        self.framerate_cell.setValidator(self.onlyFramerate)
        self.framerate_cell.textChanged.connect(self.verify_exposure)
        self.framerate_window.addWidget(self.framerate_cell)
        self.image_settings_main_window.addLayout(self.framerate_window)

        self.exposure_window = QHBoxLayout()
        self.exposure_label = QLabel(&#39;Exposure (ms)&#39;)
        self.exposure_window.addWidget(self.exposure_label)
        self.exposure_cell = QLineEdit(&#39;10&#39;)
        self.exposure_cell.setValidator(self.onlyExposure)
        self.exposure_cell.textChanged.connect(self.verify_exposure)
        self.exposure_window.addWidget(self.exposure_cell)
        self.image_settings_main_window.addLayout(self.exposure_window)

        self.exposure_warning_label = QLabel(&#34;Invalid Exposure / Frame Rate&#34;)
        self.image_settings_main_window.addWidget(self.exposure_warning_label)
        self.exposure_warning_label.setStyleSheet(&#34;color: red&#34;)
        self.exposure_warning_label.setHidden(True)

        self.image_settings_second_window = QHBoxLayout()
        self.ir_checkbox = QCheckBox(&#39;Infrared&#39;)
        self.ir_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.ir_checkbox)
        self.red_checkbox = QCheckBox(&#39;Red&#39;)
        self.red_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.red_checkbox)
        self.green_checkbox = QCheckBox(&#39;Green&#39;)
        self.green_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.green_checkbox)
        self.fluorescence_checkbox = QCheckBox(&#39;Blue&#39;)
        self.fluorescence_checkbox.stateChanged.connect(self.check_lights)
        self.image_settings_second_window.addWidget(self.fluorescence_checkbox)

        self.light_channel_layout = QHBoxLayout()
        self.preview_light_label = QLabel(&#34;Light Channel Preview&#34;)
        self.light_channel_layout.addWidget(self.preview_light_label)
        self.preview_light_combo = QComboBox()
        self.preview_light_combo.setEnabled(False)
        self.preview_light_combo.currentIndexChanged.connect(self.change_preview_light_channel)
        self.light_channel_layout.addWidget(self.preview_light_combo)

        self.image_settings_main_window.addLayout(self.image_settings_second_window)
        self.image_settings_main_window.addLayout(self.light_channel_layout)

        self.roi_buttons = QStackedLayout()

        self.roi_layout1 = QHBoxLayout()
        self.roi_layout1.setAlignment(Qt.AlignLeft)
        self.roi_layout1.setAlignment(Qt.AlignTop)
        self.roi_layout1.setContentsMargins(0, 0, 0, 0)
        self.reset_roi_button = QPushButton()
        self.reset_roi_button.setText(&#34;Reset ROI&#34;)
        self.reset_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-out-area.png&#34;))
        self.reset_roi_button.setEnabled(False)
        self.reset_roi_button.clicked.connect(self.reset_roi)
        self.roi_layout1.addWidget(self.reset_roi_button)

        self.set_roi_button = QPushButton()
        self.set_roi_button.setText(&#34;Set ROI&#34;)
        self.set_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-in-area.png&#34;))
        self.set_roi_button.clicked.connect(self.set_roi)
        self.roi_layout1.addWidget(self.set_roi_button)
        self.roi_layout1_container = QWidget()
        self.roi_layout1_container.setLayout(self.roi_layout1)

        self.roi_layout2 = QHBoxLayout()
        self.roi_layout2.setAlignment(Qt.AlignLeft)
        self.roi_layout2.setAlignment(Qt.AlignTop)
        self.roi_layout2.setContentsMargins(0, 0, 0, 0)
        self.cancel_roi_button = QPushButton()
        self.cancel_roi_button.setText(&#34;Cancel&#34;)
        self.cancel_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-cancel.png&#34;))
        self.cancel_roi_button.clicked.connect(self.cancel_roi)
        self.roi_layout2.addWidget(self.cancel_roi_button)

        self.save_roi_button = QPushButton()
        self.save_roi_button.setText(&#34;Save ROI&#34;)
        self.save_roi_button.setIcon(QIcon(&#34;gui/icons/zoom-check.png&#34;))
        self.save_roi_button.clicked.connect(self.save_roi)
        self.roi_layout2.addWidget(self.save_roi_button)
        self.roi_layout2_container = QWidget()
        self.roi_layout2_container.setLayout(self.roi_layout2)

        self.roi_buttons.addWidget(self.roi_layout1_container)
        self.roi_buttons.addWidget(self.roi_layout2_container)

        self.image_settings_main_window.addLayout(self.roi_buttons)
        self.image_settings_main_window.addStretch()

        self.activate_live_preview_button = QPushButton()
        self.activate_live_preview_button.setText(&#34;Start Live Preview&#34;)
        self.activate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video&#34;))
        self.activate_live_preview_button.clicked.connect(self.open_live_preview_thread)

        self.deactivate_live_preview_button = QPushButton()
        self.deactivate_live_preview_button.setText(&#34;Stop Live Preview&#34;)
        self.deactivate_live_preview_button.setIcon(QIcon(&#34;gui/icons/video-off&#34;))
        self.deactivate_live_preview_button.clicked.connect(self.stop_live)

        self.image_settings_main_window.addStretch()

        self.grid_layout.addLayout(self.image_settings_main_window, 1, 1)

        self.live_preview_label = QLabel(&#39;Live Preview&#39;)
        self.live_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.numpy = np.random.rand(1024, 1024)
        self.image_view = PlotWindow()
        self.plot_image = plt.imshow(self.numpy, cmap=&#34;binary_r&#34;, vmin=0, vmax=4096)
        self.plot_image.axes.get_xaxis().set_visible(False)
        self.plot_image.axes.axes.get_yaxis().set_visible(False)

        self.grid_layout.addWidget(self.live_preview_label, 0, 2)
        self.grid_layout.addWidget(self.image_view, 1, 2)

        self.stimulation_tree_label = QLabel(&#39;Stimulation Tree&#39;)
        self.stimulation_tree_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.stimulation_tree_label, 2, 0)

        self.stimulation_tree_window = QVBoxLayout()
        self.stimulation_tree = QTreeWidget()
        self.stimulation_tree.setHeaderLabels([&#34;0 Name&#34;, &#34;1 Iterations&#34;, &#34;2 Delay&#34;, &#34;3 Jitter&#34;, &#34;4 Type&#34;, &#34;5 Pulses&#34;,
                                              &#34;6 Duration&#34;, &#34;7 Jitter&#34;, &#34;8 Width&#34;, &#34;9 Frequency&#34;, &#34;10 Duty&#34;, &#34;11 Type2&#34;, &#34;12 Pulses 2&#34;, &#34;13 Jitter 2&#34;, &#34;14 Width 2&#34;, &#34;15 Frequency 2&#34;, &#34;16 Duty 2&#34;, &#34;17 Blank&#34;, &#34;18 Canal 1&#34;, &#34;19 Canal 2&#34;, &#34;20 Valid&#34;])
        for i in range(19):
            self.stimulation_tree.header().hideSection(i+1)
            pass
        self.stimulation_tree.setHeaderHidden(True)
        self.stimulation_tree.setColumnWidth(0, 330)
        self.stimulation_tree.currentItemChanged.connect(self.actualize_window)
        self.stimulation_tree_window.addWidget(self.stimulation_tree)

        self.stimulation_tree_switch_window = QStackedLayout()
        self.stimulation_tree_second_window = QHBoxLayout()
        self.stim_buttons_container = QWidget()
        self.delete_branch_button = QPushButton(&#39;Delete&#39;)
        self.delete_branch_button.setIcon(QIcon(&#34;gui/icons/trash.png&#34;))
        self.delete_branch_button.clicked.connect(self.delete_branch)
        self.stimulation_tree_second_window.addWidget(self.delete_branch_button)
        self.add_brother_branch_button = QPushButton(&#39;Add Sibling&#39;)
        self.add_brother_branch_button.clicked.connect(self.add_brother)
        self.add_brother_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-down.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_brother_branch_button)
        self.add_child_branch_button = QPushButton(&#39;Add Child&#39;)
        self.add_child_branch_button.clicked.connect(self.add_child)
        self.add_child_branch_button.setIcon(QIcon(&#34;gui/icons/arrow-bar-right.png&#34;))
        self.stimulation_tree_second_window.addWidget(self.add_child_branch_button)
        self.stim_buttons_container.setLayout(self.stimulation_tree_second_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container)

        self.new_branch_button = QPushButton(&#34;New Stimulation&#34;)
        self.new_branch_button.setIcon(QIcon(&#34;gui/icons/square-plus.png&#34;))
        self.stimulation_tree_third_window = QHBoxLayout()
        self.stimulation_tree_third_window.addWidget(self.new_branch_button)
        self.stim_buttons_container2 = QWidget()
        self.stim_buttons_container2.setLayout(self.stimulation_tree_third_window)
        self.stimulation_tree_switch_window.addWidget(self.stim_buttons_container2)
        self.new_branch_button.clicked.connect(self.first_stimulation)
        self.grid_layout.addLayout(self.stimulation_tree_switch_window, 4, 0)

        self.stimulation_tree_switch_window.setCurrentIndex(1)
        self.grid_layout.addLayout(self.stimulation_tree_window, 3, 0)

        self.signal_adjust_label = QLabel(&#39;Signal Adjust&#39;)
        self.signal_adjust_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_adjust_label, 2, 1)

        self.signal_adjust_superposed = QStackedLayout()
        self.stimulation_edit_layout = QVBoxLayout()
        self.stimulation_edit_layout.setContentsMargins(0, 0, 0, 0)

        self.canal_window = QVBoxLayout()
        self.canal_window.setAlignment(Qt.AlignLeft)
        self.canal_window.setAlignment(Qt.AlignTop)
        self.canal_window.setContentsMargins(0, 0, 0, 0)



        self.first_signal_first_canal_check = QCheckBox()
        self.first_signal_first_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_first_canal_check.setText(&#34;Canal 1&#34;)
        self.canal_window.addWidget(self.first_signal_first_canal_check)



        self.stimulation_type_label = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell = QComboBox()
        self.stimulation_type_cell.addItem(&#34;square&#34;)
        self.stimulation_type_cell.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell.addItem(&#34;Third&#34;)
        self.stimulation_type_cell.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window = QHBoxLayout()
        self.stimulation_type_window.addWidget(self.stimulation_type_label)
        self.stimulation_type_window.addWidget(self.stimulation_type_cell)
        self.canal_window.addLayout(self.stimulation_type_window)

        self.different_signals_window = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window)

        self.first_signal_second_canal_check = QCheckBox()
        self.first_signal_second_canal_check.stateChanged.connect(self.canals_to_tree)
        self.first_signal_second_canal_check.setText(&#34;Canal 2&#34;)
        self.canal_window.addWidget(self.first_signal_second_canal_check)

        self.stimulation_type_label2 = QLabel(&#34;Stimulation Type&#34;)
        self.stimulation_type_cell2 = QComboBox()
        self.stimulation_type_cell2.addItem(&#34;square&#34;)
        self.stimulation_type_cell2.addItem(&#34;random-square&#34;)
        self.stimulation_type_cell2.addItem(&#34;Third&#34;)
        self.stimulation_type_cell2.currentIndexChanged.connect(self.type_to_tree)
        self.stimulation_type_window2 = QHBoxLayout()
        self.stimulation_type_window2.addWidget(self.stimulation_type_label2)
        self.stimulation_type_window2.addWidget(self.stimulation_type_cell2)
        self.canal_window.addLayout(self.stimulation_type_window2)

        self.different_signals_window2 = QStackedLayout()
        self.canal_window.addLayout(self.different_signals_window2)

        self.stimulation_name_label = QLabel(&#34;Stimulation Name&#34;)
        self.stimulation_name_cell = QLineEdit()
        self.stimulation_name_cell.textEdited.connect(self.name_to_tree)
        self.stimulation_name_window = QHBoxLayout()
        self.stimulation_name_window.addWidget(self.stimulation_name_label)
        self.stimulation_name_window.addWidget(self.stimulation_name_cell)
        self.stimulation_edit_layout.addLayout(self.stimulation_name_window)

        self.first_signal_duration_window = QHBoxLayout()
        self.first_signal_type_duration_label = QLabel(&#34;Duration (s)&#34;)
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_label)
        self.first_signal_type_duration_cell = QLineEdit()
        self.first_signal_duration_window.addWidget(self.first_signal_type_duration_cell)
        self.first_signal_type_duration_cell.setValidator(self.onlyFloat)
        self.first_signal_type_duration_cell.textEdited.connect(self.signal_to_tree)
        self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)

        #self.stimulation_edit_layout.addLayout(self.stimulation_type_window)
        self.stimulation_edit_layout.addLayout(self.canal_window)



        self.first_signal_type_window = QVBoxLayout()
        self.first_signal_type_window.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window.setAlignment(Qt.AlignTop)
        self.first_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container = QWidget()
        self.first_signal_type_container.setLayout(self.first_signal_type_window)

        self.first_signal_type_window2 = QVBoxLayout()
        self.first_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.first_signal_type_window2.setAlignment(Qt.AlignTop)
        self.first_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.first_signal_type_container2 = QWidget()
        self.first_signal_type_container2.setLayout(self.first_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.first_signal_duration_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.first_signal_pulses_window = QHBoxLayout()
        self.first_signal_type_pulses_label = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_label)
        self.first_signal_type_pulses_cell = QLineEdit()
        self.first_signal_type_pulses_cell.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window.addWidget(self.first_signal_type_pulses_cell)

        self.first_signal_pulses_window2 = QHBoxLayout()
        self.first_signal_type_pulses_label2 = QLabel(&#34;Pulses&#34;)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_label2)
        self.first_signal_type_pulses_cell2 = QLineEdit()
        self.first_signal_type_pulses_cell2.setValidator(self.onlyInt)
        self.first_signal_type_pulses_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_pulses_window2.addWidget(self.first_signal_type_pulses_cell2)

        self.first_signal_jitter_window = QHBoxLayout()
        self.first_signal_type_jitter_label = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_label)
        self.first_signal_type_jitter_cell = QLineEdit()
        self.first_signal_type_jitter_cell.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window.addWidget(self.first_signal_type_jitter_cell)

        self.first_signal_jitter_window2 = QHBoxLayout()
        self.first_signal_type_jitter_label2 = QLabel(&#34;Jitter (s)&#34;)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_label2)
        self.first_signal_type_jitter_cell2 = QLineEdit()
        self.first_signal_type_jitter_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_jitter_cell2.setText(&#34;0&#34;)
        self.first_signal_type_jitter_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_jitter_window2.addWidget(self.first_signal_type_jitter_cell2)

        self.first_signal_width_window = QHBoxLayout()
        self.first_signal_type_width_label = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_label)
        self.first_signal_type_width_cell = QLineEdit()
        self.first_signal_type_width_cell.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell.setText(&#34;0&#34;)
        self.first_signal_type_width_cell.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window.addWidget(self.first_signal_type_width_cell)

        self.first_signal_width_window2 = QHBoxLayout()
        self.first_signal_type_width_label2 = QLabel(&#34;Width (s)&#34;)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_label2)
        self.first_signal_type_width_cell2 = QLineEdit()
        self.first_signal_type_width_cell2.setValidator(self.onlyFloat)
        self.first_signal_type_width_cell2.setText(&#34;0&#34;)
        self.first_signal_type_width_cell2.textEdited.connect(self.signal_to_tree)
        self.first_signal_width_window2.addWidget(self.first_signal_type_width_cell2)

        self.first_signal_type_window.addLayout(self.first_signal_pulses_window)
        self.first_signal_type_window.addLayout(self.first_signal_width_window)
        self.first_signal_type_window.addLayout(self.first_signal_jitter_window)

        self.first_signal_type_window2.addLayout(self.first_signal_pulses_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_width_window2)
        self.first_signal_type_window2.addLayout(self.first_signal_jitter_window2)
# -------------------

        self.second_signal_type_window = QVBoxLayout()
        self.second_signal_type_container = QWidget()
        self.second_signal_type_window.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window.setAlignment(Qt.AlignTop)
        self.second_signal_type_window.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container.setLayout(self.second_signal_type_window)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.second_signal_type_window2 = QVBoxLayout()
        self.second_signal_type_container2 = QWidget()
        self.second_signal_type_window2.setAlignment(Qt.AlignLeft)
        self.second_signal_type_window2.setAlignment(Qt.AlignTop)
        self.second_signal_type_window2.setContentsMargins(0, 0, 0, 0)
        self.second_signal_type_container2.setLayout(self.second_signal_type_window2)

        self.second_signal_frequency_window = QHBoxLayout()
        self.second_signal_type_frequency_label = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_label)
        self.second_signal_type_frequency_cell = QLineEdit()
        self.second_signal_type_frequency_cell.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window.addWidget(self.second_signal_type_frequency_cell)

        self.second_signal_frequency_window2 = QHBoxLayout()
        self.second_signal_type_frequency_label2 = QLabel(&#34;Frequency (Hz)&#34;)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_label2)
        self.second_signal_type_frequency_cell2 = QLineEdit()
        self.second_signal_type_frequency_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_frequency_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_frequency_window2.addWidget(self.second_signal_type_frequency_cell2)

        self.second_signal_duty_window = QHBoxLayout()
        self.second_signal_type_duty_label = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_label)
        self.second_signal_type_duty_cell = QLineEdit()
        self.second_signal_type_duty_cell.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window.addWidget(self.second_signal_type_duty_cell)

        self.second_signal_duty_window2 = QHBoxLayout()
        self.second_signal_type_duty_label2 = QLabel(&#34;Duty (%)&#34;)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_label2)
        self.second_signal_type_duty_cell2 = QLineEdit()
        self.second_signal_type_duty_cell2.setValidator(self.onlyFloat)
        self.second_signal_type_duty_cell2.textEdited.connect(self.signal_to_tree)
        self.second_signal_duty_window2.addWidget(self.second_signal_type_duty_cell2)

        self.second_signal_type_window.addLayout(self.second_signal_frequency_window)
        self.second_signal_type_window.addLayout(self.second_signal_duty_window)

        self.second_signal_type_window2.addLayout(self.second_signal_frequency_window2)
        self.second_signal_type_window2.addLayout(self.second_signal_duty_window2)

# -------------------

        self.third_signal_type_window = QVBoxLayout()
        self.third_signal_type_container = QWidget()
        self.third_signal_type_container.setLayout(self.third_signal_type_window)

        self.third_signal_type_window2 = QVBoxLayout()
        self.third_signal_type_container2 = QWidget()
        self.third_signal_type_container2.setLayout(self.third_signal_type_window2)
        #self.stimulation_edit_layout.addLayout(self.different_signals_window)

        self.third_signal_type_name = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window.addWidget(self.third_signal_type_name)

        self.third_signal_type_name2 = QLabel(&#34;signal3&#34;)
        self.third_signal_type_window2.addWidget(self.third_signal_type_name2)

        self.different_signals_window.addWidget(self.second_signal_type_container)
        self.different_signals_window.addWidget(self.first_signal_type_container)
        self.different_signals_window.addWidget(self.third_signal_type_container)

        self.different_signals_window2.addWidget(self.second_signal_type_container2)
        self.different_signals_window2.addWidget(self.first_signal_type_container2)
        self.different_signals_window2.addWidget(self.third_signal_type_container2)

        self.stimulation_edit_container = QWidget()
        self.stimulation_edit_container.setLayout(self.stimulation_edit_layout)
        self.block_edit_layout = QVBoxLayout()
        self.block_edit_layout.setContentsMargins(0, 0, 0, 0)
        self.block_edit_layout.setAlignment(Qt.AlignLeft)
        self.block_edit_layout.setAlignment(Qt.AlignTop)

        self.block_name_label = QLabel(&#34;Block Name&#34;)
        self.block_name_cell = QLineEdit()
        self.block_name_cell.textEdited.connect(self.name_to_tree)
        self.block_name_window = QHBoxLayout()
        self.block_name_window.addWidget(self.block_name_label)
        self.block_name_window.addWidget(self.block_name_cell)
        self.block_edit_layout.addLayout(self.block_name_window)

        self.block_iterations_window = QHBoxLayout()
        self.block_iterations_label = QLabel(&#34;Iterations&#34;)
        self.block_iterations_cell = QLineEdit()
        self.block_iterations_cell.setValidator(self.onlyInt)
        self.block_iterations_cell.textEdited.connect(self.block_to_tree)
        self.block_iterations_window.addWidget(self.block_iterations_label)
        self.block_iterations_window.addWidget(self.block_iterations_cell)
        self.block_edit_layout.addLayout(self.block_iterations_window)

        self.block_delay_window = QHBoxLayout()
        self.block_delay_label = QLabel(&#34;Delay&#34;)
        self.block_delay_cell = QLineEdit()
        self.block_delay_cell.setValidator(self.onlyFloat)
        self.block_delay_cell.textEdited.connect(self.block_to_tree)
        self.block_delay_window = QHBoxLayout()
        self.block_delay_window.addWidget(self.block_delay_label)
        self.block_delay_window.addWidget(self.block_delay_cell)
        self.block_edit_layout.addLayout(self.block_delay_window)

        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_label = QLabel(&#34;Jitter&#34;)
        self.block_jitter_cell = QLineEdit()
        self.block_jitter_cell.setValidator(self.onlyFloat)
        self.block_jitter_cell.textEdited.connect(self.block_to_tree)
        self.block_jitter_window = QHBoxLayout()
        self.block_jitter_window.addWidget(self.block_jitter_label)
        self.block_jitter_window.addWidget(self.block_jitter_cell)
        self.block_edit_layout.addLayout(self.block_jitter_window)

        self.block_edit_container = QWidget()
        self.block_edit_container.setLayout(self.block_edit_layout)
        self.signal_adjust_superposed.addWidget(self.stimulation_edit_container)
        self.signal_adjust_superposed.addWidget(self.block_edit_container)
        self.signal_adjust_superposed.addWidget(QLabel())
        self.signal_adjust_superposed.setCurrentIndex(2)
        self.grid_layout.addLayout(self.signal_adjust_superposed, 3, 1)

        self.signal_preview_label = QLabel(&#39;Signal Preview&#39;)
        self.signal_preview_label.setFont(QFont(&#34;IBM Plex Sans&#34;, 17))
        self.grid_layout.addWidget(self.signal_preview_label, 2, 2)

        self.buttons_main_window = QHBoxLayout()
        self.stop_button = QPushButton(&#39;Stop&#39;)
        self.stop_button.setIcon(QIcon(&#34;gui/icons/player-stop.png&#34;))
        self.stop_button.clicked.connect(self.stop_while_running)
        self.stop_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.stop_button)
        self.run_button = QPushButton(&#39;Run&#39;)
        self.run_button.setIcon(QIcon(&#34;gui/icons/player-play.png&#34;))
        self.run_button.clicked.connect(self.run)
        self.run_button.setEnabled(False)
        self.buttons_main_window.addWidget(self.run_button)
        self.plot_window = PlotWindow()
        self.grid_layout.addWidget(self.plot_window, 3, 2)
        self.grid_layout.addLayout(self.buttons_main_window, 4, 2)
        self.open_daq_generation_thread()
        self.initialize_buttons()
        self.show()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons"><code class="name flex">
<span>def <span class="ident">initialize_buttons</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def initialize_buttons(self):
    self.canal1buttons = [self.stimulation_type_label, self.stimulation_type_cell, self.first_signal_type_pulses_label, self.first_signal_type_pulses_cell, self.first_signal_type_width_label, self.first_signal_type_width_cell, self.first_signal_type_jitter_label, self.first_signal_type_jitter_cell, self.second_signal_type_frequency_label, self.second_signal_type_frequency_cell, self.second_signal_type_duty_label, self.second_signal_type_duty_cell]
    self.canal2buttons = [self.stimulation_type_label2, self.stimulation_type_cell2, self.first_signal_type_pulses_label2, self.first_signal_type_pulses_cell2, self.first_signal_type_width_label2, self.first_signal_type_width_cell2, self.first_signal_type_jitter_label2, self.first_signal_type_jitter_cell2, self.second_signal_type_frequency_label2, self.second_signal_type_frequency_cell2, self.second_signal_type_duty_label2, self.second_signal_type_duty_cell2]
    self.enabled_buttons = [
        self.run_button,
        self.experiment_name_cell,
        self.mouse_id_cell,
        #self.directory_save_files_checkbox,
        self.directory_choose_button,
        self.set_roi_button,
        self.experiment_name,
        self.mouse_id_label,
        self.framerate_label,
        self.framerate_cell,
        self.exposure_cell,
        self.exposure_label,
        self.add_brother_branch_button,
        self.add_child_branch_button,
        self.delete_branch_button,
        self.red_checkbox,
        self.ir_checkbox,
        self.green_checkbox,
        self.fluorescence_checkbox,
        self.stimulation_name_label,
        self.stimulation_name_cell,
        self.stimulation_type_label,
        self.stimulation_type_cell,
        self.first_signal_first_canal_check,
        self.first_signal_second_canal_check,
        self.first_signal_type_duration_label,
        self.first_signal_type_duration_cell,
        self.first_signal_type_pulses_label,
        self.first_signal_type_pulses_cell,
        self.first_signal_type_width_label,
        self.first_signal_type_width_cell,
        self.first_signal_type_jitter_label,
        self.first_signal_type_jitter_cell,
        self.second_signal_type_frequency_label,
        self.second_signal_type_frequency_cell,
        self.second_signal_type_duty_label,
        self.second_signal_type_duty_cell,
        self.block_iterations_label,
        self.block_iterations_cell,
        self.block_delay_label,
        self.block_delay_cell,
        self.block_jitter_label,
        self.block_jitter_cell,
        self.block_name_label,
        self.block_name_cell,
        self.activate_live_preview_button,
        self.deactivate_live_preview_button,
        self.stimulation_tree
    ]</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree"><code class="name flex">
<span>def <span class="ident">name_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def name_to_tree(self):
    branch = self.stimulation_tree.currentItem()
    branch.setForeground(0, QBrush(QColor(0, 0, 0)))
    if branch.childCount() &gt; 0:
        branch.setText(0, self.block_name_cell.text())
    else:
        branch.setText(0, self.stimulation_name_cell.text())</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread"><code class="name flex">
<span>def <span class="ident">open_daq_generation_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_daq_generation_thread(self):
    self.daq_generation_thread = Thread(target=self.generate_daq)
    self.daq_generation_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread"><code class="name flex">
<span>def <span class="ident">open_live_preview_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_live_preview_thread(self):
    self.live_preview_thread = Thread(target=self.start_live)
    self.live_preview_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread"><code class="name flex">
<span>def <span class="ident">open_signal_preview_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_signal_preview_thread(self):
    self.signal_preview_thread = Thread(target=self.preview_signal)
    self.signal_preview_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread"><code class="name flex">
<span>def <span class="ident">open_start_experiment_thread</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_start_experiment_thread(self):
    self.start_experiment_thread = Thread(target=self.run_stimulation)
    self.start_experiment_thread.start()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.plot"><code class="name flex">
<span>def <span class="ident">plot</span></span>(<span>self, item=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot(self, item=None):
    try:
        if item is None:
            item = self.stimulation_tree.currentItem()
        if item.childCount() &gt; 0:
            if item == self.stimulation_tree.invisibleRootItem():
                jitter, block_delay, iterations_number = 0, 0, 1
            else:
                jitter = float(item.text(3))
                iterations_number = int(item.text(1))
                block_delay = float(item.text(2))

            for iteration in range(iterations_number):
                for index in range(item.childCount()):
                    child = item.child(index)
                    self.plot(child)
                delay = round(block_delay + random.random()*jitter, 3)
                time_values = np.linspace(0, delay, int(round(delay))*3000)
                data = np.zeros(len(time_values))
                time_values += self.elapsed_time
                self.elapsed_time += delay
                self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
                self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
                self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data))
        else:
            duration = float(item.text(6))
            time_values = np.linspace(0, duration, int(round(duration))*3000)
            time_values += self.elapsed_time
            self.elapsed_time += duration
            self.plot_x_values = np.concatenate((self.plot_x_values, time_values))
            if item.text(18) == &#34;True&#34;:
                sign_type, pulses, jitter, width, frequency, duty = self.get_tree_item_attributes(item, canal=1)
                data = make_signal(time_values, sign_type, width, pulses, jitter, frequency, duty)
                self.plot_stim1_values = np.concatenate((self.plot_stim1_values, data))
            else:
                self.plot_stim1_values = np.concatenate((self.plot_stim1_values, np.zeros(len(time_values))))

            if item.text(19) == &#34;True&#34;:
                sign_type2, pulses2, jitter2, width2, frequency2, duty2 = self.get_tree_item_attributes(item, canal=2)
                data2 = make_signal(time_values, sign_type2, width2, pulses2, jitter2, frequency2, duty2)
                self.plot_stim2_values = np.concatenate((self.plot_stim2_values, data2))
            else:
                self.plot_stim2_values = np.concatenate((self.plot_stim2_values, np.zeros(len(time_values))))
    except Exception as err:
        self.plot_x_values = []
        self.plot_y_values = []
        self.elapsed_time = 0</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.preview_signal"><code class="name flex">
<span>def <span class="ident">preview_signal</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def preview_signal(self):
    plt.ion()
    while self.stop_signal is False and self.daq.control_task.is_task_done() is False:
        try:
            self.plot_window.vertical_line.set_xdata([self.daq.current_signal_time,self.daq.current_signal_time])
            time.sleep(0.5)
        except Exception:
            time.sleep(0.5)
            pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.reset_roi"><code class="name flex">
<span>def <span class="ident">reset_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reset_roi(self):
    plt.xlim(0, 1024)
    plt.ylim(0, 1024)
    self.roi_extent = None
    self.reset_roi_button.setEnabled(False)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    self.daq.start_runtime = time.time()
    self.deactivate_buttons(buttons=self.enabled_buttons)
    print(str(time.time()-self.daq.start_runtime) + &#34;to deactivate buttons&#34;)
    self.master_block = self.create_blocks()
    print(str(time.time()-self.daq.start_runtime) + &#34;to generate master block&#34;)
    self.plot(item=self.stimulation_tree.invisibleRootItem())
    print(str(time.time()-self.daq.start_runtime) + &#34;to plot the signal&#34;)
    self.root_time, self.root_signal = self.plot_x_values, [self.plot_stim1_values, self.plot_stim2_values]
    self.draw(root=True)
    print(str(time.time()-self.daq.start_runtime) + &#34;to draw the signal&#34;)
    #self.open_signal_preview_thread()
    self.open_live_preview_thread()
    self.open_start_experiment_thread()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation"><code class="name flex">
<span>def <span class="ident">run_stimulation</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run_stimulation(self):
    self.actualize_daq()
    self.experiment = Experiment(self.master_block, int(self.framerate_cell.text()), int(self.exposure_cell.text(
    )), self.mouse_id_cell.text(), self.directory_cell.text(), self.daq, name=self.experiment_name_cell.text())
    print(str(time.time()-self.daq.start_runtime) + &#34;to intialize the experiment&#34;)
    self.experiment.start(self.root_time, self.root_signal)
    try:
        self.experiment.save(self.files_saved, self.roi_extent)
    except Exception:
        self.experiment.save(self.directory_save_files_checkbox.isChecked())
    self.stop()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.save_roi"><code class="name flex">
<span>def <span class="ident">save_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_roi(self):
    self.activate_buttons(buttons = self.enabled_buttons)
    self.roi_buttons.setCurrentIndex(0)
    plt.ion()
    plt.xlim(self.roi_extent[0], self.roi_extent[1])
    plt.ylim(self.roi_extent[2], self.roi_extent[3])
    self.rect_selector.clear()
    self.rect_selector = None
    self.reset_roi_button.setEnabled(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.set_icon"><code class="name flex">
<span>def <span class="ident">set_icon</span></span>(<span>self, item, valid)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_icon(self, item, valid):
    try:
        if valid:
            item.setIcon(20, QIcon(&#34;gui/icons/circle-check.png&#34;))
        else:
            item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.set_roi"><code class="name flex">
<span>def <span class="ident">set_roi</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_roi(self):
    self.deactivate_buttons(buttons = self.enabled_buttons)
    self.stop_button.setEnabled(False)
    self.save_roi_button.setEnabled(False)
    self.roi_buttons.setCurrentIndex(1)

    def onselect_function(eclick, erelease):
        self.roi_extent = self.rect_selector.extents
        self.save_roi_button.setEnabled(True)

    self.rect_selector = RectangleSelector(self.plot_image.axes, onselect_function,
                                           drawtype=&#39;box&#39;, useblit=True,
                                           button=[1, 3],
                                           minspanx=5, minspany=5,
                                           spancoords=&#39;pixels&#39;,
                                           interactive=True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.show_buttons"><code class="name flex">
<span>def <span class="ident">show_buttons</span></span>(<span>self, buttons)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show_buttons(self, buttons):
    for button in buttons:
        button.setVisible(True)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree"><code class="name flex">
<span>def <span class="ident">signal_to_tree</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def signal_to_tree(self):
    self.stimulation_tree.currentItem().setText(6, self.first_signal_type_duration_cell.text())

    self.stimulation_tree.currentItem().setText(5, self.first_signal_type_pulses_cell.text())
    self.stimulation_tree.currentItem().setText(7, self.first_signal_type_jitter_cell.text())
    self.stimulation_tree.currentItem().setText(8, self.first_signal_type_width_cell.text())
    self.stimulation_tree.currentItem().setText(9, self.second_signal_type_frequency_cell.text())
    self.stimulation_tree.currentItem().setText(10, self.second_signal_type_duty_cell.text())

    self.stimulation_tree.currentItem().setText(12, self.first_signal_type_pulses_cell2.text())
    self.stimulation_tree.currentItem().setText(13, self.first_signal_type_jitter_cell2.text())
    self.stimulation_tree.currentItem().setText(14, self.first_signal_type_width_cell2.text())
    self.stimulation_tree.currentItem().setText(15, self.second_signal_type_frequency_cell2.text())
    self.stimulation_tree.currentItem().setText(16, self.second_signal_type_duty_cell2.text())


    self.check_global_validity()
    self.clear_plot()
    self.plot()
    self.draw()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.start_live"><code class="name flex">
<span>def <span class="ident">start_live</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_live(self):
    plt.ion()
    while self.camera.video_running is False:
        pass
    first =True
    while self.camera.video_running is True:
        self.plot_image.set_array(self.camera.frames[self.live_preview_light_index::len(self.daq.lights)][-1])
        if first is True:
            print(str(time.time()-self.daq.start_runtime) + &#34;to set first image&#34;)
            first = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop(self):
    self.daq.stop_signal = True
    self.daq.stop_signal = True
    self.stop_live()
    self.activate_buttons(buttons = self.enabled_buttons)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_live"><code class="name flex">
<span>def <span class="ident">stop_live</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_live(self):
    self.video_running = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog"><code class="name flex">
<span>def <span class="ident">stop_stimulation_dialog</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_stimulation_dialog(self):
    button = QMessageBox.question(self, &#34;Save Files&#34;, &#34;Do you want to save the current files?&#34;)
    if button == QMessageBox.Yes:
        print(&#34;Yes!&#34;)
    else:
        print(&#34;No!&#34;)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running"><code class="name flex">
<span>def <span class="ident">stop_while_running</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_while_running(self):
    self.stop()
    if self.directory_save_files_checkbox.isChecked():
        self.stop_stimulation_dialog()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.style_tree_item"><code class="name flex">
<span>def <span class="ident">style_tree_item</span></span>(<span>self, item)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def style_tree_item(self, item):
    item.setIcon(20, QIcon(&#34;gui/icons/alert-triangle.png&#34;))
    item.setForeground(0, QBrush(QColor(211, 211, 211)))
    item.setIcon(0, QIcon(&#34;gui/icons/wave-square.png&#34;))
    item.setText(0, &#34;No Name&#34;)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block"><code class="name flex">
<span>def <span class="ident">tree_to_block</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_block(self):
    try:
        self.block_iterations_cell.setText(self.stimulation_tree.currentItem().text(1))
        self.block_delay_cell.setText(self.stimulation_tree.currentItem().text(2))
        self.block_jitter_cell.setText(self.stimulation_tree.currentItem().text(3))
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal"><code class="name flex">
<span>def <span class="ident">tree_to_canal</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_canal(self):
    self.canal_running = True
    try:
        self.first_signal_first_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(18)))
        self.first_signal_second_canal_check.setChecked(self.boolean(self.stimulation_tree.currentItem().text(19)))
        if self.first_signal_first_canal_check.isChecked():
                self.activate_buttons(self.canal1buttons)
        else:
            self.deactivate_buttons(self.canal1buttons)
        if self.first_signal_second_canal_check.isChecked():
            self.activate_buttons(self.canal2buttons)
        else:
            self.deactivate_buttons(self.canal2buttons)
    except Exception:
        pass
    self.canal_running = False</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name"><code class="name flex">
<span>def <span class="ident">tree_to_name</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_name(self):
    try:
        if self.stimulation_tree.currentItem().childCount() &gt; 0:
            if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                self.block_name_cell.setText(
                    self.stimulation_tree.currentItem().text(0))
            else:
                self.block_name_cell.setText(&#34;&#34;)
        else:
            if self.stimulation_tree.currentItem().text(0) != &#34;No Name&#34;:
                self.stimulation_name_cell.setText(
                    self.stimulation_tree.currentItem().text(0))
            else:
                self.stimulation_name_cell.setText(&#34;&#34;)
    except AttributeError:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal"><code class="name flex">
<span>def <span class="ident">tree_to_signal</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_signal(self):
    try:
        self.first_signal_type_pulses_cell.setText(self.stimulation_tree.currentItem().text(5))
        self.first_signal_type_duration_cell.setText(self.stimulation_tree.currentItem().text(6))
        self.first_signal_type_jitter_cell.setText(self.stimulation_tree.currentItem().text(7))
        self.first_signal_type_width_cell.setText(self.stimulation_tree.currentItem().text(8))
        self.second_signal_type_frequency_cell.setText(self.stimulation_tree.currentItem().text(9))
        self.second_signal_type_duty_cell.setText(self.stimulation_tree.currentItem().text(10))
        self.first_signal_type_pulses_cell2.setText(self.stimulation_tree.currentItem().text(12))
        self.first_signal_type_jitter_cell2.setText(self.stimulation_tree.currentItem().text(13))
        self.first_signal_type_width_cell2.setText(self.stimulation_tree.currentItem().text(14))
        self.second_signal_type_frequency_cell2.setText(self.stimulation_tree.currentItem().text(15))
        self.second_signal_type_duty_cell2.setText(self.stimulation_tree.currentItem().text(16))
    except Exception as err:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type"><code class="name flex">
<span>def <span class="ident">tree_to_type</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tree_to_type(self):
    dico = {
        &#34;square&#34;: 0,
        &#34;random-square&#34;: 1,
        &#34;Third&#34;: 2
    }
    try:
        self.stimulation_type_cell.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(4)])
    except Exception:
        self.stimulation_type_cell.setCurrentIndex(0)

    try:
        self.stimulation_type_cell2.setCurrentIndex(dico[self.stimulation_tree.currentItem().text(11)])
    except Exception:
        self.stimulation_type_cell2.setCurrentIndex(0)</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree"><code class="name flex">
<span>def <span class="ident">type_to_tree</span></span>(<span>self, first=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def type_to_tree(self, first=False):
    if first is True:
        self.stimulation_type_cell.setCurrentIndex(0)
        self.stimulation_type_cell2.setCurrentIndex(0)
    else:
        self.check_global_validity()
    self.different_signals_window.setCurrentIndex(self.stimulation_type_cell.currentIndex())
    self.different_signals_window2.setCurrentIndex(self.stimulation_type_cell2.currentIndex())
    #self.check_stim_validity()
    try:
        self.stimulation_tree.currentItem().setText(4, str(self.stimulation_type_cell.currentText()))
    except Exception:
        pass
    try:
        self.stimulation_tree.currentItem().setText(11, str(self.stimulation_type_cell2.currentText()))
    except Exception:
        pass
    try:
        self.clear_plot()
        self.plot()
        self.draw()
    except Exception:
        pass</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure"><code class="name flex">
<span>def <span class="ident">verify_exposure</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def verify_exposure(self):
    try:
        boolean_check =  (int(self.exposure_cell.text())/1000+0.0015)*int(self.framerate_cell.text()) &lt; 1
    except Exception:
        boolean_check = False
    self.exposure_warning_label.setHidden(boolean_check)
    self.check_run()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.PlotWindow"><code class="flex name class">
<span>class <span class="ident">PlotWindow</span></span>
<span>(</span><span>parent=None)</span>
</code></dt>
<dd>
<div class="desc"><p>QDialog(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class PlotWindow(QDialog):
    def __init__(self, parent=None):
        super(PlotWindow, self).__init__(parent)
        self.figure = plt.figure()
        self.canvas = FigureCanvas(self.figure)
        layout = QVBoxLayout()
        layout.addWidget(self.canvas)
        self.setLayout(layout)

    def get_data(self, time_values, pulses, jitter, width=0.2):
        y_values = random_square(time_values, pulses, width, jitter)
        return y_values

    def clear(self):
        plt.clf()

    def plot(self, x, y, root, color=&#34;b&#34;):
        plt.ion()
        plt.plot(x,y, color=color)
        if root:
            try:
                self.vertical_line
            except Exception:
                self.vertical_line = plt.axvline(0, ls=&#39;-&#39;, color=&#39;r&#39;, lw=1, zorder=10)
        else:
            try:
                self.vertical_line.remove()
            except Exception:
                pass
        #self.canvas.draw()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QDialog</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.clear"><code class="name flex">
<span>def <span class="ident">clear</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear(self):
    plt.clf()</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.get_data"><code class="name flex">
<span>def <span class="ident">get_data</span></span>(<span>self, time_values, pulses, jitter, width=0.2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_data(self, time_values, pulses, jitter, width=0.2):
    y_values = random_square(time_values, pulses, width, jitter)
    return y_values</code></pre>
</details>
</dd>
<dt id="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.plot"><code class="name flex">
<span>def <span class="ident">plot</span></span>(<span>self, x, y, root, color='b')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot(self, x, y, root, color=&#34;b&#34;):
    plt.ion()
    plt.plot(x,y, color=color)
    if root:
        try:
            self.vertical_line
        except Exception:
            self.vertical_line = plt.axvline(0, ls=&#39;-&#39;, color=&#39;r&#39;, lw=1, zorder=10)
    else:
        try:
            self.vertical_line.remove()
        except Exception:
            pass
    #self.canvas.draw()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="Widefield-Imaging-Acquisition.gui" href="index.html">Widefield-Imaging-Acquisition.gui</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="Widefield-Imaging-Acquisition.gui.interface.App" href="#Widefield-Imaging-Acquisition.gui.interface.App">App</a></code></h4>
<ul class="">
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.activate_buttons">activate_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_daq">actualize_daq</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.actualize_window" href="#Widefield-Imaging-Acquisition.gui.interface.App.actualize_window">actualize_window</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.add_brother" href="#Widefield-Imaging-Acquisition.gui.interface.App.add_brother">add_brother</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.add_child" href="#Widefield-Imaging-Acquisition.gui.interface.App.add_child">add_child</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.block_to_tree">block_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.boolean" href="#Widefield-Imaging-Acquisition.gui.interface.App.boolean">boolean</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.canals_to_tree">canals_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.cancel_roi">cancel_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel" href="#Widefield-Imaging-Acquisition.gui.interface.App.change_preview_light_channel">change_preview_light_channel</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_block_validity" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_block_validity">check_block_validity</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_global_validity" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_global_validity">check_global_validity</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_if_thread_is_alive">check_if_thread_is_alive</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_lights" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_lights">check_lights</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_run" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_run">check_run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.check_stim_validity" href="#Widefield-Imaging-Acquisition.gui.interface.App.check_stim_validity">check_stim_validity</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.choose_directory" href="#Widefield-Imaging-Acquisition.gui.interface.App.choose_directory">choose_directory</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.clear_plot" href="#Widefield-Imaging-Acquisition.gui.interface.App.clear_plot">clear_plot</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.closeEvent" href="#Widefield-Imaging-Acquisition.gui.interface.App.closeEvent">closeEvent</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.count_lights" href="#Widefield-Imaging-Acquisition.gui.interface.App.count_lights">count_lights</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.create_blocks" href="#Widefield-Imaging-Acquisition.gui.interface.App.create_blocks">create_blocks</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.deactivate_buttons">deactivate_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.delete_branch" href="#Widefield-Imaging-Acquisition.gui.interface.App.delete_branch">delete_branch</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.disable_run" href="#Widefield-Imaging-Acquisition.gui.interface.App.disable_run">disable_run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.draw" href="#Widefield-Imaging-Acquisition.gui.interface.App.draw">draw</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.enable_directory" href="#Widefield-Imaging-Acquisition.gui.interface.App.enable_directory">enable_directory</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.enable_run" href="#Widefield-Imaging-Acquisition.gui.interface.App.enable_run">enable_run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.first_stimulation" href="#Widefield-Imaging-Acquisition.gui.interface.App.first_stimulation">first_stimulation</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.generate_daq" href="#Widefield-Imaging-Acquisition.gui.interface.App.generate_daq">generate_daq</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.get_tree_item_attributes" href="#Widefield-Imaging-Acquisition.gui.interface.App.get_tree_item_attributes">get_tree_item_attributes</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.hide_buttons">hide_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.initUI" href="#Widefield-Imaging-Acquisition.gui.interface.App.initUI">initUI</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.initialize_buttons">initialize_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.name_to_tree">name_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_daq_generation_thread">open_daq_generation_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_live_preview_thread">open_live_preview_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_signal_preview_thread">open_signal_preview_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread" href="#Widefield-Imaging-Acquisition.gui.interface.App.open_start_experiment_thread">open_start_experiment_thread</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.plot" href="#Widefield-Imaging-Acquisition.gui.interface.App.plot">plot</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.preview_signal" href="#Widefield-Imaging-Acquisition.gui.interface.App.preview_signal">preview_signal</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.reset_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.reset_roi">reset_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.run" href="#Widefield-Imaging-Acquisition.gui.interface.App.run">run</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation" href="#Widefield-Imaging-Acquisition.gui.interface.App.run_stimulation">run_stimulation</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.save_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.save_roi">save_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.set_icon" href="#Widefield-Imaging-Acquisition.gui.interface.App.set_icon">set_icon</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.set_roi" href="#Widefield-Imaging-Acquisition.gui.interface.App.set_roi">set_roi</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.show_buttons" href="#Widefield-Imaging-Acquisition.gui.interface.App.show_buttons">show_buttons</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.signal_to_tree">signal_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.start_live" href="#Widefield-Imaging-Acquisition.gui.interface.App.start_live">start_live</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop">stop</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_live" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_live">stop_live</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_stimulation_dialog">stop_stimulation_dialog</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running" href="#Widefield-Imaging-Acquisition.gui.interface.App.stop_while_running">stop_while_running</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.style_tree_item" href="#Widefield-Imaging-Acquisition.gui.interface.App.style_tree_item">style_tree_item</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_block">tree_to_block</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_canal">tree_to_canal</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_name">tree_to_name</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_signal">tree_to_signal</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type" href="#Widefield-Imaging-Acquisition.gui.interface.App.tree_to_type">tree_to_type</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree" href="#Widefield-Imaging-Acquisition.gui.interface.App.type_to_tree">type_to_tree</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure" href="#Widefield-Imaging-Acquisition.gui.interface.App.verify_exposure">verify_exposure</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="Widefield-Imaging-Acquisition.gui.interface.PlotWindow" href="#Widefield-Imaging-Acquisition.gui.interface.PlotWindow">PlotWindow</a></code></h4>
<ul class="">
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.clear" href="#Widefield-Imaging-Acquisition.gui.interface.PlotWindow.clear">clear</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.get_data" href="#Widefield-Imaging-Acquisition.gui.interface.PlotWindow.get_data">get_data</a></code></li>
<li><code><a title="Widefield-Imaging-Acquisition.gui.interface.PlotWindow.plot" href="#Widefield-Imaging-Acquisition.gui.interface.PlotWindow.plot">plot</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>